{"ID":"20230817161733-urvys7o","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161733-urvys7o","title":"函数的基本操作","updated":"20230817161733"},"Children":[{"ID":"20230817161734-30dzm76","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161734-30dzm76","updated":"20230817161734"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Hive高级函数的使用"}]},{"ID":"20230817161735-v8zkwg1","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161735-v8zkwg1","updated":"20230817161735"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"函数的基本操作"}]},{"ID":"20230817161736-ilivbn5","Type":"NodeParagraph","Properties":{"id":"20230817161736-ilivbn5","updated":"20230817161736"},"Children":[{"Type":"NodeText","Data":"和mysql一样的，hive也是一个主要做统计的工具，所以为了满足各种各样的统计需要，他也内置了相当多的函数，我们可以通过"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"show functions;"},{"Type":"NodeText","Data":"来查看hive中的内置函数"}]},{"ID":"20230817161737-j85kmk6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161737-j85kmk6","updated":"20230817161737"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e show functions;\nOK\ntab_name\nabs\nacos\nadd_months\naes_decrypt\naes_encrypt\nand\narray\narray_contains\nascii\nasin\nassert_true\nassert_true_oom\natan\navg\n........\n代码块123456789101112131415161718\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161738-3kl8z9b","Type":"NodeParagraph","Properties":{"id":"20230817161738-3kl8z9b","updated":"20230817161738"},"Children":[{"Type":"NodeText","Data":"查看指定函数的描述信息我们可以使用："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"desc function functionName;"}]},{"ID":"20230817161739-qb6vjnp","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161739-qb6vjnp","updated":"20230817161739"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function year;\nOK\ntab_name\nyear(param) - Returns the year component of the date/timestamp/interval\nTime taken: 0.015 seconds, Fetched: 1 row(s)\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161740-kxd0iro","Type":"NodeParagraph","Properties":{"id":"20230817161740-kxd0iro","updated":"20230817161740"},"Children":[{"Type":"NodeText","Data":"显示函数的扩展内容"}]},{"ID":"20230817161741-vnyqaf2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161741-vnyqaf2","updated":"20230817161741"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function extended year;\nOK\ntab_name\nyear(param) - Returns the year component of the date/timestamp/interval\nparam can be one of:\n1. A string in the format of 'yyyy-MM-dd HH:mm:ss' or 'yyyy-MM-dd'.\n2. A date value\n3. A timestamp value\n4. A year-month interval valueExample:\n   \u003e SELECT year('2009-07-30') FROM src LIMIT 1;\n  2009\nFunction class:org.apache.hadoop.hive.ql.udf.UDFYear\nFunction type:BUILTIN\nTime taken: 0.027 seconds, Fetched: 10 row(s)\n代码块1234567891011121314\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161742-q0h4lbq","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161742-q0h4lbq","updated":"20230817161742"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"Hive高级函数应用"}]},{"ID":"20230817161743-lmkqinu","Type":"NodeParagraph","Properties":{"id":"20230817161743-lmkqinu","updated":"20230817161743"},"Children":[{"Type":"NodeText","Data":"普通的就不说了，mysql中支持的函数这里面大部分都支持，并且hive支持的函数比mysql还要多，在这里我们主要挑几个典型的说一下"}]},{"ID":"20230817161744-zwnfa38","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161744-zwnfa38","updated":"20230817161744"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"分组排序取TopN"}]},{"ID":"20230817161745-rdnmn2w","Type":"NodeParagraph","Properties":{"id":"20230817161745-rdnmn2w","updated":"20230817161745"},"Children":[{"Type":"NodeText","Data":"一个典型的应用场景，分组排序取TopN操作"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"主要需要使用到ROW_NUMBER() 和 OVER()函数"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"row_number和over函数通常搭配在一起使用"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"row_number会对数据编号，编号从1开始"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"over可以理解为把数据划分到一个窗口内，里面可以加上partition by，表示按照字段对数据进行分组，还可以加上order by 表示对每个分组内的数据按照某个字段进行排序"}]},{"ID":"20230817161746-em37gfx","Type":"NodeParagraph","Properties":{"id":"20230817161746-em37gfx","updated":"20230817161746"},"Children":[{"Type":"NodeText","Data":"我们的需求是这样，有一份学生的考试分数信息，语文、数学、英语这三门，需要计算出班级中单科排名前三名学生的姓名"}]},{"ID":"20230817161747-q6hlruz","Type":"NodeParagraph","Properties":{"id":"20230817161747-q6hlruz","updated":"20230817161747"},"Children":[{"Type":"NodeText","Data":"基础数据是这样的"}]},{"ID":"20230817161748-8lfqahf","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161748-8lfqahf","updated":"20230817161748"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 hivedata]# more student_score.data \n1       zs1     chinese 80\n2       zs1     math    90\n3       zs1     english 89\n4       zs2     chinese 60\n5       zs2     math    75\n6       zs2     english 80\n7       zs3     chinese 79\n8       zs3     math    83\n9       zs3     english 72\n10      zs4     chinese 90\n11      zs4     math    76\n12      zs4     english 80\n13      zs5     chinese 98\n14      zs5     math    80\n15      zs5     english 70\n代码块12345678910111213141516\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161749-nmv1usn","Type":"NodeParagraph","Properties":{"id":"20230817161749-nmv1usn","updated":"20230817161749"},"Children":[{"Type":"NodeText","Data":"建表"}]},{"ID":"20230817161750-a5tnd54","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161750-a5tnd54","updated":"20230817161750"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"create external table student_score(\nid int,\nname string,\nsub string,\nscore int\n)row format delimited\nfields terminated by '\\t'\nlocation '/data/student_score';\n代码块12345678\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161751-ino4k3a","Type":"NodeParagraph","Properties":{"id":"20230817161751-ino4k3a","updated":"20230817161751"},"Children":[{"Type":"NodeText","Data":"加载数据"}]},{"ID":"20230817161752-chavyj9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161752-chavyj9","updated":"20230817161752"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 hivedata]# hdfs dfs -put /data/soft/hivedata/student_score.data /data/student_score\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161753-0uacm5r","Type":"NodeParagraph","Properties":{"id":"20230817161753-0uacm5r","updated":"20230817161753"},"Children":[{"Type":"NodeText","Data":"我们先使用row_number对数据编号，看一下是什么样子，row_number不能单独使用，在这里需要加上over"}]},{"ID":"20230817161754-m0w3w5b","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161754-m0w3w5b","updated":"20230817161754"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select *,row_number() over() from student_score;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161755-r0f61ti","Type":"NodeParagraph","Properties":{"id":"20230817161755-r0f61ti","updated":"20230817161755"},"Children":[{"Type":"NodeText","Data":"结果如下：在这里相当于给表里面的所有数据编了一个号，从1开始"}]},{"ID":"20230817161756-po6z5cq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161756-po6z5cq","updated":"20230817161756"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"15      zs5     english 70      1\n14      zs5     math    80      2\n13      zs5     chinese 98      3\n12      zs4     english 80      4\n11      zs4     math    76      5\n10      zs4     chinese 90      6\n9       zs3     english 72      7\n8       zs3     math    83      8\n7       zs3     chinese 79      9\n6       zs2     english 80      10\n5       zs2     math    75      11\n4       zs2     chinese 60      12\n3       zs1     english 89      13\n2       zs1     math    90      14\n1       zs1     chinese 80      15\n代码块123456789101112131415\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161757-7pzgfm0","Type":"NodeParagraph","Properties":{"id":"20230817161757-7pzgfm0","updated":"20230817161757"},"Children":[{"Type":"NodeText","Data":"但是我们是希望对这些数据，先分组，再对组内数据进行排序，再编号"}]},{"ID":"20230817161758-9zibdl2","Type":"NodeParagraph","Properties":{"id":"20230817161758-9zibdl2","updated":"20230817161758"},"Children":[{"Type":"NodeText","Data":"所以就需要在over函数内部添加partiton by进行分组，添加order by 进行排序，最终给生成的编号起了换一个别名num"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"执行sql"}]},{"ID":"20230817161759-dtmn2ez","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161759-dtmn2ez","updated":"20230817161759"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select *, row_number() over (partition by sub order by score desc) as num from student_score;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161760-vjo9jq3","Type":"NodeParagraph","Properties":{"id":"20230817161760-vjo9jq3","updated":"20230817161760"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161761-2q2o5oy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161761-2q2o5oy","updated":"20230817161761"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"13      zs5     chinese 98      1\n10      zs4     chinese 90      2\n1       zs1     chinese 80      3\n7       zs3     chinese 79      4\n4       zs2     chinese 60      5\n3       zs1     english 89      1\n6       zs2     english 80      2\n12      zs4     english 80      3\n9       zs3     english 72      4\n15      zs5     english 70      5\n2       zs1     math    90      1\n8       zs3     math    83      2\n14      zs5     math    80      3\n11      zs4     math    76      4\n5       zs2     math    75      5\n代码块123456789101112131415\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161762-b7y653c","Type":"NodeParagraph","Properties":{"id":"20230817161762-b7y653c","updated":"20230817161762"},"Children":[{"Type":"NodeText","Data":"接着就可以获取前三名了，"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"执行sql"}]},{"ID":"20230817161763-g9d7kdw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161763-g9d7kdw","updated":"20230817161763"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select * from (\nselect *, row_number() over (partition by sub order by score desc) as num \nfrom student_score \n) s where s.num\u003c=3\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161764-yhoav45","Type":"NodeParagraph","Properties":{"id":"20230817161764-yhoav45","updated":"20230817161764"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161765-sunxzqz","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161765-sunxzqz","updated":"20230817161765"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"13      zs5     chinese 98      1\n10      zs4     chinese 90      2\n1       zs1     chinese 80      3\n3       zs1     english 89      1\n6       zs2     english 80      2\n12      zs4     english 80      3\n2       zs1     math    90      1\n8       zs3     math    83      2\n14      zs5     math    80      3\n代码块123456789\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161766-m1blpt5","Type":"NodeParagraph","Properties":{"id":"20230817161766-m1blpt5","updated":"20230817161766"},"Children":[{"Type":"NodeText","Data":"前面SQL中的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"row_number()"},{"Type":"NodeText","Data":"可以替换为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"rank()"},{"Type":"NodeText","Data":"或者"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"dense_rank()"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"其中："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"rank()"},{"Type":"NodeText","Data":"表示上下两条记录的score相等时，记录的行号是一样的，但下一个score值的行号递增N（N是重复的次数），比如：有两条并列第一，下一个是第三，没有第二"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"执行sql"}]},{"ID":"20230817161767-h8550qx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161767-h8550qx","updated":"20230817161767"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select *, rank() over (partition by sub order by score desc) as num from student_score;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161768-obixacu","Type":"NodeParagraph","Properties":{"id":"20230817161768-obixacu","updated":"20230817161768"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161769-lmnfjta","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161769-lmnfjta","updated":"20230817161769"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"13      zs5     chinese 98      1\n10      zs4     chinese 90      2\n1       zs1     chinese 80      3\n7       zs3     chinese 79      4\n4       zs2     chinese 60      5\n3       zs1     english 89      1\n6       zs2     english 80      2\n12      zs4     english 80      2\n9       zs3     english 72      4\n15      zs5     english 70      5\n2       zs1     math    90      1\n8       zs3     math    83      2\n14      zs5     math    80      3\n11      zs4     math    76      4\n5       zs2     math    75      5\n代码块123456789101112131415\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161770-nfvv0sz","Type":"NodeParagraph","Properties":{"id":"20230817161770-nfvv0sz","updated":"20230817161770"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"dense_rank()"},{"Type":"NodeText","Data":"表示上下两条记录的score相等时，下一个score值的行号递增1，比如：有两条并列第一，下一个是第二"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"执行sql"}]},{"ID":"20230817161771-gyyd9bb","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161771-gyyd9bb","updated":"20230817161771"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select *, dense_rank() over (partition by sub order by score desc) as num from student_score;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161772-xm3br6c","Type":"NodeParagraph","Properties":{"id":"20230817161772-xm3br6c","updated":"20230817161772"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161773-z3648gr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161773-z3648gr","updated":"20230817161773"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"13      zs5     chinese 98      1\n10      zs4     chinese 90      2\n1       zs1     chinese 80      3\n7       zs3     chinese 79      4\n4       zs2     chinese 60      5\n3       zs1     english 89      1\n6       zs2     english 80      2\n12      zs4     english 80      2\n9       zs3     english 72      3\n15      zs5     english 70      4\n2       zs1     math    90      1\n8       zs3     math    83      2\n14      zs5     math    80      3\n11      zs4     math    76      4\n5       zs2     math    75      5\n代码块123456789101112131415\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161774-oxgra95","Type":"NodeParagraph","Properties":{"id":"20230817161774-oxgra95","updated":"20230817161774"},"Children":[{"Type":"NodeText","Data":"总结一下："},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"row_number() over()"},{"Type":"NodeText","Data":" 是正常排序"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"rank() over()"},{"Type":"NodeText","Data":"是跳跃排序，有两个第一名时接下来就是第三名（在各个分组内）"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"dense_rank() over()"},{"Type":"NodeText","Data":"是连续排序，有两个第一名时仍然跟着第二名（在各个分组内）"}]},{"ID":"20230817161775-vu6f63d","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161775-vu6f63d","updated":"20230817161775"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"行转列"}]},{"ID":"20230817161776-33boh5q","Type":"NodeParagraph","Properties":{"id":"20230817161776-33boh5q","updated":"20230817161776"},"Children":[{"Type":"NodeText","Data":"行转列就是把多行数据转为一列数据"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"针对行转列这种需求主要需要使用到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"CONCAT_WS()、COLLECT_SET() 、COLLECT_LIST()"},{"Type":"NodeText","Data":"函数"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"先看一下这几个函数的描述信息，注意，有的函数在帮助文档里面没有描述信息"}]},{"ID":"20230817161777-i71ff9c","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161777-i71ff9c","updated":"20230817161777"},"Children":[{"ID":"20230817161778-rkuczea","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161778-rkuczea","updated":"20230817161778"},"Children":[{"ID":"20230817161779-m7zh26n","Type":"NodeParagraph","Properties":{"id":"20230817161779-m7zh26n","updated":"20230817161779"},"Children":[{"Type":"NodeText","Data":"CONCAT_WS()"}]}]}]},{"ID":"20230817161780-esgw8y6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161780-esgw8y6","updated":"20230817161780"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function CONCAT_WS;\nOK\ntab_name\nCONCAT_WS(separator, [string | array(string)]+) - returns the concatenation of the strings separated by the separator.\nTime taken: 0.019 seconds, Fetched: 1 row(s)\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161781-kwi04oz","Type":"NodeParagraph","Properties":{"id":"20230817161781-kwi04oz","updated":"20230817161781"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"CONCAT_WS()"},{"Type":"NodeText","Data":"函数可以实现根据指定的分隔符拼接多个字段的值，最终转化为一个带有分隔符的字符串"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"它可以接收多个参数，第一个参数是分隔符，后面的参数可以是字符串或者字符串数组，最终就是使用分隔符把后面的所有字符串拼接到一块"}]},{"ID":"20230817161782-p0vohvs","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161782-p0vohvs","updated":"20230817161782"},"Children":[{"ID":"20230817161783-mvjr6wz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161783-mvjr6wz","updated":"20230817161783"},"Children":[{"ID":"20230817161784-mw4l65w","Type":"NodeParagraph","Properties":{"id":"20230817161784-mw4l65w","updated":"20230817161784"},"Children":[{"Type":"NodeText","Data":"COLLECT_LIST()"}]}]}]},{"ID":"20230817161785-x2pfqv4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161785-x2pfqv4","updated":"20230817161785"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function COLLECT_LIST;\nOK\ntab_name\nCOLLECT_LIST(x) - Returns a list of objects with duplicates\nTime taken: 0.014 seconds, Fetched: 1 row(s)\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161786-4pskpyf","Type":"NodeParagraph","Properties":{"id":"20230817161786-4pskpyf","updated":"20230817161786"},"Children":[{"Type":"NodeText","Data":"这个函数可以返回一个list集合，集合中的元素会重复，一般和group by 结合在一起使用，一会再演示"}]},{"ID":"20230817161787-tmiauqo","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161787-tmiauqo","updated":"20230817161787"},"Children":[{"ID":"20230817161788-smq76a8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161788-smq76a8","updated":"20230817161788"},"Children":[{"ID":"20230817161789-qlgz9xu","Type":"NodeParagraph","Properties":{"id":"20230817161789-qlgz9xu","updated":"20230817161789"},"Children":[{"Type":"NodeText","Data":"COLLECT_SET()"}]}]}]},{"ID":"20230817161790-dzskddw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161790-dzskddw","updated":"20230817161790"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function COLLECT_SET;\nOK\ntab_name\nCOLLECT_SET(x) - Returns a set of objects with duplicate elements eliminated\nTime taken: 0.014 seconds, Fetched: 1 row(s)\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161791-auajwws","Type":"NodeParagraph","Properties":{"id":"20230817161791-auajwws","updated":"20230817161791"},"Children":[{"Type":"NodeText","Data":"这个函数可以返回一个set集合，集合汇中的元素不重复，一般和group by 结合在一起使用，一会再演示"}]},{"ID":"20230817161792-t4saade","Type":"NodeParagraph","Properties":{"id":"20230817161792-t4saade","updated":"20230817161792"},"Children":[{"Type":"NodeText","Data":"根据前面的分析，使用这几个函数我们就可以实现行转列这个需求了"}]},{"ID":"20230817161793-33mqngu","Type":"NodeParagraph","Properties":{"id":"20230817161793-33mqngu","updated":"20230817161793"},"Children":[{"Type":"NodeText","Data":"某位学生有很多爱好，数据如下"}]},{"ID":"20230817161794-4rf7ax2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161794-4rf7ax2","updated":"20230817161794"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 hivedata]# more student_favors.data \nzs      swing\nzs      footbal\nzs      sing\nzs      codeing\nzs      swing\n代码块123456\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161795-713mf2k","Type":"NodeParagraph","Properties":{"id":"20230817161795-713mf2k","updated":"20230817161795"},"Children":[{"Type":"NodeText","Data":"期望的结果是这样的"}]},{"ID":"20230817161796-vnjj5iv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161796-vnjj5iv","updated":"20230817161796"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"zs\tswing,footbal,sing,codeing,swing\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161797-tqzlc4t","Type":"NodeParagraph","Properties":{"id":"20230817161797-tqzlc4t","updated":"20230817161797"},"Children":[{"Type":"NodeText","Data":"分析一下："},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"在这其实就是对数据进行了分组，分组之后可以把相同人的爱好保存到一个数组中，再把数组中的数据转成使用逗号分割的字符串"}]},{"ID":"20230817161798-l3kflew","Type":"NodeParagraph","Properties":{"id":"20230817161798-l3kflew","updated":"20230817161798"},"Children":[{"Type":"NodeText","Data":"开始对原始数据建表"}]},{"ID":"20230817161799-1ovza23","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161799-1ovza23","updated":"20230817161799"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"create external table student_favors(\nname string,\nfavor string\n)row format delimited\nfields terminated by '\\t'\nlocation '/data/student_favors';\n代码块123456\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161800-e6fgi0o","Type":"NodeParagraph","Properties":{"id":"20230817161800-e6fgi0o","updated":"20230817161800"},"Children":[{"Type":"NodeText","Data":"上传数据："}]},{"ID":"20230817161801-h6fi1s8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161801-h6fi1s8","updated":"20230817161801"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 hivedata]# hdfs dfs -put /data/soft/hivedata/student_favors.data  /data/student_favors\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161802-3xydhus","Type":"NodeParagraph","Properties":{"id":"20230817161802-3xydhus","updated":"20230817161802"},"Children":[{"Type":"NodeText","Data":"查看数据"}]},{"ID":"20230817161803-5h1znw2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161803-5h1znw2","updated":"20230817161803"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select * from student_favors;\nOK\nstudent_favors.name     student_favors.favor\nzs      swing\nzs      footbal\nzs      sing\nzs      codeing\nzs      swing\nTime taken: 0.175 seconds, Fetched: 5 row(s)\n代码块123456789\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161804-wuexu6h","Type":"NodeParagraph","Properties":{"id":"20230817161804-wuexu6h","updated":"20230817161804"},"Children":[{"Type":"NodeText","Data":"我们想要把数据转换为这种格式："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"zs swing,footbal,sing,codeing,swing"}]},{"ID":"20230817161805-tg46iq8","Type":"NodeParagraph","Properties":{"id":"20230817161805-tg46iq8","updated":"20230817161805"},"Children":[{"Type":"NodeText","Data":"先对name字段进行分组，把favor转成一个数组"}]},{"ID":"20230817161806-ok8zbfn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161806-ok8zbfn","updated":"20230817161806"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select name,collect_list(favor) as favor_list from student_favors group by name;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161807-0kenn79","Type":"NodeParagraph","Properties":{"id":"20230817161807-0kenn79","updated":"20230817161807"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161808-hm27wxg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161808-hm27wxg","updated":"20230817161808"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"zs      [\"swing\",\"footbal\",\"sing\",\"codeing\",\"swing\"]\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161809-lx6lo4e","Type":"NodeParagraph","Properties":{"id":"20230817161809-lx6lo4e","updated":"20230817161809"},"Children":[{"Type":"NodeText","Data":"然后再使用"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"concat_ws"},{"Type":"NodeText","Data":"把数组中的元素按照指定分隔符转成字符串"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"这样就实现了多行数据转为一列数据了"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"执行行转列操作"}]},{"ID":"20230817161810-zq6qjmy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161810-zq6qjmy","updated":"20230817161810"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select name,concat_ws(',',collect_list(favor)) as favor_list from student_favors group by name;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161811-49elx2q","Type":"NodeParagraph","Properties":{"id":"20230817161811-49elx2q","updated":"20230817161811"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161812-bd0m4y6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161812-bd0m4y6","updated":"20230817161812"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"zs      swing,footbal,sing,codeing,swing\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161813-ug7hetg","Type":"NodeParagraph","Properties":{"id":"20230817161813-ug7hetg","updated":"20230817161813"},"Children":[{"Type":"NodeText","Data":"我们发现这里面有一些爱好是重复的，如果不希望出现重复的话可以使用COLLECT_SET()"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"执行sql"}]},{"ID":"20230817161814-gcg8fep","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161814-gcg8fep","updated":"20230817161814"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select name,concat_ws(',',collect_set(favor)) as favor_list from student_favors group by name;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161815-niuct4y","Type":"NodeParagraph","Properties":{"id":"20230817161815-niuct4y","updated":"20230817161815"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161816-yzb78r8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161816-yzb78r8","updated":"20230817161816"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"zs      swing,footbal,sing,codeing\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161817-x2k3d65","Type":"NodeParagraph","Properties":{"id":"20230817161817-x2k3d65","updated":"20230817161817"},"Children":[{"Type":"NodeText","Data":"这就是行转列的应用"}]},{"ID":"20230817161818-pjy01fj","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161818-pjy01fj","updated":"20230817161818"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"列转行"}]},{"ID":"20230817161819-eql76yn","Type":"NodeParagraph","Properties":{"id":"20230817161819-eql76yn","updated":"20230817161819"},"Children":[{"Type":"NodeText","Data":"列转行是和刚才的行转列反着来的，列转行可以把一列数据转成多行"}]},{"ID":"20230817161820-m00ezy5","Type":"NodeParagraph","Properties":{"id":"20230817161820-m00ezy5","updated":"20230817161820"},"Children":[{"Type":"NodeText","Data":"主要使用到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"SPLIT()、EXPLODE()和LATERAL VIEW"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"看一下这几个函数"}]},{"ID":"20230817161821-8681thr","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161821-8681thr","updated":"20230817161821"},"Children":[{"ID":"20230817161822-c6lexlq","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161822-c6lexlq","updated":"20230817161822"},"Children":[{"ID":"20230817161823-bxmy1ub","Type":"NodeParagraph","Properties":{"id":"20230817161823-bxmy1ub","updated":"20230817161823"},"Children":[{"Type":"NodeText","Data":"SPLIT()"}]}]}]},{"ID":"20230817161824-9c26mpv","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161824-9c26mpv","updated":"20230817161824"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function SPLIT;\nOK\ntab_name\nSPLIT(str, regex) - Splits str around occurances that match regex\nTime taken: 0.011 seconds, Fetched: 1 row(s)\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161825-v3xkqvh","Type":"NodeParagraph","Properties":{"id":"20230817161825-v3xkqvh","updated":"20230817161825"},"Children":[{"Type":"NodeText","Data":"split函数，接受一个字串符和切割规则，就类似于java中的split函数，使用切割规则对字符串中的数据进行切割，最终返回一个array数组"}]},{"ID":"20230817161826-q7s4q1c","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161826-q7s4q1c","updated":"20230817161826"},"Children":[{"ID":"20230817161827-vdz4lv1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161827-vdz4lv1","updated":"20230817161827"},"Children":[{"ID":"20230817161828-fig4hel","Type":"NodeParagraph","Properties":{"id":"20230817161828-fig4hel","updated":"20230817161828"},"Children":[{"Type":"NodeText","Data":"EXPLODE()"}]}]}]},{"ID":"20230817161829-la41t59","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161829-la41t59","updated":"20230817161829"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e desc function EXPLODE;\nOK\ntab_name\nEXPLODE(a) - separates the elements of array a into multiple rows, or the elements of a map into multiple rows and columns \nTime taken: 0.013 seconds, Fetched: 1 row(s)\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161830-kbjdxme","Type":"NodeParagraph","Properties":{"id":"20230817161830-kbjdxme","updated":"20230817161830"},"Children":[{"Type":"NodeText","Data":"explode函数可以接受array或者map"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"explode(ARRAY)：表示把数组中的每个元素转成一行"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"explode(MAP) ：表示把map中每个key-value对，转成一行，key为一列，value为一列"}]},{"ID":"20230817161831-7ptk8vi","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161831-7ptk8vi","updated":"20230817161831"},"Children":[{"ID":"20230817161832-hwgzakm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161832-hwgzakm","updated":"20230817161832"},"Children":[{"ID":"20230817161833-dpmcdue","Type":"NodeParagraph","Properties":{"id":"20230817161833-dpmcdue","updated":"20230817161833"},"Children":[{"Type":"NodeText","Data":"LATERAL VIEW"}]}]}]},{"ID":"20230817161834-udkmkgw","Type":"NodeParagraph","Properties":{"id":"20230817161834-udkmkgw","updated":"20230817161834"},"Children":[{"Type":"NodeText","Data":"Lateral view 通常和split， explode等函数一起使用。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"split可以对表中的某一列进行切割，返回一个数组类型的字段，explode可以对这个数组中的每一个元素转为一行，lateral view可以对这份数据产生一个支持别名的虚拟表"}]},{"ID":"20230817161835-g307bwo","Type":"NodeParagraph","Properties":{"id":"20230817161835-g307bwo","updated":"20230817161835"},"Children":[{"Type":"NodeText","Data":"原始数据如下"}]},{"ID":"20230817161836-uijjplo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161836-uijjplo","updated":"20230817161836"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 hivedata]# more student_favors_2.data \nzs      swing,footbal,sing\nls      codeing,swing\n代码块123\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161837-kg3qv2q","Type":"NodeParagraph","Properties":{"id":"20230817161837-kg3qv2q","updated":"20230817161837"},"Children":[{"Type":"NodeText","Data":"希望的结果是这样的"}]},{"ID":"20230817161838-vzm9akr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161838-vzm9akr","updated":"20230817161838"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"zs\tswing\nzs\tfootbal\nzs\tsing\nls\tcodeing\nls\tswing\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161839-u845h6o","Type":"NodeParagraph","Properties":{"id":"20230817161839-u845h6o","updated":"20230817161839"},"Children":[{"Type":"NodeText","Data":"接着建表"}]},{"ID":"20230817161840-i88dyky","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161840-i88dyky","updated":"20230817161840"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"create external table student_favors_2(\nname string,  \nfavorlist string\n)row format delimited \nfields terminated by '\\t'\nlocation '/data/student_favors_2';\n代码块123456\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161841-q70pzry","Type":"NodeParagraph","Properties":{"id":"20230817161841-q70pzry","updated":"20230817161841"},"Children":[{"Type":"NodeText","Data":"上传数据"}]},{"ID":"20230817161842-qu9zbcx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161842-qu9zbcx","updated":"20230817161842"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 hivedata]# hdfs dfs -put /data/soft/hivedata/student_favors_2.data /data/student_favors_2\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161843-9kqfrjx","Type":"NodeParagraph","Properties":{"id":"20230817161843-9kqfrjx","updated":"20230817161843"},"Children":[{"Type":"NodeText","Data":"查看数据"}]},{"ID":"20230817161844-ynqyopx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161844-ynqyopx","updated":"20230817161844"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select * from student_favors_2;\nOK\nstudent_favors_2.name   student_favors_2.favorlist\nzs      swing,footbal,sing\nls      codeing,swing\nTime taken: 0.131 seconds, Fetched: 2 row(s)\n代码块123456\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161845-d2bbjzm","Type":"NodeParagraph","Properties":{"id":"20230817161845-d2bbjzm","updated":"20230817161845"},"Children":[{"Type":"NodeText","Data":"先使用split对favorlist字段进行切割"}]},{"ID":"20230817161846-cxn7s9z","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161846-cxn7s9z","updated":"20230817161846"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select split(favorlist,',') from student_favors_2;\nOK\n_c1\n[\"swing\",\"footbal\",\"sing\"]\n[\"codeing\",\"swing\"]\nTime taken: 0.224 seconds, Fetched: 2 row(s)\n代码块123456\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161847-wmco66d","Type":"NodeParagraph","Properties":{"id":"20230817161847-wmco66d","updated":"20230817161847"},"Children":[{"Type":"NodeText","Data":"再使用explode对数据进行操作"}]},{"ID":"20230817161848-tc2zslc","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161848-tc2zslc","updated":"20230817161848"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select explode(split(favorlist,',')) from student_favors_2;\nOK\ncol\nswing\nfootbal\nsing\ncodeing\nswing\nTime taken: 0.185 seconds, Fetched: 5 row(s)\n代码块123456789\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161849-n32jl9d","Type":"NodeParagraph","Properties":{"id":"20230817161849-n32jl9d","updated":"20230817161849"},"Children":[{"Type":"NodeText","Data":"其实到这里已经实现了列转行了，但是还需要把name字段拼接上，这时候就需要使用lateral view了，否则直接查询name字段会报错"}]},{"ID":"20230817161850-n64oj7x","Type":"NodeParagraph","Properties":{"id":"20230817161850-n64oj7x","updated":"20230817161850"},"Children":[{"Type":"NodeText","Data":"lateral view相当于把explode返回的数据作为一个虚拟表来使用了，起名字为table1，然后给这个表里面的那一列数据起一个名字叫favor_new，如果有多个字段，可以再后面指定多个。这样在select后面就可以使用这个名字了，有点类似join操作了"}]},{"ID":"20230817161851-5e2xfx6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161851-5e2xfx6","updated":"20230817161851"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"select name,favor_new from student_favors_2 lateral view explode(split(favorlist, ',')) table1 as favor_new ;\n代码块1\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161852-83xy4m8","Type":"NodeParagraph","Properties":{"id":"20230817161852-83xy4m8","updated":"20230817161852"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161853-iob8q23","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161853-iob8q23","updated":"20230817161853"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"zs      swing\nzs      footbal\nzs      sing\nls      codeing\nls      swing\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161854-jd0twj0","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161854-jd0twj0","updated":"20230817161854"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"Hive排序相关函数"}]},{"ID":"20230817161855-62sas30","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161855-62sas30","updated":"20230817161855"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"ORDER BY"}]},{"ID":"20230817161856-rn9mujq","Type":"NodeParagraph","Properties":{"id":"20230817161856-rn9mujq","updated":"20230817161856"},"Children":[{"Type":"NodeText","Data":"Hive中的order by跟传统的sql语言中的order by作用是一样的，会对查询的结果做一次全局排序，使用这个语句的时候生成的reduce任务只有一个"}]},{"ID":"20230817161857-a55irm7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161857-a55irm7","updated":"20230817161857"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"SORT BY"}]},{"ID":"20230817161858-29ko7m0","Type":"NodeParagraph","Properties":{"id":"20230817161858-29ko7m0","updated":"20230817161858"},"Children":[{"Type":"NodeText","Data":"Hive中指定了sort by，如果有多个reduce，那么在每个reducer端都会做排序，也就是说保证了局部有序（每个reducer出来的数据是有序的，但是不能保证所有的数据是全局有序的，除非只有一个reducer）"}]},{"ID":"20230817161859-f2xb14z","Type":"NodeParagraph","Properties":{"id":"20230817161859-f2xb14z","updated":"20230817161859"},"Children":[{"Type":"NodeText","Data":"使用前面的t2_bak表，表中的数据如下："}]},{"ID":"20230817161860-5178bcu","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161860-5178bcu","updated":"20230817161860"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select * from t2_bak;\nOK\nt2_bak.id       t2_bak.name\n1       NULL\n2       NULL\n3       NULL\n4       NULL\n5       NULL\n1       NULL\n2       NULL\n3       NULL\n4       NULL\n5       NULL\nTime taken: 3.491 seconds, Fetched: 10 row(s)\n代码块1234567891011121314\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161861-i3le96b","Type":"NodeParagraph","Properties":{"id":"20230817161861-i3le96b","updated":"20230817161861"},"Children":[{"Type":"NodeText","Data":"执行排序SQL"}]},{"ID":"20230817161862-72ysk4k","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161862-72ysk4k","updated":"20230817161862"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select id from t2_bak sort by id;\n......\nHadoop job information for Stage-1: number of mappers: 1; number of reducers: 1\n......\nOK\nid\n1\n1\n2\n2\n3\n3\n4\n4\n5\n5\nTime taken: 24.562 seconds, Fetched: 10 row(s)\n代码块1234567891011121314151617\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161863-a791jx8","Type":"NodeParagraph","Properties":{"id":"20230817161863-a791jx8","updated":"20230817161863"},"Children":[{"Type":"NodeText","Data":"刚才我们说sort by是局部有序，为什么最终的结果还是全局有序呢？"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"看里面的日志，现在只有一个reduce任务，所以最终结果还是有序的"}]},{"ID":"20230817161864-n92zssr","Type":"NodeParagraph","Properties":{"id":"20230817161864-n92zssr","updated":"20230817161864"},"Children":[{"Type":"NodeText","Data":"动态设置reduce任务数量为2，然后再执行排序的SQL"}]},{"ID":"20230817161865-q9x9rup","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161865-q9x9rup","updated":"20230817161865"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e set mapreduce.job.reduces = 2;\nhive (default)\u003e select id from t2_bak sort by id;\n.......\nHadoop job information for Stage-1: number of mappers: 1; number of reducers: 2\n......\nOK\nid\n1\n3\n3\n4\n5\n5\n1\n2\n2\n4\nTime taken: 27.943 seconds, Fetched: 10 row(s)\n代码块123456789101112131415161718\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161866-1070yzk","Type":"NodeParagraph","Properties":{"id":"20230817161866-1070yzk","updated":"20230817161866"},"Children":[{"Type":"NodeText","Data":"此时会发现数据就没有全局排序了，因为有多个reduce了。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"不过针对ORDER BY来说，你动态设置再多的reduce数量都没有用，最后还是只产生1个reduce。"}]},{"ID":"20230817161867-lkv8e4n","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161867-lkv8e4n","updated":"20230817161867"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"DISTRIBUTE BY"}]},{"ID":"20230817161868-t1fwykg","Type":"NodeParagraph","Properties":{"id":"20230817161868-t1fwykg","updated":"20230817161868"},"Children":[{"Type":"NodeText","Data":"ditribute by是控制map的输出到reducer是如何划分的"}]},{"ID":"20230817161869-656fge0","Type":"NodeParagraph","Properties":{"id":"20230817161869-656fge0","updated":"20230817161869"},"Children":[{"Type":"NodeText","Data":"ditribute by：只会根据指定的key对数据进行分区，但是不会排序。"}]},{"ID":"20230817161870-wnp7eok","Type":"NodeParagraph","Properties":{"id":"20230817161870-wnp7eok","updated":"20230817161870"},"Children":[{"Type":"NodeText","Data":"一般情况下可以和sort by 结合使用，先对数据分区，再进行排序"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"两者结合使用的时候distribute by必须要写在sort by之前"}]},{"ID":"20230817161871-s7cacoe","Type":"NodeParagraph","Properties":{"id":"20230817161871-s7cacoe","updated":"20230817161871"},"Children":[{"Type":"NodeText","Data":"先来看一下单独ditribute by的使用"}]},{"ID":"20230817161872-8ajyo4t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161872-8ajyo4t","updated":"20230817161872"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e set mapreduce.job.reduces = 2;\nhive (default)\u003e select id from t2_bak distribute by id;\n.......\nNumber of reduce tasks not specified. Defaulting to jobconf value of: 2\n.......\nOK\nid\n4\n2\n4\n2\n5\n3\n1\n5\n3\n1\nTime taken: 25.395 seconds, Fetched: 10 row(s)\n代码块123456789101112131415161718\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161873-sn0aqg8","Type":"NodeParagraph","Properties":{"id":"20230817161873-sn0aqg8","updated":"20230817161873"},"Children":[{"Type":"NodeText","Data":"可以结合sort by实现分区内的排序，默认是升序，可以通过desc来设置倒序"}]},{"ID":"20230817161874-5kln5u0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161874-5kln5u0","updated":"20230817161874"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e set mapreduce.job.reduces = 2;\nhive (default)\u003e select id from t2_bak distribute by id sort by id;\n.......\nNumber of reduce tasks not specified. Defaulting to jobconf value of: 2\n.......\nid\n2\n2\n4\n4\n1\n1\n3\n3\n5\n5\nTime taken: 24.468 seconds, Fetched: 10 row(s)\n代码块1234567891011121314151617\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161875-bvgj41g","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161875-bvgj41g","updated":"20230817161875"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"CLUSTER BY"}]},{"ID":"20230817161876-qljeg6w","Type":"NodeParagraph","Properties":{"id":"20230817161876-qljeg6w","updated":"20230817161876"},"Children":[{"Type":"NodeText","Data":"cluster by的功能就是distribute by和sort by的简写形式"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"也就是 cluster by id 等于 distribute by id sort by id"}]},{"ID":"20230817161877-e9pdxkc","Type":"NodeBlockquote","Properties":{"id":"20230817161877-e9pdxkc","updated":"20230817161877"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161878-uy6szqz","Type":"NodeParagraph","Properties":{"id":"20230817161878-uy6szqz","updated":"20230817161878"},"Children":[{"Type":"NodeText","Data":"注意被cluster by指定的列只能是升序，不能指定asc和desc"}]}]},{"ID":"20230817161879-hp8x3e8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161879-hp8x3e8","updated":"20230817161879"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e set mapreduce.job.reduces = 2;\nhive (default)\u003e select id from t2_bak cluster by id;\n.....\nNumber of reduce tasks not specified. Defaulting to jobconf value of: 2\n.....\nOK\nid\n2\n2\n4\n4\n1\n1\n3\n3\n5\n5\nTime taken: 25.495 seconds, Fetched: 10 row(s)\n代码块123456789101112131415161718\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161880-inebj2w","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161880-inebj2w","updated":"20230817161880"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"Hive 的分组和去重函数"}]},{"ID":"20230817161881-crpmjpo","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161881-crpmjpo","updated":"20230817161881"},"Children":[{"ID":"20230817161882-2cb82kb","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161882-2cb82kb","updated":"20230817161882"},"Children":[{"ID":"20230817161883-8cl7ape","Type":"NodeParagraph","Properties":{"id":"20230817161883-8cl7ape","updated":"20230817161883"},"Children":[{"Type":"NodeText","Data":"GROUP BY ：对数据按照指定字段进行分组"}]}]},{"ID":"20230817161884-ideliqf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161884-ideliqf","updated":"20230817161884"},"Children":[{"ID":"20230817161885-3jycvgt","Type":"NodeParagraph","Properties":{"id":"20230817161885-3jycvgt","updated":"20230817161885"},"Children":[{"Type":"NodeText","Data":"DISTINCT：对数据中指定字段的重复值进行去重"}]}]}]},{"ID":"20230817161886-xsdwzaq","Type":"NodeParagraph","Properties":{"id":"20230817161886-xsdwzaq","updated":"20230817161886"},"Children":[{"Type":"NodeText","Data":"实现"}]},{"ID":"20230817161887-fiaq7so","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161887-fiaq7so","updated":"20230817161887"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"第一种：select count(distinct name) from order\n第二种：select count(tmp.name) from (select name from order group by name) tmp\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161888-9c9103h","Type":"NodeParagraph","Properties":{"id":"20230817161888-9c9103h","updated":"20230817161888"},"Children":[{"Type":"NodeText","Data":"分析"}]},{"ID":"20230817161889-bqcphil","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161889-bqcphil","updated":"20230817161889"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"第一种：使用distinct会将所有的name都shuffle到一个reducer里面，性能较低\n第二种：先对name分组，因为分组的同时其实就是去重，此时是可以并行计算的，然后再计算count即可，性能高。\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]}]}