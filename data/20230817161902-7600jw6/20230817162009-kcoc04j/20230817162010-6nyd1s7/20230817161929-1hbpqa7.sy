{"ID":"20230817161929-1hbpqa7","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161929-1hbpqa7","title":"HBase物理架构","updated":"20230817161929"},"Children":[{"ID":"20230817161930-b6ousij","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161930-b6ousij","updated":"20230817161930"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"HBase物理架构"}]},{"ID":"20230817161931-m7u133m","Type":"NodeParagraph","Properties":{"id":"20230817161931-m7u133m","updated":"20230817161931"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图片描述","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://img.mukewang.com/wiki/612f2cad0931b45f11630660.jpg","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"主要包含以下内容："}]},{"ID":"20230817161932-w8hsqkg","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161932-w8hsqkg","updated":"20230817161932"},"Children":[{"ID":"20230817161933-y1x4zo7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161933-y1x4zo7","updated":"20230817161933"},"Children":[{"ID":"20230817161934-lygr4nc","Type":"NodeParagraph","Properties":{"id":"20230817161934-lygr4nc","updated":"20230817161934"},"Children":[{"Type":"NodeText","Data":"Zookeeper：为HBase集群提供基础服务。"}]}]},{"ID":"20230817161935-l70tzxg","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161935-l70tzxg","updated":"20230817161935"},"Children":[{"ID":"20230817161936-mgf1suc","Type":"NodeParagraph","Properties":{"id":"20230817161936-mgf1suc","updated":"20230817161936"},"Children":[{"Type":"NodeText","Data":"HBase Master：HBase集群的主节点。"}]}]},{"ID":"20230817161937-fmgya4o","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161937-fmgya4o","updated":"20230817161937"},"Children":[{"ID":"20230817161938-jsuu1l2","Type":"NodeParagraph","Properties":{"id":"20230817161938-jsuu1l2","updated":"20230817161938"},"Children":[{"Type":"NodeText","Data":"HBase Regionserver：HBase集群的从节点。"}]}]},{"ID":"20230817161939-fd822wn","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161939-fd822wn","updated":"20230817161939"},"Children":[{"ID":"20230817161940-s9iiftq","Type":"NodeParagraph","Properties":{"id":"20230817161940-s9iiftq","updated":"20230817161940"},"Children":[{"Type":"NodeText","Data":"Client：客户端节点。"}]}]}]},{"ID":"20230817161941-sqsg9r6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161941-sqsg9r6","updated":"20230817161941"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Zookeeper"}]},{"ID":"20230817161942-u6z2a7m","Type":"NodeParagraph","Properties":{"id":"20230817161942-u6z2a7m","updated":"20230817161942"},"Children":[{"Type":"NodeText","Data":"ZooKeeper为HBase集群提供协调服务，它管理着HMaster和HRegionServer的状态(available/alive等)，并且会在HRegionServer宕机时通知给HMaster。"}]},{"ID":"20230817161943-1x5wo0p","Type":"NodeParagraph","Properties":{"id":"20230817161943-1x5wo0p","updated":"20230817161943"},"Children":[{"Type":"NodeText","Data":"ZooKeeper协调HBase集群所有节点的共享信息，在HMaster和HRegionServer连接到ZooKeeper后会创建Ephemeral（临时）节点，并使用心跳机制监控这个节点的存活状态，如果某个临时节点失效，则HMaster会收到通知，并做相应的处理，这块需要通过Watcher监视器实现。"}]},{"ID":"20230817161944-yzwhvbr","Type":"NodeParagraph","Properties":{"id":"20230817161944-yzwhvbr","updated":"20230817161944"},"Children":[{"Type":"NodeText","Data":"另外，HMaster通过监听ZooKeeper中的临时节点(默认：/hbase/rs/*)来监控HRegionServer的加入和宕机。在第一个HMaster连接到ZooKeeper时会创建临时节点(默认：/hbasae/master)来表示Active的HMaster，后面加入进来的HMaster则监听该临时节点，如果当前Active的HMaster宕机，则该临时节点消失，因此其他HMaster会得到通知，然后将自身转换成Active的HMaster，在变为Active的HMaster之前，它会先在/hbase/back-masters/下创建自己的临时节点。"}]},{"ID":"20230817161945-jfy9baw","Type":"NodeParagraph","Properties":{"id":"20230817161945-jfy9baw","updated":"20230817161945"},"Children":[{"Type":"NodeText","Data":"对Zookeeper的作用总结一下，一共有3点："}]},{"ID":"20230817161946-sxfhac0","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230817161946-sxfhac0","updated":"20230817161946"},"Children":[{"ID":"20230817161947-htdhw2k","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230817161947-htdhw2k","updated":"20230817161947"},"Children":[{"ID":"20230817161948-iz9y9ph","Type":"NodeParagraph","Properties":{"id":"20230817161948-iz9y9ph","updated":"20230817161948"},"Children":[{"Type":"NodeText","Data":"Zookeeper维护HBase集群的信息"}]}]},{"ID":"20230817161949-2iiscuu","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230817161949-2iiscuu","updated":"20230817161949"},"Children":[{"ID":"20230817161950-vvoqftp","Type":"NodeParagraph","Properties":{"id":"20230817161950-vvoqftp","updated":"20230817161950"},"Children":[{"Type":"NodeText","Data":"HRegionserver启动的时候会在Zookeeper的/hbase/rs下面创建节点信息"}]}]},{"ID":"20230817161951-omad0a0","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20230817161951-omad0a0","updated":"20230817161951"},"Children":[{"ID":"20230817161952-w78vg9o","Type":"NodeParagraph","Properties":{"id":"20230817161952-w78vg9o","updated":"20230817161952"},"Children":[{"Type":"NodeText","Data":"HMaster会在Zookeeper的/hbase下创建master节点 多余的HMaster会监听这个节点，发现这个节点失效的时候，会接管这个角色。"}]}]}]},{"ID":"20230817161953-2o82r91","Type":"NodeParagraph","Properties":{"id":"20230817161953-2o82r91","updated":"20230817161953"},"Children":[{"Type":"NodeText","Data":"登录Zookeeper，查看HBase的一些节点信息，HBase默认会在Zookeeper的根节点下面创建hbase节点"}]},{"ID":"20230817161954-if46rit","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161954-if46rit","updated":"20230817161954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[zk: localhost:2181(CONNECTED) 0] ls /hbase\n[backup-masters, draining, flush-table-proc, hbaseid, master, master-maintenance, meta-region-server, namespace, online-snapshot, rs, running, splitWAL, switch, table]\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161955-k5lbwf6","Type":"NodeParagraph","Properties":{"id":"20230817161955-k5lbwf6","updated":"20230817161955"},"Children":[{"Type":"NodeText","Data":"在Zookeeper中查看HBase的从节点信息，这里面显示的内容表示目前HBase集群有2个从节点bigdata02和bigdata03"}]},{"ID":"20230817161956-nqyfwoq","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161956-nqyfwoq","updated":"20230817161956"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[zk: localhost:2181(CONNECTED) 1] ls /hbase/rs\n[bigdata02,16020,1777443334673, bigdata03,16020,1777443333539]\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161957-t3y7h34","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161957-t3y7h34","updated":"20230817161957"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"HMaster"}]},{"ID":"20230817161958-5dcyfn3","Type":"NodeParagraph","Properties":{"id":"20230817161958-5dcyfn3","updated":"20230817161958"},"Children":[{"Type":"NodeText","Data":"HMaster是HBase集群的主节点，HBase集群支持多个HMaster节点，可以实现HA。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"通过ZooKeeper的选举机制保证同时只有一个HMaster处于Active状态，其他的HMaster处于备份状态。一般情况下会启动两个HMaster，备份状态的HMaster会定期和Active HMaster通信以获取其最新状态，从而保证它是实时更新的，因此如果启动了多个HMaster反而增加了Active HMaster的负担。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"HMaster主要有以下职责："}]},{"ID":"20230817161959-k8h7xd5","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230817161959-k8h7xd5","updated":"20230817161959"},"Children":[{"ID":"20230817161960-4kvstim","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":3,"Marker":"MQ==","Num":1},"Properties":{"id":"20230817161960-4kvstim","updated":"20230817161960"},"Children":[{"ID":"20230817161961-7jgqxuq","Type":"NodeParagraph","Properties":{"id":"20230817161961-7jgqxuq","updated":"20230817161961"},"Children":[{"Type":"NodeText","Data":"管理HRegionServer，实现其负载均衡。"}]}]},{"ID":"20230817161962-wf8ynio","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":3,"Marker":"Mg==","Num":2},"Properties":{"id":"20230817161962-wf8ynio","updated":"20230817161962"},"Children":[{"ID":"20230817161963-1qqx4pt","Type":"NodeParagraph","Properties":{"id":"20230817161963-1qqx4pt","updated":"20230817161963"},"Children":[{"Type":"NodeText","Data":"管理和分配Region，比如在Region 分裂时分配新的Region；在HRegionServer退出时迁移里面的Region到其他HRegionServer上。"}]}]},{"ID":"20230817161964-1d4suqn","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":3,"Marker":"Mw==","Num":3},"Properties":{"id":"20230817161964-1d4suqn","updated":"20230817161964"},"Children":[{"ID":"20230817161965-8qns5ng","Type":"NodeParagraph","Properties":{"id":"20230817161965-8qns5ng","updated":"20230817161965"},"Children":[{"Type":"NodeText","Data":"管理namespace和table的元数据（这些元数据实际存储在HDFS上面）"}]}]},{"ID":"20230817161966-8l0w50k","Type":"NodeListItem","Data":"4","ListData":{"Typ":1,"Tight":true,"Start":4,"Delimiter":46,"Padding":3,"Marker":"NA==","Num":4},"Properties":{"id":"20230817161966-8l0w50k","updated":"20230817161966"},"Children":[{"ID":"20230817161967-fhfdaa2","Type":"NodeParagraph","Properties":{"id":"20230817161967-fhfdaa2","updated":"20230817161967"},"Children":[{"Type":"NodeText","Data":"权限控制（ACL）"}]}]}]},{"ID":"20230817161968-up00axx","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161968-up00axx","updated":"20230817161968"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"HRegionserver"}]},{"ID":"20230817161969-e9g30dr","Type":"NodeParagraph","Properties":{"id":"20230817161969-e9g30dr","updated":"20230817161969"},"Children":[{"Type":"NodeText","Data":"HRegionserver是HBase集群的从节点。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"HRegionServer一般建议和DataNode部署在同一台机器上，这样可以实现数据的本地化特性，因为DataNode是存储数据的，HBase的数据也是存储在HDFS上的，HRegionServer就是管理数据的，所以这样的话可以尽量保证HRegionServer读取本地的数据，只有磁盘IO，节省了网络IO。"}]}]}