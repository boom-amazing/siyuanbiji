{"ID":"20230817161822-ppzoabc","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161822-ppzoabc","title":"Redis高级特性","updated":"20230817161822"},"Children":[{"ID":"20230817161823-0m3cvt9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161823-0m3cvt9","updated":"20230817161823"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis高级特性"}]},{"ID":"20230817161824-ezp9hi5","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161824-ezp9hi5","updated":"20230817161824"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"expire 生存时间"}]},{"ID":"20230817161825-gmm5zx7","Type":"NodeParagraph","Properties":{"id":"20230817161825-gmm5zx7","updated":"20230817161825"},"Children":[{"Type":"NodeText","Data":"Redis中可以使用expire命令设置一个键的生存时间，到时间后Redis会自动删除它"}]},{"ID":"20230817161826-uewx50e","Type":"NodeBlockquote","Properties":{"id":"20230817161826-uewx50e","updated":"20230817161826"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161827-n3rber7","Type":"NodeParagraph","Properties":{"id":"20230817161827-n3rber7","updated":"20230817161827"},"Children":[{"Type":"NodeText","Data":"它的一个典型应用场景是：手机验证码"}]}]},{"ID":"20230817161828-zm6vcyb","Type":"NodeParagraph","Properties":{"id":"20230817161828-zm6vcyb","updated":"20230817161828"},"Children":[{"Type":"NodeText","Data":"我们平时在登录或者注册的时候，手机会接收到一个验证码，上面会提示验证码的过期时间，过了这个时间之后这个验证码就不能用了。"}]},{"ID":"20230817161829-ry7x8mp","Type":"NodeParagraph","Properties":{"id":"20230817161829-ry7x8mp","updated":"20230817161829"},"Children":[{"Type":"NodeText","Data":"expire支持以下操作"}]},{"ID":"20230817161830-h6vbza8","Type":"NodeTable","Data":"| 命令     | 格式                   | 解释                        |\n| :------- | :--------------------- | :-------------------------- |\n| expire   | expire key seconds     | 设置key的过期时间(单位：秒) |\n| ttl      | ttl key                | 获取key的剩余有效时间       |\n| persist  | persist key            | 取消key的过期时间           |\n| expireat | expireat key timestamp | 设置UNIX时间戳的过期时间    |","TableAligns":[1,1,1],"Properties":{"id":"20230817161830-h6vbza8","updated":"20230817161830"},"Children":[{"Type":"NodeTableHead","Properties":{"id":""},"Children":[{"Type":"NodeTableRow","Properties":{"id":""},"Children":[{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"命令"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"格式"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"解释"}]}]}]},{"Type":"NodeTableRow","TableAligns":[1,1,1],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"expire"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"expire key seconds"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"设置key的过期时间(单位：秒)"}]}]},{"Type":"NodeTableRow","TableAligns":[1,1,1],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"ttl"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"ttl key"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"获取key的剩余有效时间"}]}]},{"Type":"NodeTableRow","TableAligns":[1,1,1],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"persist"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"persist key"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"取消key的过期时间"}]}]},{"Type":"NodeTableRow","TableAligns":[1,1,1],"Properties":{"id":""},"Children":[{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"expireat"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"expireat key timestamp"}]},{"Type":"NodeTableCell","TableCellAlign":1,"Properties":{"id":""},"Children":[{"Type":"NodeText","Data":"设置UNIX时间戳的过期时间"}]}]}]},{"ID":"20230817161831-onmxvi2","Type":"NodeParagraph","Properties":{"id":"20230817161831-onmxvi2","updated":"20230817161831"},"Children":[{"Type":"NodeText","Data":"设置key的过期时间"}]},{"ID":"20230817161832-scembzn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161832-scembzn","updated":"20230817161832"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"127.0.0.1:6379\u003e set abc 123\nOK\n127.0.0.1:6379\u003e expire abc 200\n(integer) 1\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161833-iy1tfwt","Type":"NodeParagraph","Properties":{"id":"20230817161833-iy1tfwt","updated":"20230817161833"},"Children":[{"Type":"NodeText","Data":"获取key的剩余有效时间"}]},{"ID":"20230817161834-rnbuib2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161834-rnbuib2","updated":"20230817161834"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"127.0.0.1:6379\u003e ttl abc\n(integer) 192\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161835-a5yj2ab","Type":"NodeParagraph","Properties":{"id":"20230817161835-a5yj2ab","updated":"20230817161835"},"Children":[{"Type":"NodeText","Data":"取消key的过期时间"}]},{"ID":"20230817161836-dc1q39t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161836-dc1q39t","updated":"20230817161836"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"127.0.0.1:6379\u003e persist abc\n(integer) 1\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161837-nwy9jaz","Type":"NodeParagraph","Properties":{"id":"20230817161837-nwy9jaz","updated":"20230817161837"},"Children":[{"Type":"NodeText","Data":"此时再查看这个key的剩余有效时间，返回的值是-1，-1表示这个key是一个永久存在的key"}]},{"ID":"20230817161838-vtzxp20","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161838-vtzxp20","updated":"20230817161838"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"127.0.0.1:6379\u003e ttl abc\n(integer) -1\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161839-gsekac4","Type":"NodeParagraph","Properties":{"id":"20230817161839-gsekac4","updated":"20230817161839"},"Children":[{"Type":"NodeText","Data":"还可以通过expireat指定key在指定时间点过期"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"先获取当前时间戳"}]},{"ID":"20230817161840-txom9md","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161840-txom9md","updated":"20230817161840"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 ~]# date +%s\n1768618628\n代码块12\n127.0.0.1:6379\u003e expireat abc 1768618638\n(integer) 1\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161841-ap1jugc","Type":"NodeParagraph","Properties":{"id":"20230817161841-ap1jugc","updated":"20230817161841"},"Children":[{"Type":"NodeText","Data":"过一会再查看这个key的剩余有效时间，返回的是-2，表示这个key被删除了，不存在了"}]},{"ID":"20230817161842-imwb18h","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161842-imwb18h","updated":"20230817161842"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"127.0.0.1:6379\u003e ttl abc\n(integer) -2\n127.0.0.1:6379\u003e exists abc\n(integer) 0\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161843-mbnk6lp","Type":"NodeParagraph","Properties":{"id":"20230817161843-mbnk6lp","updated":"20230817161843"},"Children":[{"Type":"NodeText","Data":"总结一下："},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"当key永久存在的时候，执行ttl返回的是-1，"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"当key被设置了过期时间之后，执行ttl返回的就是这个key剩余的有效时间"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"当key已经被删除了，不存在的时候，执行ttl返回的是-2"}]},{"ID":"20230817161844-x6oqhtk","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161844-x6oqhtk","updated":"20230817161844"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"pipeline 管道"}]},{"ID":"20230817161845-uwbfqm4","Type":"NodeParagraph","Properties":{"id":"20230817161845-uwbfqm4","updated":"20230817161845"},"Children":[{"Type":"NodeText","Data":"针对批量操作数据或者批量初始化数据的时候使用，效率高"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis的pipeline功能在命令行中没有实现，在Java客户端(jedis)中是可以使用的"}]},{"ID":"20230817161846-7bgxil5","Type":"NodeParagraph","Properties":{"id":"20230817161846-7bgxil5","updated":"20230817161846"},"Children":[{"Type":"NodeText","Data":"它的原理是这样的"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图片描述","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://img.mukewang.com/wiki/5f5e12a509e5d92d11680738.jpg","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20230817161847-uvokk54","Type":"NodeParagraph","Properties":{"id":"20230817161847-uvokk54","updated":"20230817161847"},"Children":[{"Type":"NodeText","Data":"不使用管道的时候，我们每执行一条命令都需要和redis服务器交互一次"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"使用管道之后，可以实现一次提交一批命令，这一批命令只需要和redis服务器交互一次，所以就提高了性能。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"这个功能就类似于mysql中的batch批处理。"}]},{"ID":"20230817161848-nsnatve","Type":"NodeParagraph","Properties":{"id":"20230817161848-nsnatve","updated":"20230817161848"},"Children":[{"Type":"NodeText","Data":"接下来看一个案例"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"案例：初始化10万条数据"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"需求：使用普通方式一条一条添加和使用管道批量初始化进行对比分析"}]},{"ID":"20230817161849-cy4y8a1","Type":"NodeParagraph","Properties":{"id":"20230817161849-cy4y8a1","updated":"20230817161849"},"Children":[{"Type":"NodeText","Data":"代码如下："}]},{"ID":"20230817161850-uh05ald","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161850-uh05ald","updated":"20230817161850"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"package com.imooc.redis;\n\nimport redis.clients.jedis.Jedis;\nimport redis.clients.jedis.Pipeline;\n\n/**\n * pipeline(管道)的使用\n * Created by xuwei\n */\npublic class PipelineOp {\n    public static void main(String[] args) {\n        //1：不使用管道\n        Jedis jedis = RedisUtils.getJedis();\n        long start_time = System.currentTimeMillis();\n        for(int i=0;i\u003c100000;i++){\n            jedis.set(\"a\"+i,\"a\"+i);\n        }\n        long end_time = System.currentTimeMillis();\n        System.out.println(\"不使用管道，耗时：\"+(end_time-start_time));\n\n        //2：使用管道\n        Pipeline pipelined = jedis.pipelined();\n        start_time = System.currentTimeMillis();\n        for(int i=0;i\u003c100000;i++){\n            pipelined.set(\"b\"+i,\"b\"+i);\n        }\n        pipelined.sync();\n        end_time = System.currentTimeMillis();\n        System.out.println(\"使用管道，耗时：\"+(end_time-start_time));\n\n        RedisUtils.returnResource(jedis);\n    }\n\n}\n代码块12345678910111213141516171819202122232425262728293031323334\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161851-wwcotc8","Type":"NodeParagraph","Properties":{"id":"20230817161851-wwcotc8","updated":"20230817161851"},"Children":[{"Type":"NodeText","Data":"结果如下："}]},{"ID":"20230817161852-z8zcmno","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161852-z8zcmno","updated":"20230817161852"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"不使用管道，耗时：40887\n使用管道，耗时：180\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161853-bqmoqoc","Type":"NodeParagraph","Properties":{"id":"20230817161853-bqmoqoc","updated":"20230817161853"},"Children":[{"Type":"NodeText","Data":"在代码执行的过程中，我们可以使用info命令观察数据库中的数据条数"}]},{"ID":"20230817161854-xwpqnst","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161854-xwpqnst","updated":"20230817161854"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"127.0.0.1:6379\u003e info\n# Keyspace\ndb0:keys=200000,expires=1,avg_ttl=389945\n代码块123\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161855-0riamt1","Type":"NodeParagraph","Properties":{"id":"20230817161855-0riamt1","updated":"20230817161855"},"Children":[{"Type":"NodeText","Data":"从这可以看出来，针对海量数据的初始化，管道可以显著提高初始化性能。"}]},{"ID":"20230817161856-18wv7j8","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161856-18wv7j8","updated":"20230817161856"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"info命令"}]},{"ID":"20230817161857-hl3orky","Type":"NodeParagraph","Properties":{"id":"20230817161857-hl3orky","updated":"20230817161857"},"Children":[{"Type":"NodeText","Data":"这里面参数比较多"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"在这我们主要关注几个重点的参数"}]},{"ID":"20230817161858-erg57sr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161858-erg57sr","updated":"20230817161858"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"# Redis 服务器版本\nredis_version:5.0.9\n# Redis服务的可执行文件路径\nexecutable:/data/soft/redis-5.0.9/redis-server\n# 启动Redis时使用的配置文件路径\nconfig_file:/data/soft/redis-5.0.9/redis.conf\n# 已连接客户端的数量\nconnected_clients:1\n# Redis目前存储数据使用的内容\nused_memory_human:15.01M\n# Redis可以使用的内存总量，和服务器的内存有关\ntotal_system_memory_human:1.78G\n# db0表示0号数据库，keys：表示0号数据库的key总量，expires：表示0号数据库失效被删除的key总量\ndb0:keys=200001,expires=1,avg_ttl=389945\n代码块1234567891011121314\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161859-ezs7wf6","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161859-ezs7wf6","updated":"20230817161859"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis的持久化"}]},{"ID":"20230817161860-sigvev0","Type":"NodeParagraph","Properties":{"id":"20230817161860-sigvev0","updated":"20230817161860"},"Children":[{"Type":"NodeText","Data":"Redis持久化简单理解就是把内存中的数据持久化到磁盘中 可以保证Reids重启之后还能恢复之前的数据"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis支持两种持久化，可以 单独使用 或者 组合使用"}]},{"ID":"20230817161861-okgsihk","Type":"NodeParagraph","Properties":{"id":"20230817161861-okgsihk","updated":"20230817161861"},"Children":[{"Type":"NodeText","Data":"RDB 和 AOF"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"RDB是Redis默认的持久化机制"}]},{"ID":"20230817161862-3n7q37p","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161862-3n7q37p","updated":"20230817161862"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis持久化之RDB"}]},{"ID":"20230817161863-xlsubwj","Type":"NodeParagraph","Properties":{"id":"20230817161863-xlsubwj","updated":"20230817161863"},"Children":[{"Type":"NodeText","Data":"RDB持久化是通过快照完成的，当符合一定条件时Redis会自动将内存中的所有数据执行快照操作并存储到硬盘上，默认存储在"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"dump.rdb"},{"Type":"NodeText","Data":"文件中"}]},{"ID":"20230817161864-l8zlfdl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161864-l8zlfdl","updated":"20230817161864"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# ll\n....\n-rw-r--r--.  1 root root 2955661 Jan 17 12:12 dump.rdb\n......\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161865-mib9v9i","Type":"NodeBlockquote","Properties":{"id":"20230817161865-mib9v9i","updated":"20230817161865"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161866-k6rmjfh","Type":"NodeParagraph","Properties":{"id":"20230817161866-k6rmjfh","updated":"20230817161866"},"Children":[{"Type":"NodeText","Data":"Redis什么时候会执行快照？"}]}]},{"ID":"20230817161867-wki38yi","Type":"NodeParagraph","Properties":{"id":"20230817161867-wki38yi","updated":"20230817161867"},"Children":[{"Type":"NodeText","Data":"Redis执行快照的时机是由以下参数控制的，这些参数是在redis.conf文件中的"}]},{"ID":"20230817161868-mupwsou","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161868-mupwsou","updated":"20230817161868"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"save 900 1\nsave 300 10\nsave 60 10000\n代码块123\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161869-xgge6si","Type":"NodeParagraph","Properties":{"id":"20230817161869-xgge6si","updated":"20230817161869"},"Children":[{"Type":"NodeText","Data":"save 900 1 表示900秒内至少一个key被更改则进行快照"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"这里面的三个时机哪个先满足都会执行快照操作。"}]},{"ID":"20230817161870-ve4s913","Type":"NodeParagraph","Properties":{"id":"20230817161870-ve4s913","updated":"20230817161870"},"Children":[{"Type":"NodeText","Data":"RDB的优点：由于存储的有数据快照文件，恢复数据很方便"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"RDB的缺点：会丢失最后一次快照以后更改的所有数据，因为两次快照之间是由一个时间差的，这一段时间之内修改的数据可能会丢。"}]},{"ID":"20230817161871-lg4vnbe","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161871-lg4vnbe","updated":"20230817161871"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis持久化之AOF"}]},{"ID":"20230817161872-31gae75","Type":"NodeParagraph","Properties":{"id":"20230817161872-31gae75","updated":"20230817161872"},"Children":[{"Type":"NodeText","Data":"AOF持久化是通过日志文件的方式，默认情况下没有开启，可以通过"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"appendonly"},{"Type":"NodeText","Data":"参数开启"}]},{"ID":"20230817161873-2irxd5e","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161873-2irxd5e","updated":"20230817161873"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# vi redis.conf \n....\nappendonly yes\n....\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161874-zr453n8","Type":"NodeParagraph","Properties":{"id":"20230817161874-zr453n8","updated":"20230817161874"},"Children":[{"Type":"NodeText","Data":"AOF日志文件的保存位置和RDB文件相同，都是dir参数设置的，默认的文件名是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"appendonly.aof"}]},{"ID":"20230817161875-3ap5a0n","Type":"NodeBlockquote","Properties":{"id":"20230817161875-3ap5a0n","updated":"20230817161875"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161876-av0q3s0","Type":"NodeParagraph","Properties":{"id":"20230817161876-av0q3s0","updated":"20230817161876"},"Children":[{"Type":"NodeText","Data":"注意：dir参数的值为. 表示当前目录，也就是说我们在哪个目录下启动redis，rdb快照文件和aof日志文件就产生在哪个目录下。"}]}]},{"ID":"20230817161877-eest5rw","Type":"NodeParagraph","Properties":{"id":"20230817161877-eest5rw","updated":"20230817161877"},"Children":[{"Type":"NodeText","Data":"可以试验一下，换一个目录启动redis，发下redis中的数据是空的。关闭之后，重新在之前的目录启动redis，数据又回来了。"}]},{"ID":"20230817161878-219zhti","Type":"NodeParagraph","Properties":{"id":"20230817161878-219zhti","updated":"20230817161878"},"Children":[{"Type":"NodeText","Data":"AOF方式只会记录用户的写命令，添加、修改、删除之类的命令，查询命令不会记录，因为查询命令不会影响数据的内容。"}]},{"ID":"20230817161879-vlibhu5","Type":"NodeParagraph","Properties":{"id":"20230817161879-vlibhu5","updated":"20230817161879"},"Children":[{"Type":"NodeText","Data":"那redis什么时候会把用户的写命令同步到aof文件中呢？"}]},{"ID":"20230817161880-ds7agk4","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161880-ds7agk4","updated":"20230817161880"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"# appendfsync always\nappendfsync everysec\n# appendfsync no\n代码块123\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161881-gdb5jov","Type":"NodeParagraph","Properties":{"id":"20230817161881-gdb5jov","updated":"20230817161881"},"Children":[{"Type":"NodeText","Data":"默认是每秒钟执行一次同步操作。appendfsync everysec"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"也可以实现每执行一次写操作就执行一次同步操作，appendfsync always，但是这样效率会有点低。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"或者使用appendfsync no，表示不主动进行同步，由操作系统来做，30秒执行一次。"}]},{"ID":"20230817161882-qfi1m7v","Type":"NodeParagraph","Properties":{"id":"20230817161882-qfi1m7v","updated":"20230817161882"},"Children":[{"Type":"NodeText","Data":"如果大家对数据的丢失确实是0容忍的话，可以使用always。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"不过一般情况下，redis中存储的都是一些缓存数据，就算丢了也没关系，程序还会继续往里面写新数据，不会造成多大影响。"}]},{"ID":"20230817161883-ry46kks","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161883-ry46kks","updated":"20230817161883"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis 的安全策略"}]},{"ID":"20230817161884-4x5xifj","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161884-4x5xifj","updated":"20230817161884"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"设置数据库密码"}]},{"ID":"20230817161885-2q9x4ro","Type":"NodeParagraph","Properties":{"id":"20230817161885-2q9x4ro","updated":"20230817161885"},"Children":[{"Type":"NodeText","Data":"默认情况下访问redis只要网络能通就可以直接访问，这样其实是有一些不安全的，不过我们一般会限制只能在内网访问，这样其实问题也不大。"}]},{"ID":"20230817161886-88exwvo","Type":"NodeParagraph","Properties":{"id":"20230817161886-88exwvo","updated":"20230817161886"},"Children":[{"Type":"NodeText","Data":"redis针对这个问题，也支持给数据库设置密码，在redis.conf中配置"}]},{"ID":"20230817161887-7biakdd","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161887-7biakdd","updated":"20230817161887"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# vi redis.conf \n....\nrequirepass admin\n....\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161888-0t1b635","Type":"NodeParagraph","Properties":{"id":"20230817161888-0t1b635","updated":"20230817161888"},"Children":[{"Type":"NodeText","Data":"重启redis服务"}]},{"ID":"20230817161889-ng5gfkr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161889-ng5gfkr","updated":"20230817161889"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli shutdown\n[root@bigdata04 redis-5.0.9]# redis-server redis.conf\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161890-d0cl5qx","Type":"NodeParagraph","Properties":{"id":"20230817161890-d0cl5qx","updated":"20230817161890"},"Children":[{"Type":"NodeText","Data":"重新连接redis"}]},{"ID":"20230817161891-d6c0ien","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161891-d6c0ien","updated":"20230817161891"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli \n127.0.0.1:6379\u003e get imooc\n(error) NOAUTH Authentication required.\n127.0.0.1:6379\u003e auth admin\nOK\n127.0.0.1:6379\u003eget imooc\nhello bigdata!\n代码块1234567\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161892-7telvmo","Type":"NodeParagraph","Properties":{"id":"20230817161892-7telvmo","updated":"20230817161892"},"Children":[{"Type":"NodeText","Data":"在代码层面，以后在使用的时候时候就需要使用auth方法先校验权限了。"}]},{"ID":"20230817161893-9ulvbq2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161893-9ulvbq2","updated":"20230817161893"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"package com.imooc.redis;\n\nimport redis.clients.jedis.Jedis;\n\n/**\n * 单连接方式操作redis\n * Created by xuwei\n */\npublic class RedisSingle {\n    /**\n     * 注意：此代码能够正常执行的前提是\n     * 1：redis所在服务器的防火墙需要关闭\n     * 2：redis.conf中的bind参数需要指定192.168.182.103\n     * @param args\n     */\n    public static void main(String[] args) {\n        //获取jedis连接\n        Jedis jedis = new Jedis(\"192.168.182.103\",6379);\n        //使用密码\n        jedis.auth(\"admin\");\n        //向redis中添加数据，key=imooc，value=hello bigdata!\n        jedis.set(\"imooc\",\"hello bigdata!\");\n        //从redis中查询key=imooc的value的值\n        String value = jedis.get(\"imooc\");\n\n        System.out.println(value);\n\n        //关闭jedis连接\n        jedis.close();\n\n    }\n}\n代码块1234567891011121314151617181920212223242526272829303132\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161894-tfbav93","Type":"NodeBlockquote","Properties":{"id":"20230817161894-tfbav93","updated":"20230817161894"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161895-m4nc0l8","Type":"NodeParagraph","Properties":{"id":"20230817161895-m4nc0l8","updated":"20230817161895"},"Children":[{"Type":"NodeText","Data":"注意：在实际工作中一般不会设置密码，因为我们在这设置的密码是明文的，其实意义也不大，针对别有用心的人，你这样设置是没有意义的。"}]}]},{"ID":"20230817161896-mbuu1nx","Type":"NodeParagraph","Properties":{"id":"20230817161896-mbuu1nx","updated":"20230817161896"},"Children":[{"Type":"NodeText","Data":"所以在实际工作中我们一般只需要控制好redis服务器的访问权限就可以了，redis服务器的访问权限其实就是使用bind参数来设置的。"}]},{"ID":"20230817161897-s01pbtn","Type":"NodeParagraph","Properties":{"id":"20230817161897-s01pbtn","updated":"20230817161897"},"Children":[{"Type":"NodeText","Data":"所以再把刚才设置的密码取消掉，直接把对应的配置注释掉即可"}]},{"ID":"20230817161898-k793wlj","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161898-k793wlj","updated":"20230817161898"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# vi redis.conf \n#requirepass admin\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161899-hturqdw","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161899-hturqdw","updated":"20230817161899"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"bind参数的应用"}]},{"ID":"20230817161900-631sxxa","Type":"NodeParagraph","Properties":{"id":"20230817161900-631sxxa","updated":"20230817161900"},"Children":[{"Type":"NodeText","Data":"在实际工作中，我们的服务器至少会有3个ip地址"}]},{"ID":"20230817161901-ptbrfkq","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161901-ptbrfkq","updated":"20230817161901"},"Children":[{"ID":"20230817161902-rs6t1wu","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161902-rs6t1wu","updated":"20230817161902"},"Children":[{"ID":"20230817161903-9bvliva","Type":"NodeParagraph","Properties":{"id":"20230817161903-9bvliva","updated":"20230817161903"},"Children":[{"Type":"NodeText","Data":"127.0.0.1 这个是本机回环地址"}]}]},{"ID":"20230817161904-q6wb1dl","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161904-q6wb1dl","updated":"20230817161904"},"Children":[{"ID":"20230817161905-s66xrro","Type":"NodeParagraph","Properties":{"id":"20230817161905-s66xrro","updated":"20230817161905"},"Children":[{"Type":"NodeText","Data":"192.168.182.103 这个是本机的内网地址"}]}]},{"ID":"20230817161906-ago7hmf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161906-ago7hmf","updated":"20230817161906"},"Children":[{"ID":"20230817161907-gl0vbol","Type":"NodeParagraph","Properties":{"id":"20230817161907-gl0vbol","updated":"20230817161907"},"Children":[{"Type":"NodeText","Data":"还有一个是外网地址"}]}]}]},{"ID":"20230817161908-61asy7y","Type":"NodeParagraph","Properties":{"id":"20230817161908-61asy7y","updated":"20230817161908"},"Children":[{"Type":"NodeText","Data":"我们一般会使用bind绑定内网ip，这样其实就限制了redis服务器的访问范围，不会暴露在外网，只需要运维同学做好网络的访问限制就可以了，此时我们就可以认为redis是安全的了。"}]},{"ID":"20230817161909-ls4ucsv","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161909-ls4ucsv","updated":"20230817161909"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"命令重命名"}]},{"ID":"20230817161910-vz6v2gk","Type":"NodeParagraph","Properties":{"id":"20230817161910-vz6v2gk","updated":"20230817161910"},"Children":[{"Type":"NodeText","Data":"咱们前面讲过一个命令是"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"flushall"},{"Type":"NodeText","Data":"，这个命令是很危险的，它可以把redis中的所有数据全部清空"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"所以在实际工作中一般需要将这个命令给禁用掉，防止误操作。"}]},{"ID":"20230817161911-ig3jpuy","Type":"NodeParagraph","Properties":{"id":"20230817161911-ig3jpuy","updated":"20230817161911"},"Children":[{"Type":"NodeText","Data":"在redis.conf配置文件中进行设置"}]},{"ID":"20230817161912-vuh0b6i","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161912-vuh0b6i","updated":"20230817161912"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# vi redis.conf \n....\nrename-command flushall \"\"\n....\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161913-1egv80h","Type":"NodeParagraph","Properties":{"id":"20230817161913-1egv80h","updated":"20230817161913"},"Children":[{"Type":"NodeText","Data":"这样修改之后，就把flushall命令给禁用掉了"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"重启redis服务"}]},{"ID":"20230817161914-lrtmn5z","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161914-lrtmn5z","updated":"20230817161914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli shutdown\n[root@bigdata04 redis-5.0.9]# redis-server redis.conf\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161915-7h2flqo","Type":"NodeParagraph","Properties":{"id":"20230817161915-7h2flqo","updated":"20230817161915"},"Children":[{"Type":"NodeText","Data":"重新连接redis"}]},{"ID":"20230817161916-r1651es","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161916-r1651es","updated":"20230817161916"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli \n127.0.0.1:6379\u003e flushall\n(error) ERR unknown command `flushall`, with args beginning with: \n127.0.0.1:6379\u003e \n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161917-o2y0g8v","Type":"NodeParagraph","Properties":{"id":"20230817161917-o2y0g8v","updated":"20230817161917"},"Children":[{"Type":"NodeText","Data":"此时会提示未知命令。"}]},{"ID":"20230817161918-78jzpt8","Type":"NodeParagraph","Properties":{"id":"20230817161918-78jzpt8","updated":"20230817161918"},"Children":[{"Type":"NodeText","Data":"其实我们还可以选择，在重命名的时候给这个命令起一个别名，这样后期如果想使用的时候也是可以使用的。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"我们现在在后面直接指定的是空字符串 就是直接禁用了，如果指定一个其它字符串，就相当于起别名了。"}]},{"ID":"20230817161919-i58zus8","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230817161919-i58zus8","updated":"20230817161919"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"Redis监控命令-monitor"}]},{"ID":"20230817161920-ndg825p","Type":"NodeParagraph","Properties":{"id":"20230817161920-ndg825p","updated":"20230817161920"},"Children":[{"Type":"NodeText","Data":"这个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"monitor"},{"Type":"NodeText","Data":"命令是一把双刃剑。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"在实际工作中要慎用。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"先演示一下："}]},{"ID":"20230817161921-7z7jf7r","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161921-7z7jf7r","updated":"20230817161921"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli \n127.0.0.1:6379\u003e monitor\nOK\n代码块123\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161922-vod7lnv","Type":"NodeParagraph","Properties":{"id":"20230817161922-vod7lnv","updated":"20230817161922"},"Children":[{"Type":"NodeText","Data":"执行代码"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"code","TextMarkTextContent":"RedisSingle.java"},{"Type":"NodeText","Data":"中的代码"}]},{"ID":"20230817161923-befdi9m","Type":"NodeParagraph","Properties":{"id":"20230817161923-befdi9m","updated":"20230817161923"},"Children":[{"Type":"NodeText","Data":"然后会发现monitor监控到我们对redis的所有操作"}]},{"ID":"20230817161924-7qjytd8","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161924-7qjytd8","updated":"20230817161924"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli \n127.0.0.1:6379\u003e monitor\nOK\n1768628815.007443 [0 192.168.182.1:60633] \"SET\" \"imooc\" \"hello bigdata!\"\n1768628815.007797 [0 192.168.182.1:60633] \"GET\" \"imooc\"\n代码块12345\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161925-db952i6","Type":"NodeParagraph","Properties":{"id":"20230817161925-db952i6","updated":"20230817161925"},"Children":[{"Type":"NodeText","Data":"monitor可以监控我们对redis的所有操作，如果在线上的服务器上打开了这个功能，这里面就会频繁打印出来我们对redis数据库的所有操作，这样会影响redis的性能，所以说要慎用。"}]},{"ID":"20230817161926-bmycexh","Type":"NodeParagraph","Properties":{"id":"20230817161926-bmycexh","updated":"20230817161926"},"Children":[{"Type":"NodeText","Data":"但是在某些特殊的场景下面它是很有用的"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"之前在工作中我遇到过一个很奇怪的问题，redis中的一个key总是会莫名其妙的消失"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"我的一个程序会定时向redis中写入一个key，但是我发现这个key刚写进去，然后一会就没了，很奇怪，当时我仔细排查了我的代码，里面既没有设置失效时间，也没有使用删除功能。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"所以这个key不是我的代码删的，肯定是有其它的代码会删除这个key，但是到底是哪的代码？"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"这个时候就不好排查了，我们的业务机有几十台，根本无从下手。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"这个时候我突然想到了monitor这个命令，虽然开启monitor会影响redis的性能，但是这个时候需要排查问题，使用一会也是可以接受的。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"所以就打开了monitor，打开之后屏幕上就打印出来很多命令，这样根本就看不清，没办法追踪，数据太多了。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"所以又想到了这个办法，结合grep命令来操作，这样就可以过滤出来对指定key的所有操作了。"}]},{"ID":"20230817161927-fl13931","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161927-fl13931","updated":"20230817161927"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 redis-5.0.9]# redis-cli monitor | grep key\n1768629282.484868 [0 192.168.182.1:52364] \"del\" \"key\"\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161928-f6p3y83","Type":"NodeParagraph","Properties":{"id":"20230817161928-f6p3y83","updated":"20230817161928"},"Children":[{"Type":"NodeText","Data":"通过这条数据我们可以分析出来到底是哪台机器上的程序删除了这个key。然后再排查这台机器上都有哪些程序，对应的去排查代码，这样就快多了，最终发现是有一个代码里面会定时删除这个key。"}]},{"ID":"20230817161929-z2jjsje","Type":"NodeParagraph","Properties":{"id":"20230817161929-z2jjsje","updated":"20230817161929"},"Children":[{"Type":"NodeText","Data":"这个就是monitor的典型应用。"}]}]}