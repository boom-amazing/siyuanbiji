{"ID":"20230817161610-bad4sdc","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161610-bad4sdc","title":"TCP","updated":"20230817161610"},"Children":[{"ID":"20230817161611-qydolw3","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161611-qydolw3","updated":"20230817161611"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"TCP"}]},{"ID":"20230817161612-os9qqep","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161612-os9qqep","updated":"20230817161612"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"TCP基本认识"}]},{"ID":"20230817161613-qzak26n","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161613-qzak26n","updated":"20230817161613"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"tcp头部格式"}]},{"ID":"20230817161614-yjv1gh9","Type":"NodeParagraph","Properties":{"id":"20230817161614-yjv1gh9","updated":"20230817161614"},"Children":[{"Type":"NodeText","Data":"其中几个比较重要的字段"}]},{"ID":"20230817161615-27jkcmo","Type":"NodeParagraph","Properties":{"id":"20230817161615-27jkcmo","updated":"20230817161615"},"Children":[{"Type":"NodeText","Data":"序列号：用来解决网络包乱序的问题"}]},{"ID":"20230817161616-3k2m2yc","Type":"NodeParagraph","Properties":{"id":"20230817161616-3k2m2yc","updated":"20230817161616"},"Children":[{"Type":"NodeText","Data":"确认应答号：用来解决不丢报的问题"}]},{"ID":"20230817161617-szcs7yq","Type":"NodeParagraph","Properties":{"id":"20230817161617-szcs7yq","updated":"20230817161617"},"Children":[{"Type":"NodeText","Data":"控制位："}]},{"ID":"20230817161618-irvq97e","Type":"NodeParagraph","Properties":{"id":"20230817161618-irvq97e","updated":"20230817161618"},"Children":[{"Type":"NodeText","Data":"ACK：该位为1时 确认应答有效 TCP规定除了最初建立连接时的syn包之外该位必须设置为1"}]},{"ID":"20230817161619-o8w8w4q","Type":"NodeParagraph","Properties":{"id":"20230817161619-o8w8w4q","updated":"20230817161619"},"Children":[{"Type":"NodeText","Data":"RST：该位为1 表示TCP连接异常 必须强制断开连接"}]},{"ID":"20230817161620-3khzizh","Type":"NodeParagraph","Properties":{"id":"20230817161620-3khzizh","updated":"20230817161620"},"Children":[{"Type":"NodeText","Data":"SYN：该位为1 表示希望建立连接 并且初始化序列号"}]},{"ID":"20230817161621-0685e3w","Type":"NodeParagraph","Properties":{"id":"20230817161621-0685e3w","updated":"20230817161621"},"Children":[{"Type":"NodeText","Data":"FIN：该位为1 表示今后都不在有数据发送 希望断开连接"}]},{"ID":"20230817161622-cj58rh5","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161622-cj58rh5","updated":"20230817161622"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"为什么需要TCP协议"}]},{"ID":"20230817161623-rte7e57","Type":"NodeParagraph","Properties":{"id":"20230817161623-rte7e57","updated":"20230817161623"},"Children":[{"Type":"NodeText","Data":"因为IP层是不可靠的 他不会保证网络包的交付、也不会保证网络包的按序交付、也不保证网络报数据的完整性"}]},{"ID":"20230817161624-5ikbv38","Type":"NodeParagraph","Properties":{"id":"20230817161624-5ikbv38","updated":"20230817161624"},"Children":[{"Type":"NodeText","Data":"因为TCP是一个工作在传输层的可靠数据传输服务 它能保证数据的传输无损坏、无冗余、无间隔和按序"}]},{"ID":"20230817161625-okuhbf2","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161625-okuhbf2","updated":"20230817161625"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"什么是TCP"}]},{"ID":"20230817161626-lnxno2n","Type":"NodeParagraph","Properties":{"id":"20230817161626-lnxno2n","updated":"20230817161626"},"Children":[{"Type":"NodeText","Data":"tcp是一个面向连接的、可靠地、基于字节流的传输层通信协议"}]},{"ID":"20230817161627-kb8h9me","Type":"NodeParagraph","Properties":{"id":"20230817161627-kb8h9me","updated":"20230817161627"},"Children":[{"Type":"NodeText","Data":"tcp连接是用于保证可靠性和流量控制维护某些状态信息 这些信息的组合包括socket 、序列号、串口大小"}]},{"ID":"20230817161628-5z8vgqo","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161628-5z8vgqo","updated":"20230817161628"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何确定一个TCP连接"}]},{"ID":"20230817161629-r94oi8x","Type":"NodeParagraph","Properties":{"id":"20230817161629-r94oi8x","updated":"20230817161629"},"Children":[{"Type":"NodeText","Data":"通过源地址、源端口、目的地址、目的端口"}]},{"ID":"20230817161630-abtpma5","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161630-abtpma5","updated":"20230817161630"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"TCP与udp的区别***"}]},{"ID":"20230817161631-ftj10tj","Type":"NodeParagraph","Properties":{"id":"20230817161631-ftj10tj","updated":"20230817161631"},"Children":[{"Type":"NodeText","Data":"1、连接"}]},{"ID":"20230817161632-gewsycz","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161632-gewsycz","updated":"20230817161632"},"Children":[{"ID":"20230817161633-tr13jga","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161633-tr13jga","updated":"20230817161633"},"Children":[{"ID":"20230817161634-717fxlm","Type":"NodeParagraph","Properties":{"id":"20230817161634-717fxlm","updated":"20230817161634"},"Children":[{"Type":"NodeText","Data":"tcp是面向连接的传输层协议、传输数据前需要先建立连接"}]}]},{"ID":"20230817161635-iqj2y9i","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161635-iqj2y9i","updated":"20230817161635"},"Children":[{"ID":"20230817161636-3gq2xet","Type":"NodeParagraph","Properties":{"id":"20230817161636-3gq2xet","updated":"20230817161636"},"Children":[{"Type":"NodeText","Data":"UDP是不需要连接 即可传送数据"}]}]}]},{"ID":"20230817161637-oc6jul0","Type":"NodeParagraph","Properties":{"id":"20230817161637-oc6jul0","updated":"20230817161637"},"Children":[{"Type":"NodeText","Data":"2、服务对象"}]},{"ID":"20230817161638-eh0rmvs","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161638-eh0rmvs","updated":"20230817161638"},"Children":[{"ID":"20230817161639-1ngw5zx","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161639-1ngw5zx","updated":"20230817161639"},"Children":[{"ID":"20230817161640-etr6npk","Type":"NodeParagraph","Properties":{"id":"20230817161640-etr6npk","updated":"20230817161640"},"Children":[{"Type":"NodeText","Data":"tcp是一对一的两点服务"}]}]},{"ID":"20230817161641-pdvskgd","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161641-pdvskgd","updated":"20230817161641"},"Children":[{"ID":"20230817161642-ve5yvv0","Type":"NodeParagraph","Properties":{"id":"20230817161642-ve5yvv0","updated":"20230817161642"},"Children":[{"Type":"NodeText","Data":"udp是一对多的多点服务"}]}]}]},{"ID":"20230817161643-s8u2grv","Type":"NodeParagraph","Properties":{"id":"20230817161643-s8u2grv","updated":"20230817161643"},"Children":[{"Type":"NodeText","Data":"3、可靠性"}]},{"ID":"20230817161644-ixujsc5","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161644-ixujsc5","updated":"20230817161644"},"Children":[{"ID":"20230817161645-ysgdfr4","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161645-ysgdfr4","updated":"20230817161645"},"Children":[{"ID":"20230817161646-4s3tf8v","Type":"NodeParagraph","Properties":{"id":"20230817161646-4s3tf8v","updated":"20230817161646"},"Children":[{"Type":"NodeText","Data":"tcp是可靠地交付数据 可以保证数据无差错、不丢失、不冗余、按需到达"}]}]},{"ID":"20230817161647-srx1zqj","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161647-srx1zqj","updated":"20230817161647"},"Children":[{"ID":"20230817161648-tzd4ze1","Type":"NodeParagraph","Properties":{"id":"20230817161648-tzd4ze1","updated":"20230817161648"},"Children":[{"Type":"NodeText","Data":"TCP是尽量满足数据包不丢失"}]}]}]},{"ID":"20230817161649-dz7ul1g","Type":"NodeParagraph","Properties":{"id":"20230817161649-dz7ul1g","updated":"20230817161649"},"Children":[{"Type":"NodeText","Data":"4、流量控制和拥塞控制"}]},{"ID":"20230817161650-jlfmpto","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161650-jlfmpto","updated":"20230817161650"},"Children":[{"ID":"20230817161651-md5wm0f","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161651-md5wm0f","updated":"20230817161651"},"Children":[{"ID":"20230817161652-wegm3z3","Type":"NodeParagraph","Properties":{"id":"20230817161652-wegm3z3","updated":"20230817161652"},"Children":[{"Type":"NodeText","Data":"tcp拥有这两个特性 可以保证数据的安全性"}]}]},{"ID":"20230817161653-0dfghsz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161653-0dfghsz","updated":"20230817161653"},"Children":[{"ID":"20230817161654-tgcz4ii","Type":"NodeParagraph","Properties":{"id":"20230817161654-tgcz4ii","updated":"20230817161654"},"Children":[{"Type":"NodeText","Data":"UDP则没有 即使网络拥堵 也不会影响其效率"}]}]}]},{"ID":"20230817161655-caq0qvs","Type":"NodeParagraph","Properties":{"id":"20230817161655-caq0qvs","updated":"20230817161655"},"Children":[{"Type":"NodeText","Data":"5、首部开销"}]},{"ID":"20230817161656-p5eq3pv","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161656-p5eq3pv","updated":"20230817161656"},"Children":[{"ID":"20230817161657-yqjzy0s","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161657-yqjzy0s","updated":"20230817161657"},"Children":[{"ID":"20230817161658-vtdibie","Type":"NodeParagraph","Properties":{"id":"20230817161658-vtdibie","updated":"20230817161658"},"Children":[{"Type":"NodeText","Data":"udp首部只有8个字节"}]}]},{"ID":"20230817161659-uc4wvik","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161659-uc4wvik","updated":"20230817161659"},"Children":[{"ID":"20230817161660-a92yxbg","Type":"NodeParagraph","Properties":{"id":"20230817161660-a92yxbg","updated":"20230817161660"},"Children":[{"Type":"NodeText","Data":"tcp首部开销 较多"}]}]}]},{"ID":"20230817161661-tvnuzkx","Type":"NodeParagraph","Properties":{"id":"20230817161661-tvnuzkx","updated":"20230817161661"},"Children":[{"Type":"NodeText","Data":"6、传输方式"}]},{"ID":"20230817161662-25rfg5h","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161662-25rfg5h","updated":"20230817161662"},"Children":[{"ID":"20230817161663-3rpdda0","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161663-3rpdda0","updated":"20230817161663"},"Children":[{"ID":"20230817161664-f6po66a","Type":"NodeParagraph","Properties":{"id":"20230817161664-f6po66a","updated":"20230817161664"},"Children":[{"Type":"NodeText","Data":"tcp是流式传送"}]}]},{"ID":"20230817161665-0rm2wlg","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161665-0rm2wlg","updated":"20230817161665"},"Children":[{"ID":"20230817161666-k8qqfnv","Type":"NodeParagraph","Properties":{"id":"20230817161666-k8qqfnv","updated":"20230817161666"},"Children":[{"Type":"NodeText","Data":"udp是一个包一个包传送"}]}]}]},{"ID":"20230817161667-ype6djk","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161667-ype6djk","updated":"20230817161667"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"TCP三次握手的过程和状态变迁*****"}]},{"ID":"20230817161668-hrcef9a","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161668-hrcef9a","updated":"20230817161668"},"Children":[{"ID":"20230817161669-55c3jd1","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161669-55c3jd1","updated":"20230817161669"},"Children":[{"ID":"20230817161670-o58ie0x","Type":"NodeParagraph","Properties":{"id":"20230817161670-o58ie0x","updated":"20230817161670"},"Children":[{"Type":"NodeText","Data":"一开始、客户端和服务端都处于close状态 先是服务端监听某个端口处于listen状态"}]}]},{"ID":"20230817161671-hjrz2xc","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161671-hjrz2xc","updated":"20230817161671"},"Children":[{"ID":"20230817161672-mfkcquz","Type":"NodeParagraph","Properties":{"id":"20230817161672-mfkcquz","updated":"20230817161672"},"Children":[{"Type":"NodeText","Data":"客户端会随机初始化序号 将此序号置于tcp首部字段中  同时把syn置为1 表示syn报文。然后客户端把SYN报文发给服务端表示请求建立连接 该报文是不包含应用层数据 之后客户端处于SYN-SENT状态"}]}]},{"ID":"20230817161673-hiit9w5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161673-hiit9w5","updated":"20230817161673"},"Children":[{"ID":"20230817161674-xkzf97p","Type":"NodeParagraph","Properties":{"id":"20230817161674-xkzf97p","updated":"20230817161674"},"Children":[{"Type":"NodeText","Data":"服务端在收到SYN报文后 也会初始化自己的序列号 并将该序列号填入TCP的首部字段中 同时服务端会将收到的客户端序列号加1填入tcp首部字段的确认应答号中 ，接着把SYN、ACK都置为1 最后把报文发给客户端 此时服务器处于 SYN-RCVD状态"}]}]},{"ID":"20230817161675-gvfotel","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161675-gvfotel","updated":"20230817161675"},"Children":[{"ID":"20230817161676-08dd5q1","Type":"NodeParagraph","Properties":{"id":"20230817161676-08dd5q1","updated":"20230817161676"},"Children":[{"Type":"NodeText","Data":"客户端收到服务端报文后 把服务器发来的序列号+1作为ack填入首部字段 并将ACK设置为1 发送给服务端 这次可以携带应用层数据 此时状态为established状态"}]}]},{"ID":"20230817161677-291t4il","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161677-291t4il","updated":"20230817161677"},"Children":[{"ID":"20230817161678-8h6ddmu","Type":"NodeParagraph","Properties":{"id":"20230817161678-8h6ddmu","updated":"20230817161678"},"Children":[{"Type":"NodeText","Data":"服务端收到ACK报文后 也将连接状态设置为ESTABLISHED状态"}]}]}]},{"ID":"20230817161679-rpcj98f","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161679-rpcj98f","updated":"20230817161679"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"为什么是三次握手而不是两次或者四次"}]},{"ID":"20230817161680-21fssmi","Type":"NodeParagraph","Properties":{"id":"20230817161680-21fssmi","updated":"20230817161680"},"Children":[{"Type":"NodeText","Data":"不是两次的主要原因是为了避免历史连接 在网络拥堵的情况下 客户端发送了多次syn建立报文 如果一个旧的syn报文比最新的syn报文先到达服务端 此时服务端就会回一个syn+ack报文给客户端 客户端在收到后可以根据上下文来判断这个连接是不是历史连接 如果是直接回复RST报文给服务端表示终止历史连接"}]},{"ID":"20230817161681-yi9ku90","Type":"NodeParagraph","Properties":{"id":"20230817161681-yi9ku90","updated":"20230817161681"},"Children":[{"Type":"NodeText","Data":"当然通过三次连接还可以同步双方的序列号 减少双方不必要的资源开销"}]},{"ID":"20230817161682-efayicm","Type":"NodeParagraph","Properties":{"id":"20230817161682-efayicm","updated":"20230817161682"},"Children":[{"Type":"NodeText","Data":"不四次握手的原因是 三次握手理论上已经可以最少可靠建立连接 所以没必要使用过多的通信次数"}]},{"ID":"20230817161683-bzdrlc8","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161683-bzdrlc8","updated":"20230817161683"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"第三次没有收到ACK包会怎样？"}]},{"ID":"20230817161684-5xnkqx2","Type":"NodeParagraph","Properties":{"id":"20230817161684-5xnkqx2","updated":"20230817161684"},"Children":[{"Type":"NodeText","Data":"由于Server没有收到ACK确认，因此会重发之前的SYN+ACK（默认重发五次，之后自动关闭连接），Client收到后会重新传ACK给Server。如果 Client向服务器发送数据，服务器会以RST包响应。"}]},{"ID":"20230817161685-3k3l9f9","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161685-3k3l9f9","updated":"20230817161685"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如果已经建立了连接，但客户端出现了故障怎么办？"}]},{"ID":"20230817161686-ygmzqdr","Type":"NodeParagraph","Properties":{"id":"20230817161686-ygmzqdr","updated":"20230817161686"},"Children":[{"Type":"NodeText","Data":"服务器每收到一次客户端的请求后都会重新复位一个计时器，时间通常是设置为2小时，若两小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75秒钟发送一次。若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。"}]},{"ID":"20230817161687-j08t24v","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161687-j08t24v","updated":"20230817161687"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"初始序列号是什么？"}]},{"ID":"20230817161688-2i1x720","Type":"NodeParagraph","Properties":{"id":"20230817161688-2i1x720","updated":"20230817161688"},"Children":[{"Type":"NodeText","Data":"TCP连接的一方A，随机选择一个32位的序列号作为发送数据的初始序列号，比如为1000，以该序列号为原点，对要传送的数据进行编号：1001、1002...三次握手时，把这个初始序列号传送给另一方B，以便在传输数据时，B可以确认什么样的数据编号是合法的；同时在进行数据传输时，A还可以确认B收到的每一个字节，如果A收到了B的确认编号（acknowledge number）是2001，就说明编号为1001-2000的数据已经被B成功接受。"}]},{"ID":"20230817161689-1k0o0tp","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161689-1k0o0tp","updated":"20230817161689"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Tcp的四次挥手"}]},{"ID":"20230817161690-tmk5fxq","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161690-tmk5fxq","updated":"20230817161690"},"Children":[{"ID":"20230817161691-l9ri1ic","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161691-l9ri1ic","updated":"20230817161691"},"Children":[{"ID":"20230817161692-ss6l734","Type":"NodeParagraph","Properties":{"id":"20230817161692-ss6l734","updated":"20230817161692"},"Children":[{"Type":"NodeText","Data":"客户端首先向服务器发送断开的请求报文fin 然后客户端进入等待状态"}]}]},{"ID":"20230817161693-sp49138","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161693-sp49138","updated":"20230817161693"},"Children":[{"ID":"20230817161694-mpv4wh0","Type":"NodeParagraph","Properties":{"id":"20230817161694-mpv4wh0","updated":"20230817161694"},"Children":[{"Type":"NodeText","Data":"服务器收到断开请求报文之后 向客户端发送确认报文 客户端收到确认报文后继续等待"}]}]},{"ID":"20230817161695-vm3oz60","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161695-vm3oz60","updated":"20230817161695"},"Children":[{"ID":"20230817161696-bv53vh8","Type":"NodeParagraph","Properties":{"id":"20230817161696-bv53vh8","updated":"20230817161696"},"Children":[{"Type":"NodeText","Data":"待服务器处理完所有的数据包的发送和接受后 服务器向客户端发送连接断开报文"}]}]},{"ID":"20230817161697-e3c2dfi","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161697-e3c2dfi","updated":"20230817161697"},"Children":[{"ID":"20230817161698-yrgjpw2","Type":"NodeParagraph","Properties":{"id":"20230817161698-yrgjpw2","updated":"20230817161698"},"Children":[{"Type":"NodeText","Data":"客户端收到服务器的断开报文后 向服务器发送确认报文ack 然后客户端进入timewait状态"}]}]},{"ID":"20230817161699-a5yisrm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161699-a5yisrm","updated":"20230817161699"},"Children":[{"ID":"20230817161700-t6wrcp6","Type":"NodeParagraph","Properties":{"id":"20230817161700-t6wrcp6","updated":"20230817161700"},"Children":[{"Type":"NodeText","Data":"然后服务器收到确认报文后 断开连接"}]}]},{"ID":"20230817161701-owd2vyf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161701-owd2vyf","updated":"20230817161701"},"Children":[{"ID":"20230817161702-chs5s4q","Type":"NodeParagraph","Properties":{"id":"20230817161702-chs5s4q","updated":"20230817161702"},"Children":[{"Type":"NodeText","Data":"客户端在2MSL后 也断开连接"}]}]}]},{"ID":"20230817161703-7yxd940","Type":"NodeParagraph","Properties":{"id":"20230817161703-7yxd940","updated":"20230817161703"},"Children":[{"Type":"NodeText","Data":"因为过程中 发送了两次ACK 和2次FIN所以是四次 那为什么不是三次呢 主要还是因为服务器在收到断开请求时 服务器可能还有数据要处理 等处理完后在发送断开报文 而三次握手确认报文和建立报文是同时发送的"}]},{"ID":"20230817161704-i90rs9d","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161704-i90rs9d","updated":"20230817161704"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"TimeWait为什么要设置为2MSL"}]},{"ID":"20230817161705-55q4k1u","Type":"NodeParagraph","Properties":{"id":"20230817161705-55q4k1u","updated":"20230817161705"},"Children":[{"Type":"NodeText","Data":"MSL(Maximum Segement  Lifetime)是指报文能够在网络中存活的最大时间"}]},{"ID":"20230817161706-l310tcb","Type":"NodeParagraph","Properties":{"id":"20230817161706-l310tcb","updated":"20230817161706"},"Children":[{"Type":"NodeText","Data":"主要有两个原因："}]},{"ID":"20230817161707-phk3206","Type":"NodeParagraph","Properties":{"id":"20230817161707-phk3206","updated":"20230817161707"},"Children":[{"Type":"NodeText","Data":"1、防止新建立连接时接收到旧的数据包"}]},{"ID":"20230817161708-4hgw6va","Type":"NodeParagraph","Properties":{"id":"20230817161708-4hgw6va","updated":"20230817161708"},"Children":[{"Type":"NodeText","Data":"2、保证被动关闭连接的一方能够正确的关闭 既保证最后的ack能够被关闭方接受 从而帮组其正常关闭"}]},{"ID":"20230817161709-j3p5qxh","Type":"NodeParagraph","Properties":{"id":"20230817161709-j3p5qxh","updated":"20230817161709"},"Children":[{"Type":"NodeText","Data":"对于第一点要求 假设时间没有设置为2MSL 设置的时间更短 那么客户端早早的关闭了连接 当相同端口的tcp连接被复用时 过期的报文到达了 那么也会被接受 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"所以设置为2MSL的主要原因是在与能够在这个时间组以保证让两个方向的数据包都被丢弃 使得原来网络连接的数据包被丢失 新出现数据包一定是新建立连接的"}]},{"ID":"20230817161710-mhvuf91","Type":"NodeParagraph","Properties":{"id":"20230817161710-mhvuf91","updated":"20230817161710"},"Children":[{"Type":"NodeText","Data":"而对于第二点要求如果等待时间过短 服务器没有收到最后的ACK 那么服务器就会重新发送fin 这个时候客户端已经关闭了 当下次客户端想要重新建立连接时 因为服务器收到的序列号更预想获得的断开连接的确认号不一致 那么服务器就会拒绝新的连接 "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"而设置为2msl就可以保证服务器即使再没有收到ack报文的确认情况下 服务器也能够再次发送fin报文来重新获取ack来保证连接正确关闭"}]},{"ID":"20230817161711-dxl6oo9","Type":"NodeParagraph","Properties":{"id":"20230817161711-dxl6oo9","updated":"20230817161711"},"Children":[{"Type":"NodeText","Data":"TimeWait时间过多会发生什么状况："}]},{"ID":"20230817161712-2qjzi7j","Type":"NodeParagraph","Properties":{"id":"20230817161712-2qjzi7j","updated":"20230817161712"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"对于客户端 太多端口进入timewait状态 会导致端口的资源被占用 如果端口被占满 就无法发送新的连接"}]},{"ID":"20230817161713-1du73xr","Type":"NodeParagraph","Properties":{"id":"20230817161713-1du73xr","updated":"20230817161713"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"而对于服务端 虽然一个四元组表示一个tcp连接 理论上可以建立很多链接 但是服务器只会监听一个端口"}]},{"ID":"20230817161714-f3egx9r","Type":"NodeParagraph","Properties":{"id":"20230817161714-f3egx9r","updated":"20230817161714"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"而把连接交给处理线程 如果线程池处理不了过多的连接 那么也会导致服务端的系统资源被占满"}]},{"ID":"20230817161715-fa09k70","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161715-fa09k70","updated":"20230817161715"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"重传机制"}]},{"ID":"20230817161716-wnq8sjn","Type":"NodeParagraph","Properties":{"id":"20230817161716-wnq8sjn","updated":"20230817161716"},"Children":[{"Type":"NodeText","Data":"tcp实现可靠传输的方式 是通过序列号和确认应答"}]},{"ID":"20230817161717-rxzep8u","Type":"NodeParagraph","Properties":{"id":"20230817161717-rxzep8u","updated":"20230817161717"},"Children":[{"Type":"NodeText","Data":"针对数据包在传输过程中丢失 会用重传机制来解决"}]},{"ID":"20230817161718-0hj3zuz","Type":"NodeParagraph","Properties":{"id":"20230817161718-0hj3zuz","updated":"20230817161718"},"Children":[{"Type":"NodeText","Data":"常见的四种重传机制："}]},{"ID":"20230817161719-o04vh5z","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161719-o04vh5z","updated":"20230817161719"},"Children":[{"ID":"20230817161720-qsj7b77","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161720-qsj7b77","updated":"20230817161720"},"Children":[{"ID":"20230817161721-ckyqbl3","Type":"NodeParagraph","Properties":{"id":"20230817161721-ckyqbl3","updated":"20230817161721"},"Children":[{"Type":"NodeText","Data":"超时重传"}]}]},{"ID":"20230817161722-182rulu","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161722-182rulu","updated":"20230817161722"},"Children":[{"ID":"20230817161723-mpaopbl","Type":"NodeParagraph","Properties":{"id":"20230817161723-mpaopbl","updated":"20230817161723"},"Children":[{"Type":"NodeText","Data":"快速重传"}]}]},{"ID":"20230817161724-0u4xzzx","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161724-0u4xzzx","updated":"20230817161724"},"Children":[{"ID":"20230817161725-5yek8k4","Type":"NodeParagraph","Properties":{"id":"20230817161725-5yek8k4","updated":"20230817161725"},"Children":[{"Type":"NodeText","Data":"SACK(选择性重传)"}]}]},{"ID":"20230817161726-qnjz59f","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161726-qnjz59f","updated":"20230817161726"},"Children":[{"ID":"20230817161727-zufdiij","Type":"NodeParagraph","Properties":{"id":"20230817161727-zufdiij","updated":"20230817161727"},"Children":[{"Type":"NodeText","Data":"D-SACK 主要用于判断重复数据"}]}]}]},{"ID":"20230817161728-23qbkvt","Type":"NodeParagraph","Properties":{"id":"20230817161728-23qbkvt","updated":"20230817161728"},"Children":[{"Type":"NodeText","Data":"超时重传："}]},{"ID":"20230817161729-5r6qmwo","Type":"NodeParagraph","Properties":{"id":"20230817161729-5r6qmwo","updated":"20230817161729"},"Children":[{"Type":"NodeText","Data":"会在数据包丢失 或者确认应答丢失重传 一般超时重传的时间间隔为一个RTO 略大于2RTT"}]},{"ID":"20230817161730-m2ygnr0","Type":"NodeParagraph","Properties":{"id":"20230817161730-m2ygnr0","updated":"20230817161730"},"Children":[{"Type":"NodeText","Data":"RTT是指数据从网络的一端到另一端的时间"}]},{"ID":"20230817161731-sh53j8n","Type":"NodeParagraph","Properties":{"id":"20230817161731-sh53j8n","updated":"20230817161731"},"Children":[{"Type":"NodeText","Data":"缺点：当RTO过大时 重发就慢 没有效率"}]},{"ID":"20230817161732-fsq7bdr","Type":"NodeParagraph","Properties":{"id":"20230817161732-fsq7bdr","updated":"20230817161732"},"Children":[{"Type":"NodeText","Data":"当RTO过小时 可能会导致重发变快 可能没丢也重发"}]},{"ID":"20230817161733-vpg3h0x","Type":"NodeParagraph","Properties":{"id":"20230817161733-vpg3h0x","updated":"20230817161733"},"Children":[{"Type":"NodeText","Data":"于是有了快速重传"}]},{"ID":"20230817161734-jutkoqq","Type":"NodeParagraph","Properties":{"id":"20230817161734-jutkoqq","updated":"20230817161734"},"Children":[{"Type":"NodeText","Data":"快速重传："}]},{"ID":"20230817161735-fpvnn0y","Type":"NodeParagraph","Properties":{"id":"20230817161735-fpvnn0y","updated":"20230817161735"},"Children":[{"Type":"NodeText","Data":"发送方会依次发送1，2，3，4，5，6分数据包 当收到连续相同的三个ack后 就标明该数据包已经丢失"}]},{"ID":"20230817161736-c4nt0pu","Type":"NodeParagraph","Properties":{"id":"20230817161736-c4nt0pu","updated":"20230817161736"},"Children":[{"Type":"NodeText","Data":"则会重传"}]},{"ID":"20230817161737-j4ci3pl","Type":"NodeParagraph","Properties":{"id":"20230817161737-j4ci3pl","updated":"20230817161737"},"Children":[{"Type":"NodeText","Data":"缺点：不能确定发这三个ack的数据包是否丢失 重传可能会导致数据冗余"}]},{"ID":"20230817161738-lsapeur","Type":"NodeParagraph","Properties":{"id":"20230817161738-lsapeur","updated":"20230817161738"},"Children":[{"Type":"NodeText","Data":"选择性重传："}]},{"ID":"20230817161739-zz5wlfa","Type":"NodeParagraph","Properties":{"id":"20230817161739-zz5wlfa","updated":"20230817161739"},"Children":[{"Type":"NodeText","Data":"也就是在tcp首部字段中加入了sack 即缓存了已经发送的数据"}]},{"ID":"20230817161740-9jl11x1","Type":"NodeParagraph","Properties":{"id":"20230817161740-9jl11x1","updated":"20230817161740"},"Children":[{"Type":"NodeText","Data":"这个时候客户端会根据收到的ack与sack的差值作比较 来判断那段数据丢失了 于是选择性重传"}]},{"ID":"20230817161741-v72dhmr","Type":"NodeParagraph","Properties":{"id":"20230817161741-v72dhmr","updated":"20230817161741"},"Children":[{"Type":"NodeText","Data":"dsack  主要是用来告诉发送方那些数据重复发送了 并且可以让客户端知道是因为服务器ack丢失导致数据重复还是数据包网络延时导致的"}]},{"ID":"20230817161742-opeerjw","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161742-opeerjw","updated":"20230817161742"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"滑动窗口"}]},{"ID":"20230817161743-n59meyt","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161743-n59meyt","updated":"20230817161743"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"引入窗口概念的原因："}]},{"ID":"20230817161744-uufbimt","Type":"NodeParagraph","Properties":{"id":"20230817161744-uufbimt","updated":"20230817161744"},"Children":[{"Type":"NodeText","Data":"Tcp发送数据是去确认应答模式 发送方需要等待接收方确认之后才会发送下一个数据包 通常这样会导致包的往返时间越长 网络的吞吐量就会越低"}]},{"ID":"20230817161745-4s2pxcd","Type":"NodeParagraph","Properties":{"id":"20230817161745-4s2pxcd","updated":"20230817161745"},"Children":[{"Type":"NodeText","Data":"于是乎引入了窗口的概念 窗口大小就是指无需等待 就可以发送数据的最大值"}]},{"ID":"20230817161746-jj5schm","Type":"NodeParagraph","Properties":{"id":"20230817161746-jj5schm","updated":"20230817161746"},"Children":[{"Type":"NodeText","Data":"假设窗口大小是三个tcp字段 那么发送方就可以连续发送三个数据包 即使中途某个接收方回应的ack丢失了 也可以根据后面的ack来判断数据的完整性 进而不用重发 这种方式叫做累计确认"}]},{"ID":"20230817161747-wljxtvc","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161747-wljxtvc","updated":"20230817161747"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"窗口大小由哪方决定呢？"}]},{"ID":"20230817161748-xougd5c","Type":"NodeParagraph","Properties":{"id":"20230817161748-xougd5c","updated":"20230817161748"},"Children":[{"Type":"NodeText","Data":"tcp里有个字段叫做window 即表明窗口大小"}]},{"ID":"20230817161749-j2iqmii","Type":"NodeParagraph","Properties":{"id":"20230817161749-j2iqmii","updated":"20230817161749"},"Children":[{"Type":"NodeText","Data":"这个字段就会告诉发送方直接还有多少缓冲区可以接受数据 于是发送方就会根据这个接收方的处理能力来发送数据 而不会导致接收方处理不过来"}]},{"ID":"20230817161750-sgpmvum","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161750-sgpmvum","updated":"20230817161750"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"发送方的滑动窗口有四个部分"}]},{"ID":"20230817161751-x5gbidg","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161751-x5gbidg","updated":"20230817161751"},"Children":[{"ID":"20230817161752-t6gzp76","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161752-t6gzp76","updated":"20230817161752"},"Children":[{"ID":"20230817161753-c0kujym","Type":"NodeParagraph","Properties":{"id":"20230817161753-c0kujym","updated":"20230817161753"},"Children":[{"Type":"NodeText","Data":"已发送并且收到ack确认的数据"}]}]},{"ID":"20230817161754-k63zbfi","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161754-k63zbfi","updated":"20230817161754"},"Children":[{"ID":"20230817161755-fsb88vj","Type":"NodeParagraph","Properties":{"id":"20230817161755-fsb88vj","updated":"20230817161755"},"Children":[{"Type":"NodeText","Data":"已发送但未收到确认的数据"}]}]},{"ID":"20230817161756-a78xgmq","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161756-a78xgmq","updated":"20230817161756"},"Children":[{"ID":"20230817161757-f539n28","Type":"NodeParagraph","Properties":{"id":"20230817161757-f539n28","updated":"20230817161757"},"Children":[{"Type":"NodeText","Data":"未发送但在接收方处理范围内的数据"}]}]},{"ID":"20230817161758-mpcy0yl","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161758-mpcy0yl","updated":"20230817161758"},"Children":[{"ID":"20230817161759-gu070ug","Type":"NodeParagraph","Properties":{"id":"20230817161759-gu070ug","updated":"20230817161759"},"Children":[{"Type":"NodeText","Data":"未发送但不在接收方处理范围内的数据"}]}]}]},{"ID":"20230817161760-14es7od","Type":"NodeParagraph","Properties":{"id":"20230817161760-14es7od","updated":"20230817161760"},"Children":[{"Type":"NodeText","Data":"程序用三个指针来表示这四个部分"}]},{"ID":"20230817161761-qeh4psg","Type":"NodeParagraph","Properties":{"id":"20230817161761-qeh4psg","updated":"20230817161761"},"Children":[{"Type":"NodeText","Data":"snd.wnd 这个表示窗口大小"}]},{"ID":"20230817161762-sku91iz","Type":"NodeParagraph","Properties":{"id":"20230817161762-sku91iz","updated":"20230817161762"},"Children":[{"Type":"NodeText","Data":"snd.una这个是一个绝对指针 指向已发送但未收到确认的数据的第一个位置"}]},{"ID":"20230817161763-4egd7rw","Type":"NodeParagraph","Properties":{"id":"20230817161763-4egd7rw","updated":"20230817161763"},"Children":[{"Type":"NodeText","Data":"snd.nxt也是一个绝对指针 指向未发送但在接收方处理范围内的数据的第一个位置"}]},{"ID":"20230817161764-cx9tkis","Type":"NodeParagraph","Properties":{"id":"20230817161764-cx9tkis","updated":"20230817161764"},"Children":[{"Type":"NodeText","Data":"可用窗口大小=(sndwnd-(snd.nxt-snd.una))"}]},{"ID":"20230817161765-2q3bq6v","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161765-2q3bq6v","updated":"20230817161765"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"接收方的滑动窗口由三个部分"}]},{"ID":"20230817161766-i4vs3qq","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161766-i4vs3qq","updated":"20230817161766"},"Children":[{"ID":"20230817161767-8lp3sji","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161767-8lp3sji","updated":"20230817161767"},"Children":[{"ID":"20230817161768-5h76c1u","Type":"NodeParagraph","Properties":{"id":"20230817161768-5h76c1u","updated":"20230817161768"},"Children":[{"Type":"NodeText","Data":"已经接受并且确认的数据"}]}]},{"ID":"20230817161769-m67yf86","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161769-m67yf86","updated":"20230817161769"},"Children":[{"ID":"20230817161770-wzh6x4a","Type":"NodeParagraph","Properties":{"id":"20230817161770-wzh6x4a","updated":"20230817161770"},"Children":[{"Type":"NodeText","Data":"未接受但在处理范围内的数据"}]}]},{"ID":"20230817161771-t2nuk7i","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161771-t2nuk7i","updated":"20230817161771"},"Children":[{"ID":"20230817161772-51fox44","Type":"NodeParagraph","Properties":{"id":"20230817161772-51fox44","updated":"20230817161772"},"Children":[{"Type":"NodeText","Data":"未接受但不在处理范围内的数据"}]}]}]},{"ID":"20230817161773-bjao6gx","Type":"NodeParagraph","Properties":{"id":"20230817161773-bjao6gx","updated":"20230817161773"},"Children":[{"Type":"NodeText","Data":"两个指针 rec.wnd 表示窗口大小 rec.nxt指向未接受但在处理范围内的数据的第一个位置"}]},{"ID":"20230817161774-tp4i9s6","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161774-tp4i9s6","updated":"20230817161774"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"接收方的发送方的窗口大小相等吗？"}]},{"ID":"20230817161775-3r126xl","Type":"NodeParagraph","Properties":{"id":"20230817161775-3r126xl","updated":"20230817161775"},"Children":[{"Type":"NodeText","Data":"接收方的窗口大小约等于发送方 因为有可能接收方处理完了发送方发送的数据 通过tcp的window字段来告诉发送方 这个传输过程是有时延的"}]},{"ID":"20230817161776-qzi1yoy","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161776-qzi1yoy","updated":"20230817161776"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"流量控制"}]},{"ID":"20230817161777-wnwdu6q","Type":"NodeParagraph","Properties":{"id":"20230817161777-wnwdu6q","updated":"20230817161777"},"Children":[{"Type":"NodeText","Data":"Tcp提供一种机制能让发送方根据接收方的处理能力发送数据量 这就是所谓的流量控制"}]},{"ID":"20230817161778-xnx54xs","Type":"NodeParagraph","Properties":{"id":"20230817161778-xnx54xs","updated":"20230817161778"},"Children":[{"Type":"NodeText","Data":"说白了流量控制就是通过滑动窗口的大小来实现控制"}]},{"ID":"20230817161779-5uyvwwg","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161779-5uyvwwg","updated":"20230817161779"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"操作系统缓冲区和滑动窗口的关系"}]},{"ID":"20230817161780-pnumgzn","Type":"NodeParagraph","Properties":{"id":"20230817161780-pnumgzn","updated":"20230817161780"},"Children":[{"Type":"NodeText","Data":"滑动窗口和接收窗口所存放的字节数 其实都是放在操作系统的缓冲区中 会被操作系统动态调整"}]},{"ID":"20230817161781-pj0lylp","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161781-pj0lylp","updated":"20230817161781"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"操作系统的缓冲区如何影响滑动窗口呢？"}]},{"ID":"20230817161782-hjezlzv","Type":"NodeParagraph","Properties":{"id":"20230817161782-hjezlzv","updated":"20230817161782"},"Children":[{"Type":"NodeText","Data":"1、如果应用程序没有及时处理缓冲区的数据 那么就会导致窗口一直减小直到为0"}]},{"ID":"20230817161783-qohyhq3","Type":"NodeParagraph","Properties":{"id":"20230817161783-qohyhq3","updated":"20230817161783"},"Children":[{"Type":"NodeText","Data":"2、如果服务器资源非常紧张时 操作系统可能直接减少缓冲区的大小 如果减少缓冲区大小发生在收缩窗口后的话 就会导致数据包的丢失 比如本来接收端告诉发送端我只有100的窗口能够接受数据 响应ack发完之后 操作系统把缓冲区大小减为80 发送方此时发送了100大小的数据 于是乎多的20就丢掉了"}]},{"ID":"20230817161784-nlmv61b","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161784-nlmv61b","updated":"20230817161784"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"如何解决丢包的问题呢？"}]},{"ID":"20230817161785-6s1ulxi","Type":"NodeParagraph","Properties":{"id":"20230817161785-6s1ulxi","updated":"20230817161785"},"Children":[{"Type":"NodeText","Data":"很明显 让减少缓冲区大小的动作 发生在收缩窗口前"}]},{"ID":"20230817161786-laiv5u9","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161786-laiv5u9","updated":"20230817161786"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"窗口关闭"}]},{"ID":"20230817161787-z5xvajf","Type":"NodeParagraph","Properties":{"id":"20230817161787-z5xvajf","updated":"20230817161787"},"Children":[{"Type":"NodeText","Data":"就是指滑动窗口减为0 窗口即关闭"}]},{"ID":"20230817161788-nvju716","Type":"NodeParagraph","Properties":{"id":"20230817161788-nvju716","updated":"20230817161788"},"Children":[{"Type":"NodeText","Data":"但可能发生潜在风险 如果窗口已经减为0  等接收方处理完数据后 又将窗口大小扩大了 但是此时"}]},{"ID":"20230817161789-rboxrrq","Type":"NodeParagraph","Properties":{"id":"20230817161789-rboxrrq","updated":"20230817161789"},"Children":[{"Type":"NodeText","Data":"接收方发给发送方的ack丢失了 那么发送方和接收方都会进入等待状态 陷入死锁"}]},{"ID":"20230817161790-k8wmomf","Type":"NodeParagraph","Properties":{"id":"20230817161790-k8wmomf","updated":"20230817161790"},"Children":[{"Type":"NodeText","Data":"解决办法：只要tcp连接一方 收到窗口为0的统治时 就会启动持续计时器 如果计时器超时 那么就会发送窗口探测报文 如果对方接受到报文就会返回窗口大小 如果连发三次都没有回应 有的tcp可能会发送rst报文来中断连接"}]},{"ID":"20230817161791-j4eysj2","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161791-j4eysj2","updated":"20230817161791"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"糊涂窗口综合征"}]},{"ID":"20230817161792-saa1jpw","Type":"NodeParagraph","Properties":{"id":"20230817161792-saa1jpw","updated":"20230817161792"},"Children":[{"Type":"NodeText","Data":"由于接受方的处理程序不能及时处理缓冲区里的内容 就会收缩窗口 那么当窗口大小变为很小字节数时 比如3字节 发送方依然会发送 这样少量的数据发送是非常浪费系统资源的 就连tcp报文首部都有30字节之多 为了3字节 显然不值"}]},{"ID":"20230817161793-rdmhcb5","Type":"NodeParagraph","Properties":{"id":"20230817161793-rdmhcb5","updated":"20230817161793"},"Children":[{"Type":"NodeText","Data":"解决办法：1、接收方当窗口大小小于min(MSS,缓冲区的二分之一)时 就会像发送方通知窗口大小为0 阻止发送方继续发送数据"}]},{"ID":"20230817161794-p24ylp6","Type":"NodeParagraph","Properties":{"id":"20230817161794-p24ylp6","updated":"20230817161794"},"Children":[{"Type":"NodeText","Data":"2、可以通过nagle算法 让发送方只有数据量\u003eMSS或者 窗口大小\u003eMSS时才会发送数据"}]},{"ID":"20230817161795-gtlzhcz","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161795-gtlzhcz","updated":"20230817161795"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"拥塞控制"}]},{"ID":"20230817161796-ahkxuvv","Type":"NodeParagraph","Properties":{"id":"20230817161796-ahkxuvv","updated":"20230817161796"},"Children":[{"Type":"NodeText","Data":"问题引出 为什么有了流量控制还要有拥塞控制？"}]},{"ID":"20230817161797-8aidr1o","Type":"NodeParagraph","Properties":{"id":"20230817161797-8aidr1o","updated":"20230817161797"},"Children":[{"Type":"NodeText","Data":"主要是因为流量控制只是避免了发送方填满接收方的缓存 但是无法避免网络中因为其他主机通信而导致的网络拥堵"}]},{"ID":"20230817161798-s7fmfmw","Type":"NodeParagraph","Properties":{"id":"20230817161798-s7fmfmw","updated":"20230817161798"},"Children":[{"Type":"NodeText","Data":"拥塞控制的目的就是避免发送方的数据填满整个网络"}]},{"ID":"20230817161799-a9m5wgx","Type":"NodeParagraph","Properties":{"id":"20230817161799-a9m5wgx","updated":"20230817161799"},"Children":[{"Type":"NodeText","Data":"为了调解所要发送的数据量引入了拥塞窗口(cwnd)这个状态变量 他与滑动窗口的关系是"}]},{"ID":"20230817161800-qcrrndp","Type":"NodeParagraph","Properties":{"id":"20230817161800-qcrrndp","updated":"20230817161800"},"Children":[{"Type":"NodeText","Data":"swnd=min(cwnd,rwnd)即滑动窗口的大小为拥塞窗口和接收窗口的最小值"}]},{"ID":"20230817161801-c6y8y40","Type":"NodeParagraph","Properties":{"id":"20230817161801-c6y8y40","updated":"20230817161801"},"Children":[{"Type":"NodeText","Data":"怎么判断网络是否拥塞呢？"}]},{"ID":"20230817161802-uurbyua","Type":"NodeParagraph","Properties":{"id":"20230817161802-uurbyua","updated":"20230817161802"},"Children":[{"Type":"NodeText","Data":"只要发送方没有在规定的时间内收到接收方的响应 也就是发生了超时重传就会认为网络发生了拥塞"}]},{"ID":"20230817161803-9wrjdgg","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161803-9wrjdgg","updated":"20230817161803"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"拥塞控制主要涉及四个算法"}]},{"ID":"20230817161804-saiqrdi","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161804-saiqrdi","updated":"20230817161804"},"Children":[{"ID":"20230817161805-reksslh","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161805-reksslh","updated":"20230817161805"},"Children":[{"ID":"20230817161806-jmwyygg","Type":"NodeParagraph","Properties":{"id":"20230817161806-jmwyygg","updated":"20230817161806"},"Children":[{"Type":"NodeText","Data":"慢启动"}]}]},{"ID":"20230817161807-fu8jajk","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161807-fu8jajk","updated":"20230817161807"},"Children":[{"ID":"20230817161808-b29p904","Type":"NodeParagraph","Properties":{"id":"20230817161808-b29p904","updated":"20230817161808"},"Children":[{"Type":"NodeText","Data":"拥塞避免"}]}]},{"ID":"20230817161809-4w1xix6","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161809-4w1xix6","updated":"20230817161809"},"Children":[{"ID":"20230817161810-9x3bvx2","Type":"NodeParagraph","Properties":{"id":"20230817161810-9x3bvx2","updated":"20230817161810"},"Children":[{"Type":"NodeText","Data":"拥塞发生"}]}]},{"ID":"20230817161811-z4ldkfs","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161811-z4ldkfs","updated":"20230817161811"},"Children":[{"ID":"20230817161812-gapyhcq","Type":"NodeParagraph","Properties":{"id":"20230817161812-gapyhcq","updated":"20230817161812"},"Children":[{"Type":"NodeText","Data":"快速回复"}]}]}]},{"ID":"20230817161813-3u0xvy7","Type":"NodeParagraph","Properties":{"id":"20230817161813-3u0xvy7","updated":"20230817161813"},"Children":[{"Type":"NodeText","Data":"慢启动："}]},{"ID":"20230817161814-pa9qfpu","Type":"NodeParagraph","Properties":{"id":"20230817161814-pa9qfpu","updated":"20230817161814"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"慢启动就是当发送方每收到一个ack 拥塞窗口的大小就会加1"}]},{"ID":"20230817161815-7gsnykw","Type":"NodeParagraph","Properties":{"id":"20230817161815-7gsnykw","updated":"20230817161815"},"Children":[{"Type":"NodeText","Data":"比如初始cwnd大小设置为1 那么当发送方收到一个ack后 就可以发两个 收到两个ack后就可以发四个"}]},{"ID":"20230817161816-938zpyy","Type":"NodeParagraph","Properties":{"id":"20230817161816-938zpyy","updated":"20230817161816"},"Children":[{"Type":"NodeText","Data":"所以说慢启动的拥塞窗口的大小增长是指数级别的"}]},{"ID":"20230817161817-luqmbw0","Type":"NodeParagraph","Properties":{"id":"20230817161817-luqmbw0","updated":"20230817161817"},"Children":[{"Type":"NodeText","Data":"那么涨到什么时候截止呢？"}]},{"ID":"20230817161818-ho7a92z","Type":"NodeParagraph","Properties":{"id":"20230817161818-ho7a92z","updated":"20230817161818"},"Children":[{"Type":"NodeText","Data":"有一个叫做慢启动门限 ssthresh状态变量"}]},{"ID":"20230817161819-mkvqd12","Type":"NodeParagraph","Properties":{"id":"20230817161819-mkvqd12","updated":"20230817161819"},"Children":[{"Type":"NodeText","Data":"当cwnd\u003cssthresh 发生慢启动"}]},{"ID":"20230817161820-vcnrlb9","Type":"NodeParagraph","Properties":{"id":"20230817161820-vcnrlb9","updated":"20230817161820"},"Children":[{"Type":"NodeText","Data":"当cwnd\u003essthresh 进入拥塞避免状态"}]},{"ID":"20230817161821-gatfhlr","Type":"NodeParagraph","Properties":{"id":"20230817161821-gatfhlr","updated":"20230817161821"},"Children":[{"Type":"NodeText","Data":"拥塞避免算法："}]},{"ID":"20230817161822-shbo59x","Type":"NodeParagraph","Properties":{"id":"20230817161822-shbo59x","updated":"20230817161822"},"Children":[{"Type":"NodeText","Data":"当cwnd\u003essthresh后就会启动该算法 一般来说ssthresh为65535字节"}]},{"ID":"20230817161823-hlcb7q5","Type":"NodeParagraph","Properties":{"id":"20230817161823-hlcb7q5","updated":"20230817161823"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"拥塞避免算法的规则是没收到一个ack cwnd增加1/cwnd"}]},{"ID":"20230817161824-oha9x90","Type":"NodeParagraph","Properties":{"id":"20230817161824-oha9x90","updated":"20230817161824"},"Children":[{"Type":"NodeText","Data":"假设ssthresh为8"}]},{"ID":"20230817161825-2qmg2ke","Type":"NodeParagraph","Properties":{"id":"20230817161825-2qmg2ke","updated":"20230817161825"},"Children":[{"Type":"NodeText","Data":"即cwnd窗口到达8后 每收到一个ack就加1/8 于是乎收到8个ack后 也就加1"}]},{"ID":"20230817161826-vsohqio","Type":"NodeParagraph","Properties":{"id":"20230817161826-vsohqio","updated":"20230817161826"},"Children":[{"Type":"NodeText","Data":"所以拥塞避免算法的增长是线性级别的"}]},{"ID":"20230817161827-enbyzmj","Type":"NodeParagraph","Properties":{"id":"20230817161827-enbyzmj","updated":"20230817161827"},"Children":[{"Type":"NodeText","Data":"虽然是线性级别的  当无限增长时 网络会逐渐进入堵塞状态 就有可能发生丢包 然后发生重传"}]},{"ID":"20230817161828-jvva9l5","Type":"NodeParagraph","Properties":{"id":"20230817161828-jvva9l5","updated":"20230817161828"},"Children":[{"Type":"NodeText","Data":"当触发了重传机制后 就会进入拥塞发生算法"}]},{"ID":"20230817161829-ocubaza","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161829-ocubaza","updated":"20230817161829"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"拥塞发生算法"}]},{"ID":"20230817161830-zgy2s3n","Type":"NodeParagraph","Properties":{"id":"20230817161830-zgy2s3n","updated":"20230817161830"},"Children":[{"Type":"NodeText","Data":"数据包重传主要有两种"}]},{"ID":"20230817161831-ebid30v","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161831-ebid30v","updated":"20230817161831"},"Children":[{"ID":"20230817161832-0tqkwkf","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161832-0tqkwkf","updated":"20230817161832"},"Children":[{"ID":"20230817161833-1knlxsi","Type":"NodeParagraph","Properties":{"id":"20230817161833-1knlxsi","updated":"20230817161833"},"Children":[{"Type":"NodeText","Data":"超时重传"}]}]},{"ID":"20230817161834-6xkk0fd","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161834-6xkk0fd","updated":"20230817161834"},"Children":[{"ID":"20230817161835-v3nsxko","Type":"NodeParagraph","Properties":{"id":"20230817161835-v3nsxko","updated":"20230817161835"},"Children":[{"Type":"NodeText","Data":"快速重传"}]}]}]},{"ID":"20230817161836-w6bmf0v","Type":"NodeParagraph","Properties":{"id":"20230817161836-w6bmf0v","updated":"20230817161836"},"Children":[{"Type":"NodeText","Data":"当发生超时重传时 会一夜回到解放前 ssthresh会变为cwnd的1/2 然后cwnd重新从1开始 也就是进入了慢启动状态 这种算法太过于激进 会导致网络出现卡顿"}]},{"ID":"20230817161837-7kgm7ar","Type":"NodeParagraph","Properties":{"id":"20230817161837-7kgm7ar","updated":"20230817161837"},"Children":[{"Type":"NodeText","Data":"所以有更好的办法解决 即基于快速重传的拥塞发生算法 它会将cwnd变为原来的1/2 ssthresh会和cwnd相等 假如cwnd原来为12 那么进入该状态 cwnd和ssthresh都变为6 然后进入快速恢复算法"}]},{"ID":"20230817161838-xra92fu","Type":"NodeHeading","HeadingLevel":6,"Properties":{"id":"20230817161838-xra92fu","updated":"20230817161838"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"###### ","Properties":{"id":""}},{"Type":"NodeText","Data":"快速恢复算法"}]},{"ID":"20230817161839-xh65jff","Type":"NodeParagraph","Properties":{"id":"20230817161839-xh65jff","updated":"20230817161839"},"Children":[{"Type":"NodeText","Data":"快速恢复算法和快速重传是绑定在一起的"}]},{"ID":"20230817161840-36ndbfc","Type":"NodeParagraph","Properties":{"id":"20230817161840-36ndbfc","updated":"20230817161840"},"Children":[{"Type":"NodeText","Data":"快速恢复算法如下："}]},{"ID":"20230817161841-3j8xmz8","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161841-3j8xmz8","updated":"20230817161841"},"Children":[{"ID":"20230817161842-ba6k2wt","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161842-ba6k2wt","updated":"20230817161842"},"Children":[{"ID":"20230817161843-6ypjniu","Type":"NodeParagraph","Properties":{"id":"20230817161843-6ypjniu","updated":"20230817161843"},"Children":[{"Type":"NodeText","Data":"cwnd=ssthresh+3(3代表快速重传收到的ack)"}]}]},{"ID":"20230817161844-ley16xw","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161844-ley16xw","updated":"20230817161844"},"Children":[{"ID":"20230817161845-mr32pm1","Type":"NodeParagraph","Properties":{"id":"20230817161845-mr32pm1","updated":"20230817161845"},"Children":[{"Type":"NodeText","Data":"重传丢失的数据包"}]}]},{"ID":"20230817161846-5sy4wav","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161846-5sy4wav","updated":"20230817161846"},"Children":[{"ID":"20230817161847-v1m4sw8","Type":"NodeParagraph","Properties":{"id":"20230817161847-v1m4sw8","updated":"20230817161847"},"Children":[{"Type":"NodeText","Data":"如果在收到重复的ack 那么cwnd+1"}]}]},{"ID":"20230817161848-s6xgovw","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161848-s6xgovw","updated":"20230817161848"},"Children":[{"ID":"20230817161849-uwa0l7n","Type":"NodeParagraph","Properties":{"id":"20230817161849-uwa0l7n","updated":"20230817161849"},"Children":[{"Type":"NodeText","Data":"如果收到了新的ack后 就会将cwnd设置为第一步中ssthresh的值 也就为6 原因是ack确认了新的数据 说明从重传的ack已经收到 该恢复过程结束 重新进入了拥塞避免的状态"}]}]}]}]}