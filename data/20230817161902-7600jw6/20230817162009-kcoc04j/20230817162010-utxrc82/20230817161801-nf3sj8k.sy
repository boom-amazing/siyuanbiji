{"ID":"20230817161801-nf3sj8k","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161801-nf3sj8k","title":"TSL RSA密匙交换解析","updated":"20230817161801"},"Children":[{"ID":"20230817161802-uudrt2p","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161802-uudrt2p","updated":"20230817161802"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"TSL RSA密匙交换解析"}]},{"ID":"20230817161803-ezriesl","Type":"NodeParagraph","Properties":{"id":"20230817161803-ezriesl","updated":"20230817161803"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第⼀次握⼿"}]},{"ID":"20230817161804-mjmy5hl","Type":"NodeParagraph","Properties":{"id":"20230817161804-mjmy5hl","updated":"20230817161804"},"Children":[{"Type":"NodeText","Data":"客户端⾸先会发⼀个「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Client Hello"},{"Type":"NodeText","Data":"」消息，字⾯意思我们也能理解到，这是跟服务器「打招呼」。"}]},{"ID":"20230817161805-re2f9dv","Type":"NodeParagraph","Properties":{"id":"20230817161805-re2f9dv","updated":"20230817161805"},"Children":[{"Type":"NodeText","Data":"消息⾥⾯有客户端使⽤的 TLS 版本号、⽀持的密码套件列表，以及⽣成的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"随机数（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong strong","TextMarkTextContent":"Client Random"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"）"},{"Type":"NodeText","Data":"，这个随机"}]},{"ID":"20230817161806-exdm19c","Type":"NodeParagraph","Properties":{"id":"20230817161806-exdm19c","updated":"20230817161806"},"Children":[{"Type":"NodeText","Data":"数会被服务端保留，它是⽣成对称加密密钥的材料之⼀。"}]},{"ID":"20230817161807-w71t0v9","Type":"NodeParagraph","Properties":{"id":"20230817161807-w71t0v9","updated":"20230817161807"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第⼆次握⼿"}]},{"ID":"20230817161808-mujd49o","Type":"NodeParagraph","Properties":{"id":"20230817161808-mujd49o","updated":"20230817161808"},"Children":[{"Type":"NodeText","Data":"当服务端收到客户端的「Client Hello」消息后，会确认 TLS 版本号是否⽀持，和从密码套件列表中选择⼀个密码"}]},{"ID":"20230817161809-2ab73wk","Type":"NodeParagraph","Properties":{"id":"20230817161809-2ab73wk","updated":"20230817161809"},"Children":[{"Type":"NodeText","Data":"套件，以及⽣成"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"随机数（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong strong","TextMarkTextContent":"Server Random"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"）"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161810-glhwx08","Type":"NodeParagraph","Properties":{"id":"20230817161810-glhwx08","updated":"20230817161810"},"Children":[{"Type":"NodeText","Data":"接着，返回「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server Hello"},{"Type":"NodeText","Data":"」消息，消息⾥⾯有服务器确认的 TLS 版本号，也给出了随机数（Server Random），"}]},{"ID":"20230817161811-6gpt5c0","Type":"NodeParagraph","Properties":{"id":"20230817161811-6gpt5c0","updated":"20230817161811"},"Children":[{"Type":"NodeText","Data":"然后从客户端的密码套件列表选择了⼀个合适的密码套件。可以看到，服务端选择的密码套件是 “Cipher Suite: TLS_RSA_WITH_AES_128_GCM_SHA256”。"}]},{"ID":"20230817161812-xblx24l","Type":"NodeParagraph","Properties":{"id":"20230817161812-xblx24l","updated":"20230817161812"},"Children":[{"Type":"NodeText","Data":"这个密码套件看起来真让⼈头晕，好⼀⼤串，但是其实它是有固定格式和规范的。基本的形式是「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"密钥交换算法"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"+"}]},{"ID":"20230817161813-t42f2z8","Type":"NodeParagraph","Properties":{"id":"20230817161813-t42f2z8","updated":"20230817161813"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"签名算法"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"+"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"对称加密算法"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"+"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"摘要算法"},{"Type":"NodeText","Data":"」， ⼀般 WITH 单词前⾯有两个单词，第⼀个单词是约定密钥交换的算法，"}]},{"ID":"20230817161814-dpafih5","Type":"NodeParagraph","Properties":{"id":"20230817161814-dpafih5","updated":"20230817161814"},"Children":[{"Type":"NodeText","Data":"第⼆个单词是约定证书的验证算法。⽐如刚才的密码套件的意思就是："}]},{"ID":"20230817161815-m5rbpwq","Type":"NodeParagraph","Properties":{"id":"20230817161815-m5rbpwq","updated":"20230817161815"},"Children":[{"Type":"NodeText","Data":"由于 WITH 单词只有⼀个 RSA，则说明握⼿时密钥交换算法和签名算法都是使⽤ RSA；"}]},{"ID":"20230817161816-ppdjiym","Type":"NodeParagraph","Properties":{"id":"20230817161816-ppdjiym","updated":"20230817161816"},"Children":[{"Type":"NodeText","Data":"握⼿后的通信使⽤ AES 对称算法，密钥⻓度 128 位，分组模式是 GCM；"}]},{"ID":"20230817161817-qncznjo","Type":"NodeParagraph","Properties":{"id":"20230817161817-qncznjo","updated":"20230817161817"},"Children":[{"Type":"NodeText","Data":"摘要算法 SHA384 ⽤于消息认证和产⽣随机数；"}]},{"ID":"20230817161818-v2ucj76","Type":"NodeParagraph","Properties":{"id":"20230817161818-v2ucj76","updated":"20230817161818"},"Children":[{"Type":"NodeText","Data":"就前⾯这两个客户端和服务端相互「打招呼」的过程，客户端和服务端就已确认了 TLS 版本和使⽤的密码套件，"}]},{"ID":"20230817161819-fyztfzs","Type":"NodeParagraph","Properties":{"id":"20230817161819-fyztfzs","updated":"20230817161819"},"Children":[{"Type":"NodeText","Data":"⽽且你可能发现客户端和服务端都会各⾃⽣成⼀个随机数，并且还会把随机数传递给对⽅。"}]},{"ID":"20230817161820-v3wbzi1","Type":"NodeParagraph","Properties":{"id":"20230817161820-v3wbzi1","updated":"20230817161820"},"Children":[{"Type":"NodeText","Data":"那这个随机数有啥⽤呢？其实这两个随机数是后续作为⽣成「会话密钥」的条件，所谓的会话密钥就是数据传输"}]},{"ID":"20230817161821-4alj5bu","Type":"NodeParagraph","Properties":{"id":"20230817161821-4alj5bu","updated":"20230817161821"},"Children":[{"Type":"NodeText","Data":"时，所使⽤的对称加密密钥。"}]},{"ID":"20230817161822-qiy8qmn","Type":"NodeParagraph","Properties":{"id":"20230817161822-qiy8qmn","updated":"20230817161822"},"Children":[{"Type":"NodeText","Data":"然后，服务端为了证明⾃⼰的身份，会发送「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server Certificate"},{"Type":"NodeText","Data":"」给客户端，这个消息⾥含有数字证书。"}]},{"ID":"20230817161823-ykvpd7g","Type":"NodeParagraph","Properties":{"id":"20230817161823-ykvpd7g","updated":"20230817161823"},"Children":[{"Type":"NodeText","Data":"随后，服务端发了「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server Hello Done"},{"Type":"NodeText","Data":"」消息，⽬的是告诉客户端，我已经把该给你的东⻄都给你了，本次打招"}]},{"ID":"20230817161824-4ama9fw","Type":"NodeParagraph","Properties":{"id":"20230817161824-4ama9fw","updated":"20230817161824"},"Children":[{"Type":"NodeText","Data":"呼完毕。"}]},{"ID":"20230817161825-w6pcdit","Type":"NodeParagraph","Properties":{"id":"20230817161825-w6pcdit","updated":"20230817161825"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第三次握⼿"}]},{"ID":"20230817161826-futyyjn","Type":"NodeParagraph","Properties":{"id":"20230817161826-futyyjn","updated":"20230817161826"},"Children":[{"Type":"NodeText","Data":"客户端验证完证书后，认为可信则继续往下⾛。接着，客户端就会⽣成⼀个新的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"随机数"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"("},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong strong","TextMarkTextContent":"pre-master"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":")"},{"Type":"NodeText","Data":"，⽤服务器"}]},{"ID":"20230817161827-rhqslp6","Type":"NodeParagraph","Properties":{"id":"20230817161827-rhqslp6","updated":"20230817161827"},"Children":[{"Type":"NodeText","Data":"的 RSA 公钥加密该随机数，通过「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Change Cipher Key Exchange"},{"Type":"NodeText","Data":"」消息传给服务端。服务端收到后，⽤ RSA 私钥解密，得到客户端发来的随机数 (pre-master)。"}]},{"ID":"20230817161828-kgevqbj","Type":"NodeParagraph","Properties":{"id":"20230817161828-kgevqbj","updated":"20230817161828"},"Children":[{"Type":"NodeText","Data":"⾄此，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"客户端和服务端双⽅都共享了三个随机数，分别是"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Client Random"},{"Type":"NodeText","Data":"**、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong","TextMarkTextContent":"Server Random"},{"Type":"NodeText","Data":"、**"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"pre-master"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161829-8pccvnq","Type":"NodeParagraph","Properties":{"id":"20230817161829-8pccvnq","updated":"20230817161829"},"Children":[{"Type":"NodeText","Data":"于是，双⽅根据已经得到的三个随机数，⽣成"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"会话密钥（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong strong","TextMarkTextContent":"Master Secret"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"）"},{"Type":"NodeText","Data":"，它是对称密钥，⽤于对后续的 HTTP"}]},{"ID":"20230817161830-gbd5fc1","Type":"NodeParagraph","Properties":{"id":"20230817161830-gbd5fc1","updated":"20230817161830"},"Children":[{"Type":"NodeText","Data":"请求/响应的数据加解密。"}]},{"ID":"20230817161831-lf871r8","Type":"NodeParagraph","Properties":{"id":"20230817161831-lf871r8","updated":"20230817161831"},"Children":[{"Type":"NodeText","Data":"⽣成完会话密钥后，然后客户端发⼀个「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Change Cipher Spec"},{"Type":"NodeText","Data":"」，告诉服务端开始使⽤加密⽅式发送消息。"}]},{"ID":"20230817161832-1cxykfi","Type":"NodeParagraph","Properties":{"id":"20230817161832-1cxykfi","updated":"20230817161832"},"Children":[{"Type":"NodeText","Data":"然后，客户端再发⼀个「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Encrypted Handshake Message"},{"Type":"NodeText","Data":"**（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong","TextMarkTextContent":"Finishd"},{"Type":"NodeText","Data":"）**」消息，把之前所有发送的数据做个摘"}]},{"ID":"20230817161833-bu7kmnm","Type":"NodeParagraph","Properties":{"id":"20230817161833-bu7kmnm","updated":"20230817161833"},"Children":[{"Type":"NodeText","Data":"要，再⽤会话密钥（master secret）加密⼀下，让服务器做个验证，验证加密通信是否可⽤和之前握⼿信息是否有"}]},{"ID":"20230817161834-r6o0hm5","Type":"NodeParagraph","Properties":{"id":"20230817161834-r6o0hm5","updated":"20230817161834"},"Children":[{"Type":"NodeText","Data":"被中途篡改过。"}]},{"ID":"20230817161835-9c1vmry","Type":"NodeParagraph","Properties":{"id":"20230817161835-9c1vmry","updated":"20230817161835"},"Children":[{"Type":"NodeText","Data":"可以发现，「Change Cipher Spec」之前传输的 TLS 握⼿数据都是明⽂，之后都是对称密钥加密的密⽂。"}]},{"ID":"20230817161836-g4x98gy","Type":"NodeParagraph","Properties":{"id":"20230817161836-g4x98gy","updated":"20230817161836"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第四次握⼿"}]},{"ID":"20230817161837-27hoz53","Type":"NodeParagraph","Properties":{"id":"20230817161837-27hoz53","updated":"20230817161837"},"Children":[{"Type":"NodeText","Data":"服务器也是同样的操作，发「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Change Cipher Spec"},{"Type":"NodeText","Data":"」和「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Encrypted Handshake Message"},{"Type":"NodeText","Data":"」消息，如果双⽅都"}]},{"ID":"20230817161838-54bj9fk","Type":"NodeParagraph","Properties":{"id":"20230817161838-54bj9fk","updated":"20230817161838"},"Children":[{"Type":"NodeText","Data":"验证加密和解密没问题，那么握⼿正式完成。"}]},{"ID":"20230817161839-1d55z13","Type":"NodeParagraph","Properties":{"id":"20230817161839-1d55z13","updated":"20230817161839"},"Children":[{"Type":"NodeText","Data":"最后，就⽤「会话密钥」加解密 HTTP 请求和响应了。"}]},{"ID":"20230817161840-b7womxw","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161840-b7womxw","updated":"20230817161840"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"RSA缺陷"}]},{"ID":"20230817161841-bvjtm1e","Type":"NodeParagraph","Properties":{"id":"20230817161841-bvjtm1e","updated":"20230817161841"},"Children":[{"Type":"NodeText","Data":"RSA 算法的缺陷"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"使⽤"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"RSA"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"密钥协商算法的最⼤问题是不⽀持前向保密"},{"Type":"NodeText","Data":"。因为客户端传递随机数（⽤于⽣成对称加密密钥的条件之"}]},{"ID":"20230817161842-enjnfoz","Type":"NodeParagraph","Properties":{"id":"20230817161842-enjnfoz","updated":"20230817161842"},"Children":[{"Type":"NodeText","Data":"⼀）给服务端时使⽤的是公钥加密的，服务端收到到后，会⽤私钥解密得到随机数。所以⼀旦服务端的私钥泄漏"}]},{"ID":"20230817161843-nj9fgqm","Type":"NodeParagraph","Properties":{"id":"20230817161843-nj9fgqm","updated":"20230817161843"},"Children":[{"Type":"NodeText","Data":"了，过去被第三⽅截获的所有 TLS 通讯密⽂都会被破解。"}]},{"ID":"20230817161844-vfy6csi","Type":"NodeParagraph","Properties":{"id":"20230817161844-vfy6csi","updated":"20230817161844"},"Children":[{"Type":"NodeText","Data":"为了解决RSA缺陷 也就是不支持前向保密 引入了ECDHE算法"}]},{"ID":"20230817161845-38rrqiv","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161845-38rrqiv","updated":"20230817161845"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"ECDHE密匙交换解析"}]},{"ID":"20230817161846-hss55j1","Type":"NodeParagraph","Properties":{"id":"20230817161846-hss55j1","updated":"20230817161846"},"Children":[{"Type":"NodeText","Data":"DHE 算法由于计算性能不佳，因为需要做⼤ᰁ的乘法，为了提升 DHE 算法的性能，所以就出现了现在⼴泛⽤于密"}]},{"ID":"20230817161847-gknz3y8","Type":"NodeParagraph","Properties":{"id":"20230817161847-gknz3y8","updated":"20230817161847"},"Children":[{"Type":"NodeText","Data":"钥交换算法 —— "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ECDHE"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"算法"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161848-7p6s5ji","Type":"NodeParagraph","Properties":{"id":"20230817161848-7p6s5ji","updated":"20230817161848"},"Children":[{"Type":"NodeText","Data":"ECDHE 算法是在 DHE 算法的基础上利⽤了 ECC 椭圆曲线特性，可以⽤更少的计算算出公钥，以及最终的会"}]},{"ID":"20230817161849-k02f4zj","Type":"NodeParagraph","Properties":{"id":"20230817161849-k02f4zj","updated":"20230817161849"},"Children":[{"Type":"NodeText","Data":"话密钥。"}]},{"ID":"20230817161850-7mdrlki","Type":"NodeParagraph","Properties":{"id":"20230817161850-7mdrlki","updated":"20230817161850"},"Children":[{"Type":"NodeText","Data":"⼩红和⼩明使⽤ ECDHE 密钥交换算法的过程："}]},{"ID":"20230817161851-51fsavd","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161851-51fsavd","updated":"20230817161851"},"Children":[{"ID":"20230817161852-yqz1jne","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161852-yqz1jne","updated":"20230817161852"},"Children":[{"ID":"20230817161853-djokroc","Type":"NodeParagraph","Properties":{"id":"20230817161853-djokroc","updated":"20230817161853"},"Children":[{"Type":"NodeText","Data":"双⽅事先确定好使⽤哪种椭圆曲线，和曲线上的基点 G，这两个参数都是公开的；"}]}]},{"ID":"20230817161854-558rrra","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161854-558rrra","updated":"20230817161854"},"Children":[{"ID":"20230817161855-bjeljnc","Type":"NodeParagraph","Properties":{"id":"20230817161855-bjeljnc","updated":"20230817161855"},"Children":[{"Type":"NodeText","Data":"双⽅各⾃随机⽣成⼀个随机数作为"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"私钥****d"},{"Type":"NodeText","Data":"，并与基点 G相乘得到"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"公钥****Q"},{"Type":"NodeText","Data":"（Q = dG），此时⼩红的公私钥为 Q1"}]},{"ID":"20230817161856-4nave93","Type":"NodeParagraph","Properties":{"id":"20230817161856-4nave93","updated":"20230817161856"},"Children":[{"Type":"NodeText","Data":"和 d1，⼩明的公私钥为 Q2 和 d2；"}]}]},{"ID":"20230817161857-rrm1asx","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161857-rrm1asx","updated":"20230817161857"},"Children":[{"ID":"20230817161858-ua0x53e","Type":"NodeParagraph","Properties":{"id":"20230817161858-ua0x53e","updated":"20230817161858"},"Children":[{"Type":"NodeText","Data":"双⽅交换各⾃的公钥，最后⼩红计算点（x1，y1） = d1Q2，⼩明计算点（x2，y2） = d2Q1，由于椭圆曲线"}]}]},{"ID":"20230817161859-glepkew","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161859-glepkew","updated":"20230817161859"},"Children":[{"ID":"20230817161860-m8vobj7","Type":"NodeParagraph","Properties":{"id":"20230817161860-m8vobj7","updated":"20230817161860"},"Children":[{"Type":"NodeText","Data":"上是可以满⾜乘法交换和结合律，所以 d1Q2 = d1d2G = d2d1G = d2Q1 ，因此"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"双⽅的"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"x"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"坐标是⼀样的，所"}]}]}]},{"ID":"20230817161861-wggr9nj","Type":"NodeParagraph","Properties":{"id":"20230817161861-wggr9nj","updated":"20230817161861"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"以它是共享密钥，也就是会话密钥"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161862-x46hfrv","Type":"NodeParagraph","Properties":{"id":"20230817161862-x46hfrv","updated":"20230817161862"},"Children":[{"Type":"NodeText","Data":"这个过程中，双⽅的私钥都是随机、临时⽣成的，都是不公开的，即使根据公开的信息（椭圆曲线、公钥、基点"}]},{"ID":"20230817161863-0jdiyt1","Type":"NodeParagraph","Properties":{"id":"20230817161863-0jdiyt1","updated":"20230817161863"},"Children":[{"Type":"NodeText","Data":"G）也是很难计算出椭圆曲线上的离散对数（私钥）。"}]},{"ID":"20230817161864-4gq67ax","Type":"NodeParagraph","Properties":{"id":"20230817161864-4gq67ax","updated":"20230817161864"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第⼀次握⼿"}]},{"ID":"20230817161865-wvsz8xv","Type":"NodeParagraph","Properties":{"id":"20230817161865-wvsz8xv","updated":"20230817161865"},"Children":[{"Type":"NodeText","Data":"客户端⾸先会发⼀个「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Client Hello"},{"Type":"NodeText","Data":"」消息，消息⾥⾯有客户端使⽤的 TLS 版本号、⽀持的密码套件列表，以及⽣"}]},{"ID":"20230817161866-69s4blv","Type":"NodeParagraph","Properties":{"id":"20230817161866-69s4blv","updated":"20230817161866"},"Children":[{"Type":"NodeText","Data":"成的"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"随机数（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong strong","TextMarkTextContent":"Client Random"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"）"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161867-ayt2y4y","Type":"NodeParagraph","Properties":{"id":"20230817161867-ayt2y4y","updated":"20230817161867"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第⼆次握⼿"}]},{"ID":"20230817161868-s9fnrn5","Type":"NodeParagraph","Properties":{"id":"20230817161868-s9fnrn5","updated":"20230817161868"},"Children":[{"Type":"NodeText","Data":"服务端收到客户端的「打招呼」，同样也要回礼，会返回「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server Hello"},{"Type":"NodeText","Data":"」消息，消息⾯有服务器确认的 TLS 版本号，也给出了⼀个"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"随机数（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong strong strong","TextMarkTextContent":"Server Random"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"）"},{"Type":"NodeText","Data":"，然后从客户端的密码套件列表选择了⼀个合适的密码套件。不过，这次选择的密码套件就和 RSA 不⼀样了，我们来分析⼀下这次的密码套件的意思。"}]},{"ID":"20230817161869-w4w3c1c","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161869-w4w3c1c","updated":"20230817161869"},"Children":[{"ID":"20230817161870-mov6dsm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161870-mov6dsm","updated":"20230817161870"},"Children":[{"ID":"20230817161871-vawis6x","Type":"NodeParagraph","Properties":{"id":"20230817161871-vawis6x","updated":"20230817161871"},"Children":[{"Type":"NodeText","Data":"「 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384」"}]}]},{"ID":"20230817161872-d98vxd1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161872-d98vxd1","updated":"20230817161872"},"Children":[{"ID":"20230817161873-r4qvwdb","Type":"NodeParagraph","Properties":{"id":"20230817161873-r4qvwdb","updated":"20230817161873"},"Children":[{"Type":"NodeText","Data":"密钥协商算法使⽤ ECDHE；"}]}]},{"ID":"20230817161874-hs2mnwh","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161874-hs2mnwh","updated":"20230817161874"},"Children":[{"ID":"20230817161875-nd32co5","Type":"NodeParagraph","Properties":{"id":"20230817161875-nd32co5","updated":"20230817161875"},"Children":[{"Type":"NodeText","Data":"签名算法使⽤ RSA；"}]}]},{"ID":"20230817161876-x0xltst","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161876-x0xltst","updated":"20230817161876"},"Children":[{"ID":"20230817161877-s1pyl7n","Type":"NodeParagraph","Properties":{"id":"20230817161877-s1pyl7n","updated":"20230817161877"},"Children":[{"Type":"NodeText","Data":"握⼿后的通信使⽤ AES 对称算法，密钥⻓度 256 位，分组模式是 GCM；"}]}]},{"ID":"20230817161878-hepdk1l","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161878-hepdk1l","updated":"20230817161878"},"Children":[{"ID":"20230817161879-dk75qc8","Type":"NodeParagraph","Properties":{"id":"20230817161879-dk75qc8","updated":"20230817161879"},"Children":[{"Type":"NodeText","Data":"摘要算法使⽤ SHA384；"}]}]}]},{"ID":"20230817161880-2cecruc","Type":"NodeParagraph","Properties":{"id":"20230817161880-2cecruc","updated":"20230817161880"},"Children":[{"Type":"NodeText","Data":"接着，服务端为了证明⾃⼰的身份，发送「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Certificate"},{"Type":"NodeText","Data":"」消息，会把证书也发给客户端。"}]},{"ID":"20230817161881-msdmkzu","Type":"NodeParagraph","Properties":{"id":"20230817161881-msdmkzu","updated":"20230817161881"},"Children":[{"Type":"NodeText","Data":"这⼀步就和 RSA 握⼿过程有很⼤到区别了，因为服务端选择了 ECDHE 密钥协商算法，所以会在发送完证书后，"}]},{"ID":"20230817161882-u3svmft","Type":"NodeParagraph","Properties":{"id":"20230817161882-u3svmft","updated":"20230817161882"},"Children":[{"Type":"NodeText","Data":"发送「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server Key Exchange"},{"Type":"NodeText","Data":"」消息。这个过程服务器做了三件事："}]},{"ID":"20230817161883-8julxt7","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161883-8julxt7","updated":"20230817161883"},"Children":[{"ID":"20230817161884-qgiqb41","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161884-qgiqb41","updated":"20230817161884"},"Children":[{"ID":"20230817161885-wi90zcu","Type":"NodeParagraph","Properties":{"id":"20230817161885-wi90zcu","updated":"20230817161885"},"Children":[{"Type":"NodeText","Data":"选择了"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"名为"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"named_curve"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"的椭圆曲线"},{"Type":"NodeText","Data":"，选好了椭圆曲线相当于椭圆曲线基点 G 也定好了，这些都会公开给"}]}]},{"ID":"20230817161886-mj4d6oz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161886-mj4d6oz","updated":"20230817161886"},"Children":[{"ID":"20230817161887-7ye44wn","Type":"NodeParagraph","Properties":{"id":"20230817161887-7ye44wn","updated":"20230817161887"},"Children":[{"Type":"NodeText","Data":"客户端；"}]}]},{"ID":"20230817161888-ezbdukj","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161888-ezbdukj","updated":"20230817161888"},"Children":[{"ID":"20230817161889-bkdj0p7","Type":"NodeParagraph","Properties":{"id":"20230817161889-bkdj0p7","updated":"20230817161889"},"Children":[{"Type":"NodeText","Data":"⽣成随机数作为服务端椭圆曲线的私钥，保留到本地；"}]}]},{"ID":"20230817161890-n9zql8m","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161890-n9zql8m","updated":"20230817161890"},"Children":[{"ID":"20230817161891-qevpu5z","Type":"NodeParagraph","Properties":{"id":"20230817161891-qevpu5z","updated":"20230817161891"},"Children":[{"Type":"NodeText","Data":"根据基点 G 和私钥计算出"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"服务端的椭圆曲线公钥"},{"Type":"NodeText","Data":"，这个会公开给客户端。"}]}]}]},{"ID":"20230817161892-6444csg","Type":"NodeParagraph","Properties":{"id":"20230817161892-6444csg","updated":"20230817161892"},"Children":[{"Type":"NodeText","Data":"为了保证这个椭圆曲线的公钥不被第三⽅篡改，服务端会⽤ RSA 签名算法给服务端的椭圆曲线公钥做个签名。"}]},{"ID":"20230817161893-9y0raun","Type":"NodeParagraph","Properties":{"id":"20230817161893-9y0raun","updated":"20230817161893"},"Children":[{"Type":"NodeText","Data":"随后，就是「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server Hello Done"},{"Type":"NodeText","Data":"」消息，服务端跟客户端表明：“这些就是我提供的信息，打招呼完毕”。"}]},{"ID":"20230817161894-2247j0x","Type":"NodeParagraph","Properties":{"id":"20230817161894-2247j0x","updated":"20230817161894"},"Children":[{"Type":"NodeText","Data":"⾄此，TLS 两次握⼿就已经完成了，⽬前客户端和服务端通过明⽂共享了这⼏个信息："},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Client Random"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"、"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Server"}]},{"ID":"20230817161895-dqkv9h4","Type":"NodeParagraph","Properties":{"id":"20230817161895-dqkv9h4","updated":"20230817161895"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Random"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"、使⽤的椭圆曲线、椭圆曲线基点"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"G"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"、服务端椭圆曲线的公钥"},{"Type":"NodeText","Data":"，这⼏个信息很᯿要，是后续⽣成会话密"}]},{"ID":"20230817161896-8pw31e8","Type":"NodeParagraph","Properties":{"id":"20230817161896-8pw31e8","updated":"20230817161896"},"Children":[{"Type":"NodeText","Data":"钥的材料。"}]},{"ID":"20230817161897-1wn3jf0","Type":"NodeParagraph","Properties":{"id":"20230817161897-1wn3jf0","updated":"20230817161897"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第三次握⼿"}]},{"ID":"20230817161898-b4qsqhd","Type":"NodeParagraph","Properties":{"id":"20230817161898-b4qsqhd","updated":"20230817161898"},"Children":[{"Type":"NodeText","Data":"客户端收到了服务端的证书后，⾃然要校验证书是否合法，如果证书合法，那么服务端到身份就是没问题的。校验"}]},{"ID":"20230817161899-xcozmj2","Type":"NodeParagraph","Properties":{"id":"20230817161899-xcozmj2","updated":"20230817161899"},"Children":[{"Type":"NodeText","Data":"证书到过程，会⾛证书链逐级验证，确认证书的真实性，再⽤证书的公钥验证签名，这样就能确认服务端的身份"}]},{"ID":"20230817161900-o29x7re","Type":"NodeParagraph","Properties":{"id":"20230817161900-o29x7re","updated":"20230817161900"},"Children":[{"Type":"NodeText","Data":"了，确认⽆误后，就可以继续往下⾛。"}]},{"ID":"20230817161901-dpf4rj7","Type":"NodeParagraph","Properties":{"id":"20230817161901-dpf4rj7","updated":"20230817161901"},"Children":[{"Type":"NodeText","Data":"客户端会⽣成⼀个随机数作为客户端椭圆曲线的私钥，然后再根据服务端前⾯给的信息，⽣成"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"客户端的椭圆曲线公"}]},{"ID":"20230817161902-y0s4e8w","Type":"NodeParagraph","Properties":{"id":"20230817161902-y0s4e8w","updated":"20230817161902"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"钥"},{"Type":"NodeText","Data":"，然后⽤「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Client Key Exchange"},{"Type":"NodeText","Data":"」消息发给服务端。⾄此，双⽅都有对⽅的椭圆曲线公钥、⾃⼰的椭圆曲线私钥、椭圆曲线基点 G。于是，双⽅都就计算出点（"}]},{"ID":"20230817161903-n5zaj7q","Type":"NodeParagraph","Properties":{"id":"20230817161903-n5zaj7q","updated":"20230817161903"},"Children":[{"Type":"NodeText","Data":"x，"}]},{"ID":"20230817161904-z0m93z4","Type":"NodeParagraph","Properties":{"id":"20230817161904-z0m93z4","updated":"20230817161904"},"Children":[{"Type":"NodeText","Data":"y），其中 x 坐标值双⽅都是⼀样的，前⾯说 ECDHE 算法时候，说 x 是会话密钥，"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"但实际应⽤中，"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"x"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"还不是最终"}]},{"ID":"20230817161905-rsi2nqk","Type":"NodeParagraph","Properties":{"id":"20230817161905-rsi2nqk","updated":"20230817161905"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"的会话密钥"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161906-ghy7h68","Type":"NodeParagraph","Properties":{"id":"20230817161906-ghy7h68","updated":"20230817161906"},"Children":[{"Type":"NodeText","Data":"还记得 TLS 握⼿阶段，客户端和服务端都会⽣成了⼀个随机数传递给对⽅吗？"}]},{"ID":"20230817161907-erlczh5","Type":"NodeParagraph","Properties":{"id":"20230817161907-erlczh5","updated":"20230817161907"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"最终的会话密钥，就是⽤「客户端随机数"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"+"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"服务端随机数"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"+ x"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"ECDHE"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"算法算出的共享密钥） 」三个材料⽣成"}]},{"ID":"20230817161908-8trkwhk","Type":"NodeParagraph","Properties":{"id":"20230817161908-8trkwhk","updated":"20230817161908"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"的"},{"Type":"NodeText","Data":"。"}]},{"ID":"20230817161909-q2szrgx","Type":"NodeParagraph","Properties":{"id":"20230817161909-q2szrgx","updated":"20230817161909"},"Children":[{"Type":"NodeText","Data":"之所以这么麻烦，是因为 TLS 设计者不信任客户端或服务器「伪随机数」的可靠性，为了保证真正的完全随机，"}]},{"ID":"20230817161910-x6gwe0x","Type":"NodeParagraph","Properties":{"id":"20230817161910-x6gwe0x","updated":"20230817161910"},"Children":[{"Type":"NodeText","Data":"把三个不可靠的随机数混合起来，那么「随机」的程度就⾮常⾼了，⾜够让⿊客计算出最终的会话密钥，安全性更"}]},{"ID":"20230817161911-5aoh0fd","Type":"NodeParagraph","Properties":{"id":"20230817161911-5aoh0fd","updated":"20230817161911"},"Children":[{"Type":"NodeText","Data":"⾼。"}]},{"ID":"20230817161912-nmt4wiw","Type":"NodeParagraph","Properties":{"id":"20230817161912-nmt4wiw","updated":"20230817161912"},"Children":[{"Type":"NodeText","Data":"算好会话密钥后，客户端会发⼀个「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Change Cipher Spec"},{"Type":"NodeText","Data":"」消息，告诉服务端后续改⽤对称算法加密通信。"}]},{"ID":"20230817161913-1h6v0up","Type":"NodeParagraph","Properties":{"id":"20230817161913-1h6v0up","updated":"20230817161913"},"Children":[{"Type":"NodeText","Data":"接着，客户端会发「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Encrypted Handshake Message"},{"Type":"NodeText","Data":"」消息，把之前发送的数据做⼀个摘要，再⽤对称密钥加密"}]},{"ID":"20230817161914-4wvyofs","Type":"NodeParagraph","Properties":{"id":"20230817161914-4wvyofs","updated":"20230817161914"},"Children":[{"Type":"NodeText","Data":"⼀下，让服务端做个验证，验证下本次⽣成的对称密钥是否可以正常使⽤。"}]},{"ID":"20230817161915-21tm27o","Type":"NodeParagraph","Properties":{"id":"20230817161915-21tm27o","updated":"20230817161915"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"TLS"},{"Type":"NodeText","Data":" "},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"第四次握⼿"}]},{"ID":"20230817161916-vjbb1d4","Type":"NodeParagraph","Properties":{"id":"20230817161916-vjbb1d4","updated":"20230817161916"},"Children":[{"Type":"NodeText","Data":"最后，服务端也会有⼀个同样的操作，发「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Change Cipher Spec"},{"Type":"NodeText","Data":"」和「"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"Encrypted Handshake Message"},{"Type":"NodeText","Data":"」消"}]},{"ID":"20230817161917-l9uvsdr","Type":"NodeParagraph","Properties":{"id":"20230817161917-l9uvsdr","updated":"20230817161917"},"Children":[{"Type":"NodeText","Data":"息，如果双⽅都验证加密和解密没问题，那么握⼿正式完成。于是，就可以正常收发加密的 HTTP 请求和响应了。总结"}]},{"ID":"20230817161918-shz3p4b","Type":"NodeParagraph","Properties":{"id":"20230817161918-shz3p4b","updated":"20230817161918"},"Children":[{"Type":"NodeText","Data":"RSA 和 ECDHE 握⼿过程的区别："}]},{"ID":"20230817161919-qh4igcw","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161919-qh4igcw","updated":"20230817161919"},"Children":[{"ID":"20230817161920-j3pfcw7","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161920-j3pfcw7","updated":"20230817161920"},"Children":[{"ID":"20230817161921-8uf8xeb","Type":"NodeParagraph","Properties":{"id":"20230817161921-8uf8xeb","updated":"20230817161921"},"Children":[{"Type":"NodeText","Data":"RSA 密钥协商算法「不⽀持」前向保密，ECDHE 密钥协商算法「⽀持」前向保密；"}]}]},{"ID":"20230817161922-05m3mfh","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161922-05m3mfh","updated":"20230817161922"},"Children":[{"ID":"20230817161923-dfgw0de","Type":"NodeParagraph","Properties":{"id":"20230817161923-dfgw0de","updated":"20230817161923"},"Children":[{"Type":"NodeText","Data":"使⽤了 RSA 密钥协商算法，TLS 完成四次握⼿后，才能进⾏应⽤数据传输，⽽对于 ECDHE 算法，客户端可"}]}]},{"ID":"20230817161924-kcevsn5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161924-kcevsn5","updated":"20230817161924"},"Children":[{"ID":"20230817161925-3tkjwvi","Type":"NodeParagraph","Properties":{"id":"20230817161925-3tkjwvi","updated":"20230817161925"},"Children":[{"Type":"NodeText","Data":"以不⽤等服务端的最后⼀次 TLS 握⼿，就可以提前发出加密的 HTTP 数据，节省了⼀个消息的往返时间；"}]}]},{"ID":"20230817161926-ia4cdek","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161926-ia4cdek","updated":"20230817161926"},"Children":[{"ID":"20230817161927-geo0hl5","Type":"NodeParagraph","Properties":{"id":"20230817161927-geo0hl5","updated":"20230817161927"},"Children":[{"Type":"NodeText","Data":"使⽤ ECDHE， 在 TLS 第 2 次握⼿中，会出现服务器端发出的「Server Key Exchange」消息，⽽ RSA 握⼿"}]}]},{"ID":"20230817161928-145bl9k","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161928-145bl9k","updated":"20230817161928"},"Children":[{"ID":"20230817161929-c3klbmc","Type":"NodeParagraph","Properties":{"id":"20230817161929-c3klbmc","updated":"20230817161929"},"Children":[{"Type":"NodeText","Data":"过程没有该消息；"}]}]}]}]}