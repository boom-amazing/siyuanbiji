{"ID":"20230817161927-6dl96o0","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161927-6dl96o0","title":"分组查询","updated":"20230817161927"},"Children":[{"ID":"20230817161928-vw7chfm","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230817161928-vw7chfm","updated":"20230817161928"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"分组查询"}]},{"ID":"20230817161929-0yh1fjg","Type":"NodeParagraph","Properties":{"id":"20230817161929-0yh1fjg","updated":"20230817161929"},"Children":[{"Type":"NodeText","Data":"这一课介绍如何分组查询数据，涉及到两个新 SELECT 语句子句：GROUP BY 子句和 HAVING 子句。 上一课我们学习了如何使用 SQL 聚集函数汇总数据，但之前的计算中都是对于表的所有数据或匹配特定的WHERE子句的数据中进行，比如计算复旦大学学生的平均cpa情况，但如果我们想要返回每个学校的分别的平均gpa情况，应该怎么做呢？这时候就需要用到本章节要讲的分组语句。"}]},{"ID":"20230817161930-k3mawo1","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161930-k3mawo1","updated":"20230817161930"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"分组计算"}]},{"ID":"20230817161931-qoxic37","Type":"NodeParagraph","Properties":{"id":"20230817161931-qoxic37","updated":"20230817161931"},"Children":[{"Type":"NodeText","Data":"理解分组语句最好的办法是从例子出发，我们来看一个例子："}]},{"ID":"20230817161932-x9sqgo5","Type":"NodeParagraph","Properties":{"id":"20230817161932-x9sqgo5","updated":"20230817161932"},"Children":[{"Type":"NodeText","Data":"SELECT university,avg(gpa) AS avg_gpa"}]},{"ID":"20230817161933-vs3h3q7","Type":"NodeParagraph","Properties":{"id":"20230817161933-vs3h3q7","updated":"20230817161933"},"Children":[{"Type":"NodeText","Data":"FROM user_profile"}]},{"ID":"20230817161934-ga1ziya","Type":"NodeParagraph","Properties":{"id":"20230817161934-ga1ziya","updated":"20230817161934"},"Children":[{"Type":"NodeText","Data":"Group By university"}]},{"ID":"20230817161935-sisjfhm","Type":"NodeParagraph","Properties":{"id":"20230817161935-sisjfhm","updated":"20230817161935"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"输出:"}]},{"ID":"20230817161936-0id4k01","Type":"NodeParagraph","Properties":{"id":"20230817161936-0id4k01","updated":"20230817161936"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"img","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://uploadfiles.nowcoder.com/files/20210822/588579017_1629625336195/.jpg","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20230817161937-q9vib5m","Type":"NodeParagraph","Properties":{"id":"20230817161937-q9vib5m","updated":"20230817161937"},"Children":[{"Type":"NodeText","Data":"示范的SELECT 语句指定了两个列：university为用户的学校， avg(gpa)为计算字段，代表平均gpa。 GROUP BY 子句指示SQL按university分组分别计算每个学校的平均gpa情况，从输出中可以看到，结果返回了每个大学的平均gpa数值。"}]},{"ID":"20230817161938-jyfaw20","Type":"NodeParagraph","Properties":{"id":"20230817161938-jyfaw20","updated":"20230817161938"},"Children":[{"Type":"NodeText","Data":"在使用Group by时，有一些事项需要注意："}]},{"ID":"20230817161939-v54vjuc","Type":"NodeParagraph","Properties":{"id":"20230817161939-v54vjuc","updated":"20230817161939"},"Children":[{"Type":"NodeText","Data":"\\1. GROUP BY 子句可以包含任意数目的列，因而可以对分组进行嵌套， 更细致地进行数据分组。"}]},{"ID":"20230817161940-sb4az6v","Type":"NodeParagraph","Properties":{"id":"20230817161940-sb4az6v","updated":"20230817161940"},"Children":[{"Type":"NodeText","Data":"\\2. 除聚集计算语句外，SELECT 语句中的每一列都必须在 GROUP BY 子句 中同时给出。"}]},{"ID":"20230817161941-23588ta","Type":"NodeParagraph","Properties":{"id":"20230817161941-23588ta","updated":"20230817161941"},"Children":[{"Type":"NodeText","Data":"\\3. 如果分组列中包含具有 NULL 值的行，则 NULL 将作为一个分组返回。 如果列中有多行 NULL 值，它们将分为一组。"}]},{"ID":"20230817161942-21p1jwy","Type":"NodeParagraph","Properties":{"id":"20230817161942-21p1jwy","updated":"20230817161942"},"Children":[{"Type":"NodeText","Data":"\\4. GROUP BY 子句必须出现在 WHERE 子句之后，ORDER BY 子句之前。"}]},{"ID":"20230817161943-eewic3v","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161943-eewic3v","updated":"20230817161943"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"分组过滤"}]},{"ID":"20230817161944-zif4wmx","Type":"NodeParagraph","Properties":{"id":"20230817161944-zif4wmx","updated":"20230817161944"},"Children":[{"Type":"NodeText","Data":"除了能用 GROUP BY 分组数据外，SQL 还允许在分组的结果下进行过滤，分组查询的结果不能简单的使用Where语句进行过滤，而需要使用专门的Having语句。"}]},{"ID":"20230817161945-fm9j0mf","Type":"NodeParagraph","Properties":{"id":"20230817161945-fm9j0mf","updated":"20230817161945"},"Children":[{"Type":"NodeText","Data":"在上一章节题目中，我们计算了不同性别和不同学校分组下的用户30天内平均活跃天数情况，假如说我们只想要取出平均活跃天数在10天以上的分组，这时就可以用到Having语句，来看示范 ："}]},{"ID":"20230817161946-p4ys3r2","Type":"NodeBlockquote","Properties":{"id":"20230817161946-p4ys3r2","updated":"20230817161946"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161947-urzxlcs","Type":"NodeParagraph","Properties":{"id":"20230817161947-urzxlcs","updated":"20230817161947"},"Children":[{"Type":"NodeText","Data":"SELECT gender,university,count(device_id) as"}]}]},{"ID":"20230817161948-colqp81","Type":"NodeBlockquote","Properties":{"id":"20230817161948-colqp81","updated":"20230817161948"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161949-byf4b97","Type":"NodeParagraph","Properties":{"id":"20230817161949-byf4b97","updated":"20230817161949"},"Children":[{"Type":"NodeText","Data":"user_num,avg(active_days_within_30) as"}]}]},{"ID":"20230817161950-r42jj5a","Type":"NodeBlockquote","Properties":{"id":"20230817161950-r42jj5a","updated":"20230817161950"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161951-c1zti5o","Type":"NodeParagraph","Properties":{"id":"20230817161951-c1zti5o","updated":"20230817161951"},"Children":[{"Type":"NodeText","Data":"avg_active_days,avg(question_cnt) as avg_question_cnt"}]}]},{"ID":"20230817161952-vr6z1ii","Type":"NodeBlockquote","Properties":{"id":"20230817161952-vr6z1ii","updated":"20230817161952"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161953-3ukx7s3","Type":"NodeParagraph","Properties":{"id":"20230817161953-3ukx7s3","updated":"20230817161953"},"Children":[{"Type":"NodeText","Data":"FROM user_profile"}]}]},{"ID":"20230817161954-y1salxq","Type":"NodeBlockquote","Properties":{"id":"20230817161954-y1salxq","updated":"20230817161954"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161955-cuvyw94","Type":"NodeParagraph","Properties":{"id":"20230817161955-cuvyw94","updated":"20230817161955"},"Children":[{"Type":"NodeText","Data":"Group By gender,universityHaving avg(active_days_within_30) \u003e10"}]}]},{"ID":"20230817161956-1501pys","Type":"NodeParagraph","Properties":{"id":"20230817161956-1501pys","updated":"20230817161956"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"img","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://uploadfiles.nowcoder.com/files/20210822/588579017_1629625336377/.jpg","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20230817161957-6ritqe8","Type":"NodeParagraph","Properties":{"id":"20230817161957-6ritqe8","updated":"20230817161957"},"Children":[{"Type":"NodeText","Data":"可以看到，这条 SELECT 语句中除最后一行外其他语法与上一道题完全一致。在最后一行中我们增加了 HAVING 子句，并搭配使用了avg(active_days_within_30) \u003e10的条件，这种最终结果中就只会返回30天平均活跃天数大于10的分组。"}]},{"ID":"20230817161958-qhxgbt6","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230817161958-qhxgbt6","updated":"20230817161958"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"strong","TextMarkTextContent":"分组排序"}]},{"ID":"20230817161959-3gv4eos","Type":"NodeParagraph","Properties":{"id":"20230817161959-3gv4eos","updated":"20230817161959"},"Children":[{"Type":"NodeText","Data":"如果想让分组查询的结果按照某个特殊的字段进行升序或降序排列，那么应该怎么做呢？分组查询结果也支持排序功能，所需要用到的语句是Order By ，来看语句示例："}]},{"ID":"20230817161960-ddj9b8d","Type":"NodeBlockquote","Properties":{"id":"20230817161960-ddj9b8d","updated":"20230817161960"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161961-ffjtwhm","Type":"NodeParagraph","Properties":{"id":"20230817161961-ffjtwhm","updated":"20230817161961"},"Children":[{"Type":"NodeText","Data":"SELECT university,avg(active_days_within_30) as avg_active_days"}]}]},{"ID":"20230817161962-v4zah89","Type":"NodeBlockquote","Properties":{"id":"20230817161962-v4zah89","updated":"20230817161962"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161963-8dp9rio","Type":"NodeParagraph","Properties":{"id":"20230817161963-8dp9rio","updated":"20230817161963"},"Children":[{"Type":"NodeText","Data":"FROM user_profile"}]}]},{"ID":"20230817161964-n72fljs","Type":"NodeBlockquote","Properties":{"id":"20230817161964-n72fljs","updated":"20230817161964"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161965-jgcs6y4","Type":"NodeParagraph","Properties":{"id":"20230817161965-jgcs6y4","updated":"20230817161965"},"Children":[{"Type":"NodeText","Data":"Group By university"}]}]},{"ID":"20230817161966-2mdl56r","Type":"NodeBlockquote","Properties":{"id":"20230817161966-2mdl56r","updated":"20230817161966"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161967-rzvwal9","Type":"NodeParagraph","Properties":{"id":"20230817161967-rzvwal9","updated":"20230817161967"},"Children":[{"Type":"NodeText","Data":"ORDER BY avg_active_days"}]}]},{"ID":"20230817161968-wthgpgz","Type":"NodeParagraph","Properties":{"id":"20230817161968-wthgpgz","updated":"20230817161968"},"Children":[{"Type":"NodeText","Data":"上述代码含义为按照学校分组分别计算每个学校用户的平均活跃天数情况，并按照平均活跃天数结果进行升序排列。"}]},{"ID":"20230817161969-tu7s3ti","Type":"NodeParagraph","Properties":{"id":"20230817161969-tu7s3ti","updated":"20230817161969"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"img","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"https://uploadfiles.nowcoder.com/files/20210822/588579017_1629625336266/.jpg","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]}]}