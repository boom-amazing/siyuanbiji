{"ID":"20230817161931-4tcboic","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161931-4tcboic","title":"Hive中的表类型","updated":"20230817161931"},"Children":[{"ID":"20230817161932-3jun1q0","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161932-3jun1q0","updated":"20230817161932"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"Hive中的表类型"}]},{"ID":"20230817161933-b9542yb","Type":"NodeParagraph","Properties":{"id":"20230817161933-b9542yb","updated":"20230817161933"},"Children":[{"Type":"NodeText","Data":"分为内部表、外部表、分区表、桶表"}]},{"ID":"20230817161934-bernkgb","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161934-bernkgb","updated":"20230817161934"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"内部表："}]},{"ID":"20230817161935-ssujwou","Type":"NodeParagraph","Properties":{"id":"20230817161935-ssujwou","updated":"20230817161935"},"Children":[{"Type":"NodeText","Data":"默认创建的表是内部表 放在/user/hive/warehouse目录下"}]},{"ID":"20230817161936-pbufj4s","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161936-pbufj4s","updated":"20230817161936"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"外部表："}]},{"ID":"20230817161937-h5jmedz","Type":"NodeParagraph","Properties":{"id":"20230817161937-h5jmedz","updated":"20230817161937"},"Children":[{"Type":"NodeText","Data":"外部表与内部表的区别是当删除了外部表的数据 hdfs中的数据不会被删除 而表的元数据会在mysql的表中删除"}]},{"ID":"20230817161938-93kjzom","Type":"NodeParagraph","Properties":{"id":"20230817161938-93kjzom","updated":"20230817161938"},"Children":[{"Type":"NodeText","Data":"那根据这个格式我们自己来创建一个外部表"}]},{"ID":"20230817161939-gn609wy","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161939-gn609wy","updated":"20230817161939"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"create external table external_table (\nkey string\n) location '/data/external';\n\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161940-akbui59","Type":"NodeParagraph","Properties":{"id":"20230817161940-akbui59","updated":"20230817161940"},"Children":[{"Type":"NodeText","Data":"表创建完以后到hdfs上查询，如果指定的目录不存在会自动创建"}]},{"ID":"20230817161941-zkdb9cx","Type":"NodeParagraph","Properties":{"id":"20230817161941-zkdb9cx","updated":"20230817161941"},"Children":[{"Type":"NodeText","Data":"在实际工作中，我们在hive中创建的表95%以上的都是外部表"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"因为大致流程是这样的，"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"我们先通过flume采集数据，把数据上传到hdfs中，然后在hive中创建外部表和hdfs上的数据绑定关系，就可以使用sql查询数据了，所以连load数据那一步都可以省略了，因为是先有数据，才创建的表。"}]},{"ID":"20230817161942-6mq5yg5","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161942-6mq5yg5","updated":"20230817161942"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"分区表："}]},{"ID":"20230817161943-q3t4qsj","Type":"NodeParagraph","Properties":{"id":"20230817161943-q3t4qsj","updated":"20230817161943"},"Children":[{"Type":"NodeText","Data":"接下来看一个特殊的表，分区表，这种表的使用场景也是很多的"}]},{"ID":"20230817161944-r2qip03","Type":"NodeParagraph","Properties":{"id":"20230817161944-r2qip03","updated":"20230817161944"},"Children":[{"Type":"NodeText","Data":"假设我们的web服务器每天都产生一个日志数据文件，Flume把数据采集到HDFS中，每一天的数据存储到一个日期目录中。我们如果想查询某一天的数据的话，hive执行的时候默认会对所有文件都扫描一遍，然后再过滤出来我们想要查询的那一天的数据"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"如果你已经采集了一年的数据，这样每次计算都需要把一年的数据取出来，再过滤出来某一天的数据，效率就太低了，会非常浪费资源，"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"所以我们可以让hive在查询的时候，根据你要查询的日期，直接定位到对应的日期目录。这样就可以直接查询满足条件的数据了，效率提升可不止一点点啊，是质的提升。"}]},{"ID":"20230817161945-kzy12c7","Type":"NodeParagraph","Properties":{"id":"20230817161945-kzy12c7","updated":"20230817161945"},"Children":[{"Type":"NodeText","Data":"想要实现这个功能，就需要使用分区表了"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"分区可以理解为分类，通过分区把不同类型的数据放到不同目录中"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"分区的标准就是指定分区字段，分区字段可以有一个或多个，根据咱们刚才举的例子，分区字段就是日期"}]},{"ID":"20230817161946-rwo75n2","Type":"NodeParagraph","Properties":{"id":"20230817161946-rwo75n2","updated":"20230817161946"},"Children":[{"Type":"NodeText","Data":"分区表的意义在于优化查询，查询时尽量利用分区字段，如果不使用分区字段，就会全表扫描，最典型的一个场景就是把天作为分区字段，查询的时候指定天"}]},{"ID":"20230817161947-3cn6ubi","Type":"NodeParagraph","Properties":{"id":"20230817161947-3cn6ubi","updated":"20230817161947"},"Children":[{"Type":"NodeText","Data":"实际工作中一般是根据采集到的数据进行分区 创建的也是外部分区表"}]},{"ID":"20230817161948-wrbw58c","Type":"NodeParagraph","Properties":{"id":"20230817161948-wrbw58c","updated":"20230817161948"},"Children":[{"Type":"NodeText","Data":"外部分区表示工作中最常用的表"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"我们先来创建一个外部分区表"}]},{"ID":"20230817161949-zu508d2","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockInfo":"c2hlbGw=","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161949-zu508d2","updated":"20230817161949"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw=","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"create external table ex_par(\nid int,\nname string\n)partitioned by(dt string) \n row format delimited  \n fields terminated by '\\t'\n location '/data/ex_par';\n代码块1234567\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161950-2t3qe4y","Type":"NodeParagraph","Properties":{"id":"20230817161950-2t3qe4y","updated":"20230817161950"},"Children":[{"Type":"NodeText","Data":"其它的操作和前面操作普通分区表是一样的，我们主要演示一下添加分区数据和删除分区的操作"}]},{"ID":"20230817161951-x4fjlvt","Type":"NodeParagraph","Properties":{"id":"20230817161951-x4fjlvt","updated":"20230817161951"},"Children":[{"Type":"NodeText","Data":"添加分区数据"}]},{"ID":"20230817161952-oqfq8lo","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161952-oqfq8lo","updated":"20230817161952"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e load data local inpath '/data/soft/hivedata/ex_par.data' into table ex_par partition (dt='2020-01-01');\nLoading data to table default.ex_par partition (dt=2020-01-01)\nOK\nTime taken: 0.791 seconds\nhive (default)\u003e show partitions ex_par;\nOK\npartition\ndt=2020-01-01\nTime taken: 0.415 seconds, Fetched: 1 row(s)\n代码块123456789\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161953-02bauyo","Type":"NodeParagraph","Properties":{"id":"20230817161953-02bauyo","updated":"20230817161953"},"Children":[{"Type":"NodeText","Data":"删除分区"}]},{"ID":"20230817161954-mgyd5dr","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161954-mgyd5dr","updated":"20230817161954"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e alter table ex_par drop partition(dt='2020-01-01');\nDropped the partition dt=2020-01-01\nOK\nTime taken: 0.608 seconds\nhive (default)\u003e show partitions ex_par;\nOK\npartition\nTime taken: 0.229 seconds\n代码块12345678\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161955-dk8tspd","Type":"NodeParagraph","Properties":{"id":"20230817161955-dk8tspd","updated":"20230817161955"},"Children":[{"Type":"NodeText","Data":"分区删除之后，在这里就看不到分区信息了，那hdfs上的分区目录被删除了吗？"}]},{"ID":"20230817161956-uu6146n","Type":"NodeBlockquote","Properties":{"id":"20230817161956-uu6146n","updated":"20230817161956"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161957-gmmz2ov","Type":"NodeParagraph","Properties":{"id":"20230817161957-gmmz2ov","updated":"20230817161957"},"Children":[{"Type":"NodeText","Data":"注意：此时分区目录的数据还是在的，因为这个是外部表，所以删除分区也只是删除分区的定义，分区中的数据还是在的，这个和内部分区表就不一样了。"}]}]},{"ID":"20230817161958-00svbva","Type":"NodeParagraph","Properties":{"id":"20230817161958-00svbva","updated":"20230817161958"},"Children":[{"Type":"NodeText","Data":"这个一定要注意，在实际工作中新手最容易遇到的一个问题就是，针对分区表，通过hdfs的put命令把数据上传上去了，但是却查不到数据，就是因为没有在表中添加分区信息，也就是说你们现在虽然在一起了，但是还没有领结婚证，国家还不承认。"}]},{"ID":"20230817161959-9f2vry3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161959-9f2vry3","updated":"20230817161959"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e select * from ex_par;\nOK\nex_par.id       ex_par.name     ex_par.dt\nTime taken: 0.279 seconds\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161960-rvr1pe2","Type":"NodeParagraph","Properties":{"id":"20230817161960-rvr1pe2","updated":"20230817161960"},"Children":[{"Type":"NodeText","Data":"如果数据已经上传上去了，如何给他们绑定关系呢？就是使用前面咱们讲的alter add partition命令，注意在这里需要通过location指定分区目录"}]},{"ID":"20230817161961-loxvczn","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161961-loxvczn","updated":"20230817161961"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e alter table ex_par add partition(dt='2020-01-01') location '/data/ex_par/dt=2020-01-01';\nOK\nTime taken: 0.326 seconds\n代码块123\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161962-6ch7xwx","Type":"NodeParagraph","Properties":{"id":"20230817161962-6ch7xwx","updated":"20230817161962"},"Children":[{"Type":"NodeText","Data":"此时再查询分区数据和表数据，就正常了。"}]},{"ID":"20230817161963-5w7nf8a","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161963-5w7nf8a","updated":"20230817161963"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hive (default)\u003e show partitions ex_par;\nOK\npartition\ndt=2020-01-01\nTime taken: 0.19 seconds, Fetched: 1 row(s)\nhive (default)\u003e select * from ex_par;\nOK\nex_par.id       ex_par.name     ex_par.dt\n1       zhangsan        2020-01-01\n2       lisi    2020-01-01\n3       wangwu  2020-01-01\nTime taken: 0.432 seconds, Fetched: 3 row(s)\n代码块123456789101112\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161964-o043byt","Type":"NodeParagraph","Properties":{"id":"20230817161964-o043byt","updated":"20230817161964"},"Children":[{"Type":"NodeText","Data":"总结一下："}]},{"ID":"20230817161965-a0b0zd1","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161965-a0b0zd1","updated":"20230817161965"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"load data local inpath '/data/soft/hivedata/ex_par.data' into table ex_par partition (dt='2020-01-01');\n\n代码块12\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161966-1ra2v75","Type":"NodeParagraph","Properties":{"id":"20230817161966-1ra2v75","updated":"20230817161966"},"Children":[{"Type":"NodeText","Data":"load data…partition这条命令做了两件事情，上传数据，添加分区(绑定数据和分区之间的关系)"}]},{"ID":"20230817161967-9c4vcju","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"CodeBlockFenceChar":96,"CodeBlockFenceLen":3,"CodeBlockOpenFence":"YGBg","CodeBlockCloseFence":"YGBg","Properties":{"id":"20230817161967-9c4vcju","updated":"20230817161967"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}},{"Type":"NodeCodeBlockFenceInfoMarker","Properties":{"id":""}},{"Type":"NodeCodeBlockCode","Data":"hdfs dfs -mkdir /data/ex_par/dt=2020-01-01\nhdfs dfs -put /data/soft/hivedata/ex_par.data /data/ex_par/dt=2020-01-01\n\nalter table ex_par add partition(dt='2020-01-01') location '/data/ex_par/dt=2020-01-01';\n代码块1234\n","Properties":{"id":""}},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```","CodeBlockFenceLen":3,"Properties":{"id":""}}]},{"ID":"20230817161968-pytix24","Type":"NodeParagraph","Properties":{"id":"20230817161968-pytix24","updated":"20230817161968"},"Children":[{"Type":"NodeText","Data":"上面这三条命令做了两个事情，上传数据，添加分区(绑定数据和分区之间的关系)"}]}]}