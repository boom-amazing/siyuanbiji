{"ID":"20230817161935-ufv063e","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230817161935-ufv063e","title":"hadoop的高可用与高拓展","updated":"20230817161935"},"Children":[{"ID":"20230817161936-cqlcff4","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20230817161936-cqlcff4","updated":"20230817161936"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"hadoop的高可用与高拓展"}]},{"ID":"20230817161937-i1t10tx","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161937-i1t10tx","updated":"20230817161937"},"Children":[{"ID":"20230817161938-w5m7vtr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161938-w5m7vtr","updated":"20230817161938"},"Children":[{"ID":"20230817161939-eao6e1r","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161939-eao6e1r","updated":"20230817161939"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"高可用"}]}]}]},{"ID":"20230817161940-4xz1e74","Type":"NodeParagraph","Properties":{"id":"20230817161940-4xz1e74","updated":"20230817161940"},"Children":[{"Type":"NodeText","Data":"当我们只有一个namnode时 如果出现宕机 集群就不能提供正常服务 这个时候我们可以采用HA"}]},{"ID":"20230817161941-m6387ve","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003cimg src=\"C:\\Users\\HHH\\Desktop\\5f3f81ce09d97ad213030806.jpg\" alt=\"5f3f81ce09d97ad213030806\" style=\"zoom:80%;\" /\u003e\n\u003c/div\u003e","HtmlBlockType":7,"Properties":{"id":"20230817161941-m6387ve","updated":"20230817161941"}},{"ID":"20230817161942-cxc2lxf","Type":"NodeParagraph","Properties":{"id":"20230817161942-cxc2lxf","updated":"20230817161942"},"Children":[{"Type":"NodeText","Data":"HDFS的HA，指的是在一个集群中存在多个NameNode，分别运行在独立的物理节点上。在任何时间点，只有一个NameNode是处于Active状态，其它的是处于Standby状态。 Active NameNode（简写为Active NN）负责所有的客户端的操作，而Standby NameNode（简写为Standby NN）用来同步Active NameNode的状态信息，以提供快速的故障恢复能力。"}]},{"ID":"20230817161943-hpugmcm","Type":"NodeParagraph","Properties":{"id":"20230817161943-hpugmcm","updated":"20230817161943"},"Children":[{"Type":"NodeText","Data":"为了保证Active NN与Standby NN节点状态同步，即元数据保持一致。除了DataNode需要向这些NameNode发送block位置信息外，还构建了一组独立的守护进程”JournalNodes”（简写为JN）,用来同步Edits信息。当Active NN执行任何有关命名空间的修改，它需要持久化到一半以上的JNs上。而Standby NN负责观察JNs的变化，读取从Active NN发送过来的Edits信息，并更新自己内部的命名空间。一旦Active NN遇到错误，Standby NN需要保证从JNs中读出了全部的Edits，然后切换成Active状态，如果有多个Standby NN，还会涉及到选主的操作，选择一个切换为Active 状态。"}]},{"ID":"20230817161944-ex9sbrt","Type":"NodeBlockquote","Properties":{"id":"20230817161944-ex9sbrt","updated":"20230817161944"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161945-7hw5b0y","Type":"NodeParagraph","Properties":{"id":"20230817161945-7hw5b0y","updated":"20230817161945"},"Children":[{"Type":"NodeText","Data":"需要注意一点，为了保证Active NN与Standby NN节点状态同步，即元数据保持一致"}]}]},{"ID":"20230817161946-mmd8j1y","Type":"NodeParagraph","Properties":{"id":"20230817161946-mmd8j1y","updated":"20230817161946"},"Children":[{"Type":"NodeText","Data":"这里的元数据包含两块，一个是静态的，一个是动态的"}]},{"ID":"20230817161947-44awc90","Type":"NodeParagraph","Properties":{"id":"20230817161947-44awc90","updated":"20230817161947"},"Children":[{"Type":"NodeText","Data":"静态的是fsimage和edits，其实fsimage是由edits文件合并生成的，所以只需要保证edits文件内容的一致性。这个就是需要保证多个NameNode中edits文件内容的事务性同步。这块的工作是由JournalNodes集群进行同步的"}]},{"ID":"20230817161948-h4o0bra","Type":"NodeParagraph","Properties":{"id":"20230817161948-h4o0bra","updated":"20230817161948"},"Children":[{"Type":"NodeText","Data":"动态数据是指block和DataNode节点的信息，这个如何保证呢？"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"当DataNode启动的时候，上报数据信息的时候需要向每个NameNode都上报一份。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"这样就可以保证多个NameNode的元数据信息都一样了，当一个NameNode down掉以后，立刻从Standby NN中选择一个进行接管，没有影响，因为每个NameNode 的元数据时刻都是同步的。"}]},{"ID":"20230817161949-nvou9s4","Type":"NodeBlockquote","Properties":{"id":"20230817161949-nvou9s4","updated":"20230817161949"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20230817161950-ln1944z","Type":"NodeParagraph","Properties":{"id":"20230817161950-ln1944z","updated":"20230817161950"},"Children":[{"Type":"NodeText","Data":"注意:使用HA的时候，不能启动SecondaryNameNode，会出错。"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"之前是SecondaryNameNode负责合并edits到fsimage文件 那么现在这个工作被standby NN负责了。"}]}]},{"ID":"20230817161951-b4eo8yu","Type":"NodeParagraph","Properties":{"id":"20230817161951-b4eo8yu","updated":"20230817161951"},"Children":[{"Type":"NodeText","Data":"NameNode 切换可以自动切换，也可以手工切换，如果想要实现自动切换，需要使用到zookeeper集群。"}]},{"ID":"20230817161952-05c9zqj","Type":"NodeParagraph","Properties":{"id":"20230817161952-05c9zqj","updated":"20230817161952"},"Children":[{"Type":"NodeText","Data":"使用zookeeper集群自动切换的原理是这样的"}]},{"ID":"20230817161953-smpftbp","Type":"NodeParagraph","Properties":{"id":"20230817161953-smpftbp","updated":"20230817161953"},"Children":[{"Type":"NodeText","Data":"当多个NameNode 启动的时候会向zookeeper中注册一个临时节点，当NameNode挂掉的时候，这个临时节点也就消失了，这属于zookeeper的特性，这个时候，zookeeper就会有一个watcher监视器监视到，就知道这个节点down掉了，然后会选择一个节点转为Active，把down掉的节点转为Standby。"}]},{"ID":"20230817161954-u80xghw","Type":"NodeList","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161954-u80xghw","updated":"20230817161954"},"Children":[{"ID":"20230817161955-69k7uxj","Type":"NodeListItem","Data":"-","ListData":{"BulletChar":45,"Padding":2,"Marker":"LQ==","Num":-1},"Properties":{"id":"20230817161955-69k7uxj","updated":"20230817161955"},"Children":[{"ID":"20230817161956-u0ugovv","Type":"NodeHeading","HeadingLevel":5,"Properties":{"id":"20230817161956-u0ugovv","updated":"20230817161956"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"##### ","Properties":{"id":""}},{"Type":"NodeText","Data":"高拓展"}]},{"ID":"20230817161957-1s39yji","Type":"NodeParagraph","Properties":{"id":"20230817161957-1s39yji","updated":"20230817161957"},"Children":[{"Type":"NodeText","Data":"HDFS Federation可以解决单一命名空间存在的问题，使用多个NameNode，每个NameNode负责一个命令空间"}]},{"ID":"20230817161958-3tbcfpg","Type":"NodeHTMLBlock","Data":"\u003cdiv\u003e\n\u003cimg src=\"C:\\Users\\HHH\\Desktop\\5f3f81dd09cb919e12660533.jpg\" alt=\"5f3f81dd09cb919e12660533\" style=\"zoom:80%;\" /\u003e\n\u003c/div\u003e","HtmlBlockType":7,"Properties":{"id":"20230817161958-3tbcfpg","updated":"20230817161958"}},{"ID":"20230817161959-pcp5hrw","Type":"NodeParagraph","Properties":{"id":"20230817161959-pcp5hrw","updated":"20230817161959"},"Children":[{"Type":"NodeText","Data":"这种设计可提供以下特性："}]},{"ID":"20230817161960-2k63wjs","Type":"NodeParagraph","Properties":{"id":"20230817161960-2k63wjs","updated":"20230817161960"},"Children":[{"Type":"NodeText","Data":"1：HDFS集群扩展性。多个NameNode分管一部分目录，使得一个集群可以扩展到更多节点，不再因内存的限制制约文件存储数目。"}]},{"ID":"20230817161961-t6ij0aw","Type":"NodeParagraph","Properties":{"id":"20230817161961-t6ij0aw","updated":"20230817161961"},"Children":[{"Type":"NodeText","Data":"2：性能更高效。多个NameNode管理不同的数据，且同时对外提供服务，将为用户提供更高的读写吞吐率。"}]},{"ID":"20230817161962-wiuprdd","Type":"NodeParagraph","Properties":{"id":"20230817161962-wiuprdd","updated":"20230817161962"},"Children":[{"Type":"NodeText","Data":"3：良好的隔离性。用户可根据需要将不同业务数据交由不同NameNode管理，这样不同业务之间影响很小。"}]},{"ID":"20230817161963-ucrj2g7","Type":"NodeParagraph","Properties":{"id":"20230817161963-ucrj2g7","updated":"20230817161963"},"Children":[{"Type":"NodeText","Data":"如果真用到了Federation，一般也会和前面我们讲的HA结合起来使用，来看这个图"}]},{"ID":"20230817161964-frwjaex","Type":"NodeParagraph","Properties":{"id":"20230817161964-frwjaex","updated":"20230817161964"},"Children":[{"Type":"NodeText","Data":"这里面用到了4个NameNode和6个DataNode"}]},{"ID":"20230817161965-numb0on","Type":"NodeParagraph","Properties":{"id":"20230817161965-numb0on","updated":"20230817161965"},"Children":[{"Type":"NodeText","Data":"NN-1、NN-2、NN-3、NN-4"}]},{"ID":"20230817161966-pzp0che","Type":"NodeParagraph","Properties":{"id":"20230817161966-pzp0che","updated":"20230817161966"},"Children":[{"Type":"NodeText","Data":"DN-1、DN-2、DN-3、DN-4、DN-5、DN-6、"}]},{"ID":"20230817161967-se1igua","Type":"NodeParagraph","Properties":{"id":"20230817161967-se1igua","updated":"20230817161967"},"Children":[{"Type":"NodeText","Data":"其中NN-1、和NN-3配置了HA，提供了一个命令空间，/share，其实可理解为一个顶级目录"}]},{"ID":"20230817161968-qyhgh3s","Type":"NodeParagraph","Properties":{"id":"20230817161968-qyhgh3s","updated":"20230817161968"},"Children":[{"Type":"NodeText","Data":"NN-2和NN-4配置了HA，提供了一个命名空间，/user"}]},{"ID":"20230817161969-qk78su3","Type":"NodeParagraph","Properties":{"id":"20230817161969-qk78su3","updated":"20230817161969"},"Children":[{"Type":"NodeText","Data":"这样后期我们存储数据的时候，就可以根据数据的业务类型来区分是存储到share目录下还是user目录下，此时HDFS的存储能力就是/share和/user两个命名空间的总和了。"}]}]}]}]}