{"ID":"20230907084810-c2fvjgl","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230907084810-c2fvjgl","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230907084810-c2fvjgl\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230907084832-n1eldoq\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230907091827-ny6v081\u0026quot;,\u0026quot;scrollTop\u0026quot;:3720,\u0026quot;focusId\u0026quot;:\u0026quot;20230907085734-4smj909\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0\u0026#125;","title":"ck集群搭建 2shard_2replica","updated":"20230907092300"},"Children":[{"ID":"20230907084832-n1eldoq","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230907084832-n1eldoq","updated":"20230907085734"},"Children":[{"ID":"20230907085734-x95bpi8","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20230907085734-x95bpi8","updated":"20230907085734"},"Children":[{"ID":"20230907085734-4smj909","Type":"NodeParagraph","Properties":{"id":"20230907085734-4smj909","updated":"20230907085734"},"Children":[{"Type":"NodeText","Data":"主机"}]}]}]},{"ID":"20230907085729-en6v9zx","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907085729-en6v9zx","updated":"20230907085845"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"bigdata01 192.168.93.100\nbigdata02 192.168.93.101\nbigdata03 192.168.93.102\nbigdata04 192.168.93.103 \n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907084810-2vhclw3","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230907084810-2vhclw3","updated":"20230907085825"},"Children":[{"ID":"20230907085736-npd7cwu","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20230907085736-npd7cwu","updated":"20230907085825"},"Children":[{"ID":"20230907085736-pm6tv6d","Type":"NodeParagraph","Properties":{"id":"20230907085736-pm6tv6d","updated":"20230907085745"},"Children":[{"Type":"NodeText","Data":"基础环境安装"}]},{"ID":"20230907085810-2kxbupe","Type":"NodeParagraph","Properties":{"id":"20230907085810-2kxbupe","updated":"20230907085816"},"Children":[{"Type":"NodeText","Data":"首先确保"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bigdata01\\bigdata02\\bigdata03\\bigdata04"},{"Type":"NodeText","Data":"​这4个节点的基础环境配置完毕（IP、主机名、防火墙）"}]},{"ID":"20230907085819-zcxiygj","Type":"NodeParagraph","Properties":{"id":"20230907085819-zcxiygj","updated":"20230907085825"},"Children":[{"Type":"NodeText","Data":"按照ClickHouse单节点的安装步骤分别安装这4个节点"}]}]}]},{"ID":"20230907085914-clyinm2","Type":"NodeParagraph","Properties":{"id":"20230907085914-clyinm2","updated":"20230907085914"},"Children":[{"Type":"NodeText","Data":"下面以"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bigdata01"},{"Type":"NodeText","Data":"​节点为例：\n2.1 首先把ClickHouse相关的软件安装包上传到bigdata01节点的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"/data/soft"},{"Type":"NodeText","Data":"​目录。"}]},{"ID":"20230907085914-k5dwp0d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907085914-k5dwp0d","updated":"20230907085914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata01 soft]# ll clickhouse-*\n-rw-r--r--. 1 root root    107910 Nov 14  2023 clickhouse-client-22.10.2.11.x86_64.rpm\n-rw-r--r--. 1 root root 255877390 Nov 14  2023 clickhouse-common-static-22.10.2.11.x86_64.rpm\n-rw-r--r--. 1 root root 878380381 Nov 14  2023 clickhouse-common-static-dbg-22.10.2.11.x86_64.rpm\n-rw-r--r--. 1 root root    133783 Nov 14  2023 clickhouse-server-22.10.2.11.x86_64.rpm\n代码块\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907085914-whptvl6","Type":"NodeParagraph","Properties":{"id":"20230907085914-whptvl6","updated":"20230907085914"},"Children":[{"Type":"NodeText","Data":"2.2：安装"}]},{"ID":"20230907085914-acg4c52","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907085914-acg4c52","updated":"20230907085914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata01 soft]# rpm -ivh clickhouse-common-static-22.10.2.11.x86_64.rpm\n[root@bigdata01 soft]# rpm -ivh clickhouse-common-static-dbg-22.10.2.11.x86_64.rpm\n[root@bigdata01 soft]# rpm -ivh clickhouse-server-22.10.2.11.x86_64.rpm\nPreparing...                                                          ################################# [100%]\nUpdating / installing...\n   1:clickhouse-server-0:22.10.2.11-1                                 ################################# [100%]\n.....注意：在下面输入默认用户密码。\nEnter password for default user: clickhouse\n......\n[root@bigdata01 soft]# rpm -ivh clickhouse-client-22.10.2.11.x86_64.rpm \nPreparing...                                                          ################################# [100%]\nUpdating / installing...\n   1:clickhouse-client-0:22.10.2.11-1                                 ################################# [100%]\n代码块\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907085914-rj0l4nm","Type":"NodeParagraph","Properties":{"id":"20230907085914-rj0l4nm","updated":"20230907085914"},"Children":[{"Type":"NodeText","Data":"2.3：关闭ClickHouse开机自动启动\nClickHouse安装好以后默认会开机自动启动，如果不需要的话可以禁用此功能。"}]},{"ID":"20230907085914-rv5fxly","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907085914-rv5fxly","updated":"20230907085914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata04 soft]# systemctl disable clickhouse-server\n代码块\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907085914-qmyay0l","Type":"NodeParagraph","Properties":{"id":"20230907085914-qmyay0l","updated":"20230907085914"},"Children":[{"Type":"NodeText","Data":"2.4：修改配置文件\n去掉文件中"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"\u0026lt;listen_host\u0026gt;::\u0026lt;/listen_host\u0026gt;"},{"Type":"NodeText","Data":"​的注释，这样才可以在其他机器上访问本机的ClickHouse服务。\n以及将ClickHouse的TCP端口"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"9000"},{"Type":"NodeText","Data":"​，修改为"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"9001"},{"Type":"NodeText","Data":"​，避免端口冲突"}]},{"ID":"20230907085914-a5bn1b6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907085914-a5bn1b6","updated":"20230907085914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker"},{"Type":"NodeCodeBlockCode","Data":"[root@bigdata01 soft]# vi /etc/clickhouse-server/config.xml\n......\n\u003clisten_host\u003e::\u003c/listen_host\u003e\n......\n\u003ctcp_port\u003e9001\u003c/tcp_port\u003e\n......\n代码块\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907085914-0ddy794","Type":"NodeParagraph","Properties":{"id":"20230907085914-0ddy794","updated":"20230907085914"},"Children":[{"Type":"NodeText","Data":"注意：保存的时候需要使用"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"wq！"},{"Type":"NodeText","Data":"​强制保存。"}]},{"ID":"20230907085923-u4hpp0j","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20230907085923-u4hpp0j","updated":"20230907092300"},"Children":[{"ID":"20230907085924-nfoc06a","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20230907085924-nfoc06a","updated":"20230907092242"},"Children":[{"ID":"20230907085924-cex4yd8","Type":"NodeParagraph","Properties":{"id":"20230907085924-cex4yd8","updated":"20230907092242"},"Children":[{"Type":"NodeText","Data":"在"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"bigdata01\\bigdata02\\bigdata03"},{"Type":"NodeText","Data":"​这3个节点上安装Zookeeper集群 参考 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20230907083909-642rmqq","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"zk集群模式搭建"}]}]},{"ID":"20230907090011-efk5t7m","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20230907090011-efk5t7m","updated":"20230907092300"},"Children":[{"ID":"20230907090011-nruqbvo","Type":"NodeParagraph","Properties":{"id":"20230907090011-nruqbvo","updated":"20230907092300"},"Children":[{"Type":"NodeText","Data":"在所有ClickHouse节点中指定配置识别Zookeeper  同时构建两分片 两副本的集群 在/etc下创建metrika.xml文件"}]},{"ID":"20230907091328-qn84jg1","Type":"NodeParagraph","Properties":{"id":"20230907091328-qn84jg1","updated":"20230907091332"},"Children":[{"Type":"NodeText","Data":"集群规划"}]},{"ID":"20230907091332-0mzzg59","Type":"NodeParagraph","Properties":{"id":"20230907091332-0mzzg59","updated":"20230907091333"},"Children":[{"Type":"NodeText","Data":"分片1\t\t\t\t\t分片2\nClickHouse集群\tbigdata01(分片1-副本1)\tbigdata03(分片2-副本1)\n\t\t\t\tbigdata02(分片1-副本2)\tbigdata04(分片2-副本2)\nZookeeper集群\tbigdata01、bigdata02、bigdata03"}]}]},{"ID":"20230907091345-jhsd0zn","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NS4=","Num":5},"Properties":{"id":"20230907091345-jhsd0zn","updated":"20230907091347"},"Children":[{"ID":"20230907091345-zz082dm","Type":"NodeParagraph","Properties":{"id":"20230907091345-zz082dm","updated":"20230907091347"},"Children":[{"Type":"NodeText","Data":"vi /etc/metrika.xml"}]}]}]},{"ID":"20230907085954-3w7wp8k","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907085954-3w7wp8k","updated":"20230907091225"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"\u003c?xml version=\"1.0\"?\u003e\n\u003cyandex\u003e\n    \u003c!--ck集群节点--\u003e\n    \u003cclickhouse_remote_servers\u003e\n        \u003c!-- 集群名称 --\u003e\n        \u003cck_cluster_1\u003e\n            \u003c!--分片1--\u003e\n            \u003cshard\u003e\n\t\t\t\t\u003c!--分片1-副本1--\u003e\n                \u003creplica\u003e\n                    \u003chost\u003ebigdata01\u003c/host\u003e\n                    \u003cport\u003e9001\u003c/port\u003e\n                    \u003cuser\u003edefault\u003c/user\u003e\n                    \u003cpassword\u003eclickhouse\u003c/password\u003e\n                \u003c/replica\u003e\n                \u003c!--分片1-副本2--\u003e\n                \u003creplica\u003e\n                    \u003chost\u003ebigdata02\u003c/host\u003e\n                    \u003cport\u003e9001\u003c/port\u003e\n                    \u003cuser\u003edefault\u003c/user\u003e\n                    \u003cpassword\u003eclickhouse\u003c/password\u003e\n                \u003c/replica\u003e\n            \u003c/shard\u003e\n            \u003c!--分片2--\u003e\n            \u003cshard\u003e\n\t\t\t\t\u003c!--分片2-副本1--\u003e\n                \u003creplica\u003e\n                    \u003chost\u003ebigdata03\u003c/host\u003e\n                    \u003cport\u003e9001\u003c/port\u003e\n                    \u003cuser\u003edefault\u003c/user\u003e\n                    \u003cpassword\u003eclickhouse\u003c/password\u003e\n                \u003c/replica\u003e\n                \u003c!--分片2-副本2--\u003e\n                \u003creplica\u003e\n                    \u003chost\u003ebigdata04\u003c/host\u003e\n                    \u003cport\u003e9001\u003c/port\u003e\n                    \u003cuser\u003edefault\u003c/user\u003e\n                    \u003cpassword\u003eclickhouse\u003c/password\u003e\n                \u003c/replica\u003e\n            \u003c/shard\u003e\n        \u003c/ck_cluster_1\u003e\n    \u003c/clickhouse_remote_servers\u003e\n    \u003c!--zookeeper相关配置--\u003e\n    \u003czookeeper-servers\u003e\n        \u003cnode index=\"1\"\u003e\n            \u003chost\u003ebigdata01\u003c/host\u003e\n            \u003cport\u003e2181\u003c/port\u003e\n        \u003c/node\u003e\n        \u003cnode index=\"2\"\u003e\n            \u003chost\u003ebigdata02\u003c/host\u003e\n            \u003cport\u003e2181\u003c/port\u003e\n        \u003c/node\u003e\n        \u003cnode index=\"3\"\u003e\n            \u003chost\u003ebigdata03\u003c/host\u003e\n            \u003cport\u003e2181\u003c/port\u003e\n        \u003c/node\u003e\n    \u003c/zookeeper-servers\u003e\n    \u003cmacros\u003e\n        \u003cshard\u003e01\u003c/shard\u003e\n        \u003creplica\u003ebigdata01\u003c/replica\u003e\n    \u003c/macros\u003e\n\u003c/yandex\u003e\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907091241-4heix47","Type":"NodeParagraph","Properties":{"id":"20230907091241-4heix47","updated":"20230907091314"},"Children":[{"Type":"NodeText","Data":"需要修改对应节点的metrika文件 主要修改账号密码端口 以及 macros 中的replica名字"}]},{"ID":"20230907091403-yhk7k4s","Type":"NodeParagraph","Properties":{"id":"20230907091403-yhk7k4s","updated":"20230907091517"},"Children":[{"Type":"NodeText","Data":"然后修改对应"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"config.xml"},{"Type":"NodeText","Data":"​文件 需要让四台主机识别zk、remote_server以及macro"}]},{"ID":"20230907091517-uc9e890","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907091517-uc9e890","updated":"20230907091611"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"\n vi /etc/clickhouse-server/config.xml \n\n......\n\u003czookeeper incl=\"zookeeper-servers\" optional=\"false\" /\u003e\n......\n\n......\n\u003c!-- 找到已有的remote_servers标签，在标签上增加 incl=\"clickhouse_remote_servers\"，表示引入外部关于remote_servers的配置--\u003e\n\u003cremote_servers incl=\"clickhouse_remote_servers\"\u003e\n........\n\n\u003c!-- 增加下面配置，表示引入外部关于macros的配置 --\u003e\n\u003cmacros incl=\"macros\" optional=\"false\" /\u003e\n......\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907091533-0ky3uaq","Type":"NodeParagraph","Properties":{"id":"20230907091533-0ky3uaq","updated":"20230907091713"},"Children":[{"Type":"NodeText","Data":"自此完成搭建 现在bigdata[01-03]启动zk 然后在四台机器分别启动ck"}]},{"ID":"20230907091725-2ehp8ui","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907091725-2ehp8ui","updated":"20230907091754"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"bin/zkCli.sh start\nsystemctl start clickhouse-server\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230907091813-48k1gx2","Type":"NodeParagraph","Properties":{"id":"20230907091813-48k1gx2","updated":"20230907091816"},"Children":[{"Type":"NodeText","Data":"验证"}]},{"ID":"20230907091817-c8qu4sy","Type":"NodeParagraph","Properties":{"id":"20230907091817-c8qu4sy","updated":"20230907091818"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"clickhouse-client --password clickhouse --port 9001"},{"Type":"NodeText","Data":"​"}]},{"ID":"20230907091820-38o2oq6","Type":"NodeParagraph","Properties":{"id":"20230907091820-38o2oq6","updated":"20230907091927"},"Children":[{"Type":"NodeText","Data":"查询对应的表 是否关联上zk、cluster、macros"}]},{"ID":"20230907091827-ny6v081","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230907091827-ny6v081","updated":"20230907091905"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"select * from system.zookeeper where path = '/clickhouse'\nSELECT cluster,host_name FROM system.clusters;\nSELECT * FROM system.macros;\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]}]}