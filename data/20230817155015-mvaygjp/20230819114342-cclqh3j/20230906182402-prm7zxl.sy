{"ID":"20230906182402-prm7zxl","Spec":"1","Type":"NodeDocument","Properties":{"id":"20230906182402-prm7zxl","scroll":"\u0026#123;\u0026quot;rootId\u0026quot;:\u0026quot;20230906182402-prm7zxl\u0026quot;,\u0026quot;startId\u0026quot;:\u0026quot;20230906190230-l78xngy\u0026quot;,\u0026quot;endId\u0026quot;:\u0026quot;20230906182402-54cx145\u0026quot;,\u0026quot;scrollTop\u0026quot;:0,\u0026quot;focusId\u0026quot;:\u0026quot;20230906190230-l78xngy\u0026quot;,\u0026quot;focusStart\u0026quot;:0,\u0026quot;focusEnd\u0026quot;:0\u0026#125;","title":"nginx 集群搭建","updated":"20230906195805"},"Children":[{"ID":"20230906190230-l78xngy","Type":"NodeParagraph","Properties":{"id":"20230906190230-l78xngy","updated":"20230906190244"},"Children":[{"Type":"NodeText","Data":"两个节点bigdata01 以及bigdata02"}]},{"ID":"20230906190405-m4fby60","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20230906190405-m4fby60","updated":"20230906190411"},"Children":[{"Type":"NodeText","Data":"安装nginx"}]},{"ID":"20230906190517-b4ckdf1","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230906190517-b4ckdf1","updated":"20230906190523"},"Children":[{"Type":"NodeText","Data":"安装prce"}]},{"ID":"20230906190416-nc1jw2v","Type":"NodeParagraph","Properties":{"id":"20230906190416-nc1jw2v","updated":"20230906190424"},"Children":[{"Type":"NodeText","Data":"两个节点执行相同命令"}]},{"ID":"20230906190245-m536akj","Type":"NodeParagraph","Properties":{"id":"20230906190245-m536akj","updated":"20230906190312"},"Children":[{"Type":"NodeText","Data":"安装编译文件以及库文件"}]},{"ID":"20230906190313-utt908n","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190313-utt908n","updated":"20230906190315"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190319-mlw7lp9","Type":"NodeParagraph","Properties":{"id":"20230906190319-mlw7lp9","updated":"20230906190345"},"Children":[{"Type":"NodeText","Data":"下载prce包"}]},{"ID":"20230906190324-mkfkok9","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190324-mkfkok9","updated":"20230906191225"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"wget http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190351-hsu6ah5","Type":"NodeParagraph","Properties":{"id":"20230906190351-hsu6ah5","updated":"20230906190442"},"Children":[{"Type":"NodeText","Data":"解压 进入安装目录"}]},{"ID":"20230906190443-ulxivm0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190443-ulxivm0","updated":"20230906190451"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"cd pcre-8.35\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190453-nv6eait","Type":"NodeParagraph","Properties":{"id":"20230906190453-nv6eait","updated":"20230906190456"},"Children":[{"Type":"NodeText","Data":"编译"}]},{"ID":"20230906190500-hlssl57","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190500-hlssl57","updated":"20230906190509"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"./configure\nmake \u0026\u0026 make install\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190527-gfje363","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20230906190527-gfje363","updated":"20230906190532"},"Children":[{"Type":"NodeText","Data":"安装nginx"}]},{"ID":"20230906190609-glpe2wt","Type":"NodeParagraph","Properties":{"id":"20230906190609-glpe2wt","updated":"20230906190622"},"Children":[{"Type":"NodeText","Data":"nginx下载地址"}]},{"ID":"20230906190622-wr0gytj","Type":"NodeParagraph","Properties":{"id":"20230906190622-wr0gytj"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://nginx.org/en/download.html","TextMarkTextContent":"nginx.org/en/download.ht..."}]},{"ID":"20230906190533-wss0pyq","Type":"NodeParagraph","Properties":{"id":"20230906190533-wss0pyq","updated":"20230906190604"},"Children":[{"Type":"NodeText","Data":"上传nginx 1.24安装包到/data/soft下"}]},{"ID":"20230906190629-6wmleda","Type":"NodeParagraph","Properties":{"id":"20230906190629-6wmleda","updated":"20230906190648"},"Children":[{"Type":"NodeText","Data":"解压 进入nginx1.24目录下"}]},{"ID":"20230906190648-s7auaiu","Type":"NodeParagraph","Properties":{"id":"20230906190648-s7auaiu","updated":"20230906191424"},"Children":[{"Type":"NodeText","Data":"编译"}]},{"ID":"20230906190654-5jzifpm","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190654-5jzifpm","updated":"20230906190718"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/soft/pcre-8.35\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190733-fiorgg0","Type":"NodeParagraph","Properties":{"id":"20230906190733-fiorgg0","updated":"20230906190748"},"Children":[{"Type":"NodeText","Data":"-- prefix 指定安装目录"}]},{"ID":"20230906191416-im1loqh","Type":"NodeParagraph","Properties":{"id":"20230906191416-im1loqh","updated":"20230906191427"},"Children":[{"Type":"NodeText","Data":"安装"}]},{"ID":"20230906190759-iobfq31","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190759-iobfq31","updated":"20230906190809"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"make \u0026\u0026 make install\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190814-butkga9","Type":"NodeParagraph","Properties":{"id":"20230906190814-butkga9","updated":"20230906190820"},"Children":[{"Type":"NodeText","Data":"配置service服务"}]},{"ID":"20230906191117-ywif81h","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906191117-ywif81h","updated":"20230906191138"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"vi /etc/systemd/system/nginx.service\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906190820-7a88z3t","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906190820-7a88z3t","updated":"20230906190853"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"[Unit]\nDescription=nginx service\nAfter=network.target\n\n[Service]\nType=forking\nExecStart=/usr/local/nginx/sbin/nginx\nExecReload=/usr/local/nginx/sbin/nginx -s reload\nExecStop=/usr/local/nginx/sbin/nginx -s stop\nPrivateTmp=true\n\n[Install]\nWantedBy=multi-user.target\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906183906-b61uj1w","Type":"NodeParagraph","Properties":{"id":"20230906183906-b61uj1w","updated":"20230906194550"}},{"ID":"20230906194605-uurew1r","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20230906194605-uurew1r","updated":"20230906194612"},"Children":[{"Type":"NodeText","Data":"安装keepalived"}]},{"ID":"20230906194612-7nqg36k","Type":"NodeParagraph","Properties":{"id":"20230906194612-7nqg36k","updated":"20230906194655"},"Children":[{"Type":"NodeText","Data":"安装"}]},{"ID":"20230906194655-mr6tw14","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906194655-mr6tw14","updated":"20230906194710"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"yum install keepalived –y\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906194713-f8wmt3a","Type":"NodeParagraph","Properties":{"id":"20230906194713-f8wmt3a","updated":"20230906194725"},"Children":[{"Type":"NodeText","Data":"修改配置"}]},{"ID":"20230906194726-wb5345c","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906194726-wb5345c","updated":"20230906194914"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"vi /etc/keepalived/keepalived.conf\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906194928-exnun24","Type":"NodeParagraph","Properties":{"id":"20230906194928-exnun24","updated":"20230906194931"},"Children":[{"Type":"NodeText","Data":"主服务器"}]},{"ID":"20230906194932-9kkcbtl","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906194932-9kkcbtl","updated":"20230906195006"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"vrrp_script chk_http_port {\n         script \"/usr/local/src/nginx_check.sh\"  # 执行脚本所在的位置\n         interval 2     #检测脚本执行的间隔，单位秒，每个2秒执行一次脚本\n         weight 2\n}\n\nvrrp_instance VI_1 {\n         state MASTER    # 备份服务器上将 MASTER 改为 BACKUP\n         interface ens33         # 绑定的网卡\n         virtual_router_id 51    # 主、备机的 virtual_router_id 必须相同\n         priority 90    # 主、备机取不同的优先级，主机值较大，备份机值较小\n         advert_int 1   #每隔一秒发送一次心跳，确保从服务器是否还活着\n         authentication {               # 心跳检测需要的密码\n                 auth_type PASS\n                 auth_pass 1111\n        }\n         virtual_ipaddress {\n         192.168.93.50  # VRRP H 虚拟地址\n         }\n}\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906194937-ys8wie2","Type":"NodeParagraph","Properties":{"id":"20230906194937-ys8wie2","updated":"20230906194940"},"Children":[{"Type":"NodeText","Data":"从服务器"}]},{"ID":"20230906194941-jzridp0","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906194941-jzridp0","updated":"20230906195737"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"rrp_script chk_http_port {\n         script \"/usr/local/src/nginx_check.sh\"  # 执行脚本所在的位置\n         interval 2     #检测脚本执行的间隔，单位秒，每个2秒执行一次脚本\n         weight 2\n}\n\nvrrp_instance VI_1 {\n         state BACKUP    # 备份服务器上将 MASTER 改为 BACKUP\n         interface ens33         # 绑定的网卡\n         virtual_router_id 51    # 主、备机的 virtual_router_id 必须相同\n         priority 70    # 主、备机取不同的优先级，主机值较大，备份机值较小\n         advert_int 1   #每隔一秒发送一次心跳，确保从服务器是否还活着\n         authentication {               # 心跳检测需要的密码\n                 auth_type PASS\n                 auth_pass 1111\n        }\n         virtual_ipaddress {\n         192.168.93.50  # VRRP H 虚拟地址\n         }\n}\n\n\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906195022-vsl4dm8","Type":"NodeParagraph","Properties":{"id":"20230906195022-vsl4dm8","updated":"20230906195042"},"Children":[{"Type":"NodeText","Data":"在/usr/local/src 添加检测脚本，检查Nginx是否还活着"}]},{"ID":"20230906195043-3h5t1j5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20230906195043-3h5t1j5","updated":"20230906195106"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"c2hlbGw="},{"Type":"NodeCodeBlockCode","Data":"#!/bin/bash\nA=`ps -ef  | grep nginx | grep -v grep| wc -l`\nif [ $A -eq 0 ];then\n /usr/local/nginx/sbin/nginx    #Nginx启动命令的位置\n sleep 2\n if [ `ps -ef  | grep nginx | grep -v grep| wc -l` -eq 0 ];then\n killall keepalived\n fi\nfi\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20230906195131-5gnm7qi","Type":"NodeParagraph","Properties":{"id":"20230906195131-5gnm7qi","updated":"20230906195139"},"Children":[{"Type":"NodeText","Data":"验证服务"}]},{"ID":"20230906195241-jj69wsb","Type":"NodeParagraph","Properties":{"id":"20230906195241-jj69wsb","updated":"20230906195241"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20230906195241-rkwqvlo.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20230906195245-a0nthiq","Type":"NodeParagraph","Properties":{"id":"20230906195245-a0nthiq","updated":"20230906195256"},"Children":[{"Type":"NodeText","Data":"kill 掉master的nginx "}]},{"ID":"20230906195805-2gvj3a8","Type":"NodeParagraph","Properties":{"id":"20230906195805-2gvj3a8","updated":"20230906195805"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20230906195805-1efnd9c.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20230906195257-3nnuzf9","Type":"NodeParagraph","Properties":{"id":"20230906195257-3nnuzf9","updated":"20230906195300"},"Children":[{"Type":"NodeText","Data":"再次查看"}]},{"ID":"20230906195300-v8gubpo","Type":"NodeParagraph","Properties":{"id":"20230906195300-v8gubpo","updated":"20230906195315"},"Children":[{"Type":"NodeText","Data":"依然为 说明主备完成"}]},{"ID":"20230906195303-0giq29z","Type":"NodeParagraph","Properties":{"id":"20230906195303-0giq29z","updated":"20230906195303"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20230906195241-rkwqvlo.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20230906182408-mbiiz2h","Type":"NodeParagraph","Properties":{"id":"20230906182408-mbiiz2h","updated":"20230906195135"},"Children":[{"Type":"NodeText","Data":"参考："}]},{"ID":"20230906195136-4e2trf8","Type":"NodeParagraph","Properties":{"id":"20230906195136-4e2trf8"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://blog.csdn.net/zxd1435513775/article/details/102508573","TextMarkTextContent":"blog.csdn.net/zxd1435513..."}]},{"ID":"20230906182402-54cx145","Type":"NodeParagraph","Properties":{"id":"20230906182402-54cx145","updated":"20230906194546"},"Children":[{"Type":"NodeTextMark","TextMarkType":"a","TextMarkAHref":"https://www.runoob.com/linux/nginx-install-setup.html","TextMarkTextContent":"www.runoob.com/linux/ngi..."}]}]}